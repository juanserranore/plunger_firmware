\doxysection{Sprite.\+cpp}
\label{_sprite_8cpp_source}\index{lib/TFT\_eSPI-\/master/Extensions/Sprite.cpp@{lib/TFT\_eSPI-\/master/Extensions/Sprite.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/**************************************************************************************}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ The\ following\ class\ creates\ Sprites\ in\ RAM,\ graphics\ can\ then\ be\ drawn\ in\ the\ Sprite}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ and\ rendered\ quickly\ onto\ the\ TFT\ screen.\ The\ class\ inherits\ the\ graphics\ functions}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ from\ the\ TFT\_eSPI\ class.\ Some\ functions\ are\ overridden\ by\ this\ class\ so\ that\ the}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ graphics\ are\ written\ to\ the\ Sprite\ rather\ than\ the\ TFT.}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Coded\ by\ Bodmer,\ see\ license\ file\ in\ root\ folder}}
\DoxyCodeLine{00007\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00008\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ Color\ bytes\ are\ swapped\ when\ writing\ to\ RAM,\ this\ introduces\ a\ small\ overhead\ but}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ there\ is\ a\ nett\ performance\ gain\ by\ using\ swapped\ bytes.}}
\DoxyCodeLine{00011\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00014\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ TFT\_eSprite}}
\DoxyCodeLine{00015\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Class\ constructor}}
\DoxyCodeLine{00016\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00017\ TFT\_eSprite::TFT\_eSprite(TFT\_eSPI\ *tft)}
\DoxyCodeLine{00018\ \{}
\DoxyCodeLine{00019\ \ \ \_tft\ =\ tft;\ \ \ \ \ \textcolor{comment}{//\ Pointer\ to\ tft\ class\ so\ we\ can\ call\ member\ functions}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \_iwidth\ \ \ \ =\ 0;\ \textcolor{comment}{//\ Initialise\ width\ and\ height\ to\ 0\ (it\ does\ not\ exist\ yet)}}
\DoxyCodeLine{00022\ \ \ \_iheight\ \ \ =\ 0;}
\DoxyCodeLine{00023\ \ \ \_bpp\ =\ 16;}
\DoxyCodeLine{00024\ \ \ \_swapBytes\ =\ \textcolor{keyword}{false};\ \ \ \textcolor{comment}{//\ Do\ not\ swap\ pushImage\ colour\ bytes\ by\ default}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \_created\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00027\ \ \ \_vpOoB\ \ \ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \_xs\ =\ 0;\ \ \textcolor{comment}{//\ window\ bounds\ for\ pushColor}}
\DoxyCodeLine{00030\ \ \ \_ys\ =\ 0;}
\DoxyCodeLine{00031\ \ \ \_xe\ =\ 0;}
\DoxyCodeLine{00032\ \ \ \_ye\ =\ 0;}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \_xptr\ =\ 0;\ \textcolor{comment}{//\ pushColor\ coordinate}}
\DoxyCodeLine{00035\ \ \ \_yptr\ =\ 0;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \_colorMap\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \_psram\_enable\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00040\ \ \ }
\DoxyCodeLine{00041\ \ \ \textcolor{comment}{//\ Ensure\ end\_tft\_write()\ does\ nothing\ in\ inherited\ functions.}}
\DoxyCodeLine{00042\ \ \ lockTransaction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00047\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ createSprite}}
\DoxyCodeLine{00048\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Create\ a\ sprite\ (bitmap)\ of\ defined\ width\ and\ height}}
\DoxyCodeLine{00049\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ cast\ returned\ value\ to\ (uint8\_t*)\ for\ 8-\/bit\ or\ (uint16\_t*)\ for\ 16-\/bit\ colours}}
\DoxyCodeLine{00051\ \textcolor{keywordtype}{void}*\ TFT\_eSprite::createSprite(int16\_t\ w,\ int16\_t\ h,\ uint8\_t\ frames)}
\DoxyCodeLine{00052\ \{}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{if}\ (\ \_created\ )\ \textcolor{keywordflow}{return}\ \_img8\_1;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{if}\ (\ w\ <\ 1\ ||\ h\ <\ 1\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \_iwidth\ \ =\ \_dwidth\ \ =\ \_bitwidth\ =\ w;}
\DoxyCodeLine{00059\ \ \ \_iheight\ =\ \_dheight\ =\ h;}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ cursor\_x\ =\ 0;}
\DoxyCodeLine{00062\ \ \ cursor\_y\ =\ 0;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ Default\ scroll\ rectangle\ and\ gap\ fill\ colour}}
\DoxyCodeLine{00065\ \ \ \_sx\ =\ 0;}
\DoxyCodeLine{00066\ \ \ \_sy\ =\ 0;}
\DoxyCodeLine{00067\ \ \ \_sw\ =\ w;}
\DoxyCodeLine{00068\ \ \ \_sh\ =\ h;}
\DoxyCodeLine{00069\ \ \ \_scolor\ =\ TFT\_BLACK;}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \_img8\ \ \ =\ (uint8\_t*)\ callocSprite(w,\ h,\ frames);}
\DoxyCodeLine{00072\ \ \ \_img8\_1\ =\ \_img8;}
\DoxyCodeLine{00073\ \ \ \_img8\_2\ =\ \_img8;}
\DoxyCodeLine{00074\ \ \ \_img\ \ \ \ =\ (uint16\_t*)\ \_img8;}
\DoxyCodeLine{00075\ \ \ \_img4\ \ \ =\ \_img8;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{if}\ (\ (\_bpp\ ==\ 16)\ \&\&\ (frames\ >\ 1)\ )\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \_img8\_2\ =\ \_img8\ +\ (w\ *\ h\ *\ 2\ +\ 1);}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{comment}{//\ ESP32\ only\ 16bpp\ check}}
\DoxyCodeLine{00082\ \ \ \textcolor{comment}{//if\ (esp\_ptr\_dma\_capable(\_img8\_1))\ Serial.println("{}DMA\ capable\ Sprite\ pointer\ \_img8\_1"{});}}
\DoxyCodeLine{00083\ \ \ \textcolor{comment}{//else\ Serial.println("{}Not\ a\ DMA\ capable\ Sprite\ pointer\ \_img8\_1"{});}}
\DoxyCodeLine{00084\ \ \ \textcolor{comment}{//if\ (esp\_ptr\_dma\_capable(\_img8\_2))\ Serial.println("{}DMA\ capable\ Sprite\ pointer\ \_img8\_2"{});}}
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//else\ Serial.println("{}Not\ a\ DMA\ capable\ Sprite\ pointer\ \_img8\_2"{});}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{if}\ (\ (\_bpp\ ==\ 8)\ \&\&\ (frames\ >\ 1)\ )\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \_img8\_2\ =\ \_img8\ +\ (w\ *\ h\ +\ 1);}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{//\ This\ is\ to\ make\ it\ clear\ what\ pointer\ size\ is\ expected\ to\ be\ used}}
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{//\ but\ casting\ in\ the\ user\ sketch\ is\ needed\ due\ to\ the\ use\ of\ void*}}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ (\ (\_bpp\ ==\ 1)\ \&\&\ (frames\ >\ 1)\ )}
\DoxyCodeLine{00094\ \ \ \{}
\DoxyCodeLine{00095\ \ \ \ \ w\ =\ (w+7)\ \&\ 0xFFF8;}
\DoxyCodeLine{00096\ \ \ \ \ \_img8\_2\ =\ \_img8\ +\ (\ (w>>3)\ *\ h\ +\ 1\ );}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{if}\ (\_img8)}
\DoxyCodeLine{00100\ \ \ \{}
\DoxyCodeLine{00101\ \ \ \ \ \_created\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (\_bpp\ ==\ 4)\ \&\&\ (\_colorMap\ ==\ \textcolor{keyword}{nullptr}))\ createPalette(default\_4bit\_palette);}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ rotation\ =\ 0;}
\DoxyCodeLine{00105\ \ \ \ \ setViewport(0,\ 0,\ \_dwidth,\ \_dheight);}
\DoxyCodeLine{00106\ \ \ \ \ setPivot(\_iwidth/2,\ \_iheight/2);}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keywordflow}{return}\ \_img8\_1;}
\DoxyCodeLine{00108\ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00111\ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00115\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ getPointer}}
\DoxyCodeLine{00116\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Returns\ pointer\ to\ start\ of\ sprite\ memory\ area}}
\DoxyCodeLine{00117\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00118\ \textcolor{keywordtype}{void}*\ TFT\_eSprite::getPointer(\textcolor{keywordtype}{void})}
\DoxyCodeLine{00119\ \{}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00121\ \ \ \textcolor{keywordflow}{return}\ \_img8\_1;}
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00126\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ created}}
\DoxyCodeLine{00127\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Returns\ true\ if\ sprite\ has\ been\ created}}
\DoxyCodeLine{00128\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00129\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::created(\textcolor{keywordtype}{void})}
\DoxyCodeLine{00130\ \{}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordflow}{return}\ \_created;}
\DoxyCodeLine{00132\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00136\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ \string~TFT\_eSprite}}
\DoxyCodeLine{00137\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Class\ destructor}}
\DoxyCodeLine{00138\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00139\ TFT\_eSprite::\string~TFT\_eSprite(\textcolor{keywordtype}{void})}
\DoxyCodeLine{00140\ \{}
\DoxyCodeLine{00141\ \ \ deleteSprite();}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \textcolor{preprocessor}{\#ifdef\ SMOOTH\_FONT}}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{if}(fontLoaded)\ unloadFont();}
\DoxyCodeLine{00145\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00150\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ callocSprite}}
\DoxyCodeLine{00151\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Allocate\ a\ memory\ area\ for\ the\ Sprite\ and\ return\ pointer}}
\DoxyCodeLine{00152\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00153\ \textcolor{keywordtype}{void}*\ TFT\_eSprite::callocSprite(int16\_t\ w,\ int16\_t\ h,\ uint8\_t\ frames)}
\DoxyCodeLine{00154\ \{}
\DoxyCodeLine{00155\ \ \ \textcolor{comment}{//\ Add\ one\ extra\ "{}off\ screen"{}\ pixel\ to\ point\ out-\/of-\/bounds\ setWindow()\ coordinates}}
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ this\ means\ push/writeColor\ functions\ do\ not\ need\ additional\ bounds\ checks\ and}}
\DoxyCodeLine{00157\ \ \ \textcolor{comment}{//\ hence\ will\ run\ faster\ in\ normal\ circumstances.}}
\DoxyCodeLine{00158\ \ \ uint8\_t*\ ptr8\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{keywordflow}{if}\ (frames\ >\ 2)\ frames\ =\ 2;\ \textcolor{comment}{//\ Currently\ restricted\ to\ 2\ frame\ buffers}}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{if}\ (frames\ <\ 1)\ frames\ =\ 1;}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{00164\ \ \ \{}
\DoxyCodeLine{00165\ \textcolor{preprocessor}{\#if\ defined\ (ESP32)\ \&\&\ defined\ (CONFIG\_SPIRAM\_SUPPORT)}}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ psramFound()\ \&\&\ \_psram\_enable\ \&\&\ !\_tft-\/>DMA\_Enabled)}
\DoxyCodeLine{00167\ \ \ \ \ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ ptr8\ =\ (\ uint8\_t*)\ ps\_calloc(frames\ *\ w\ *\ h\ +\ frames,\ \textcolor{keyword}{sizeof}(uint16\_t));}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{comment}{//Serial.println("{}PSRAM"{});}}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00172\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00173\ \ \ \ \ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ ptr8\ =\ (\ uint8\_t*)\ calloc(frames\ *\ w\ *\ h\ +\ frames,\ \textcolor{keyword}{sizeof}(uint16\_t));}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \textcolor{comment}{//Serial.println("{}Normal\ RAM"{});}}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ \ \ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{00180\ \ \ \{}
\DoxyCodeLine{00181\ \textcolor{preprocessor}{\#if\ defined\ (ESP32)\ \&\&\ defined\ (CONFIG\_SPIRAM\_SUPPORT)}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ psramFound()\ \&\&\ \_psram\_enable\ )\ ptr8\ =\ (\ uint8\_t*)\ ps\_calloc(frames\ *\ w\ *\ h\ +\ frames,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00184\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00185\ \ \ \ \ ptr8\ =\ (\ uint8\_t*)\ calloc(frames\ *\ w\ *\ h\ +\ frames,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00186\ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{00189\ \ \ \{}
\DoxyCodeLine{00190\ \ \ \ \ w\ =\ (w+1)\ \&\ 0xFFFE;\ \textcolor{comment}{//\ width\ needs\ to\ be\ multiple\ of\ 2,\ with\ an\ extra\ "{}off\ screen"{}\ pixel}}
\DoxyCodeLine{00191\ \ \ \ \ \_iwidth\ =\ w;}
\DoxyCodeLine{00192\ \textcolor{preprocessor}{\#if\ defined\ (ESP32)\ \&\&\ defined\ (CONFIG\_SPIRAM\_SUPPORT)}}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ psramFound()\ \&\&\ \_psram\_enable\ )\ ptr8\ =\ (\ uint8\_t*)\ ps\_calloc(((frames\ *\ w\ *\ h)\ >>\ 1)\ +\ frames,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00195\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00196\ \ \ \ \ ptr8\ =\ (\ uint8\_t*)\ calloc(((frames\ *\ w\ *\ h)\ >>\ 1)\ +\ frames,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00197\ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ Must\ be\ 1\ bpp}}
\DoxyCodeLine{00200\ \ \ \{}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\_dwidth\ \ \ Display\ width+height\ in\ pixels\ always\ in\ rotation\ 0\ orientation}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{comment}{//\_dheight\ \ Not\ swapped\ for\ sprite\ rotations}}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{comment}{//\ Note:\ for\ 1bpp\ \_iwidth\ and\ \_iheight\ are\ swapped\ during\ Sprite\ rotations}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ w\ =\ \ (w+7)\ \&\ 0xFFF8;\ \textcolor{comment}{//\ width\ should\ be\ the\ multiple\ of\ 8\ bits\ to\ be\ compatible\ with\ epdpaint}}
\DoxyCodeLine{00206\ \ \ \ \ \_iwidth\ =\ w;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \_iwidth\ is\ rounded\ up\ to\ be\ multiple\ of\ 8,\ so\ might\ not\ be\ =\ \_dwidth}}
\DoxyCodeLine{00207\ \ \ \ \ \_bitwidth\ =\ w;\ \ \ \ \ \ \ \textcolor{comment}{//\ \_bitwidth\ will\ not\ be\ rotated\ whereas\ \_iwidth\ may\ be}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \textcolor{preprocessor}{\#if\ defined\ (ESP32)\ \&\&\ defined\ (CONFIG\_SPIRAM\_SUPPORT)}}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ psramFound()\ \&\&\ \_psram\_enable\ )\ ptr8\ =\ (\ uint8\_t*)\ ps\_calloc(frames\ *\ (w>>3)\ *\ h\ +\ frames,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00212\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00213\ \ \ \ \ ptr8\ =\ (\ uint8\_t*)\ calloc(frames\ *\ (w>>3)\ *\ h\ +\ frames,\ \textcolor{keyword}{sizeof}(uint8\_t));}
\DoxyCodeLine{00214\ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{return}\ ptr8;}
\DoxyCodeLine{00217\ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00221\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ createPalette\ (from\ RAM\ array)}}
\DoxyCodeLine{00222\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Set\ a\ palette\ for\ a\ 4-\/bit\ per\ pixel\ sprite}}
\DoxyCodeLine{00223\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00224\ \textcolor{keywordtype}{void}\ TFT\_eSprite::createPalette(uint16\_t\ colorMap[],\ uint8\_t\ colors)}
\DoxyCodeLine{00225\ \{}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{if}\ (colorMap\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00229\ \ \ \{}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ color\ map\ using\ the\ default\ FLASH\ map}}
\DoxyCodeLine{00231\ \ \ \ \ createPalette(default\_4bit\_palette);}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00233\ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \textcolor{comment}{//\ Allocate\ and\ clear\ memory\ for\ 16\ color\ map}}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{if}\ (\_colorMap\ ==\ \textcolor{keyword}{nullptr})\ \_colorMap\ =\ (uint16\_t\ *)calloc(16,\ \textcolor{keyword}{sizeof}(uint16\_t));}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{if}\ (colors\ >\ 16)\ colors\ =\ 16;}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \textcolor{comment}{//\ Copy\ map\ colors}}
\DoxyCodeLine{00241\ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ i\ =\ 0;\ i\ <\ colors;\ i++)}
\DoxyCodeLine{00242\ \ \ \{}
\DoxyCodeLine{00243\ \ \ \ \ \_colorMap[i]\ =\ colorMap[i];}
\DoxyCodeLine{00244\ \ \ \}}
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00249\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ createPalette\ (from\ FLASH\ array)}}
\DoxyCodeLine{00250\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Set\ a\ palette\ for\ a\ 4-\/bit\ per\ pixel\ sprite}}
\DoxyCodeLine{00251\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00252\ \textcolor{keywordtype}{void}\ TFT\_eSprite::createPalette(\textcolor{keyword}{const}\ uint16\_t\ colorMap[],\ uint8\_t\ colors)}
\DoxyCodeLine{00253\ \{}
\DoxyCodeLine{00254\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{if}\ (colorMap\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00257\ \ \ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ color\ map\ using\ the\ default\ FLASH\ map}}
\DoxyCodeLine{00259\ \ \ \ \ colorMap\ =\ default\_4bit\_palette;}
\DoxyCodeLine{00260\ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \textcolor{comment}{//\ Allocate\ and\ clear\ memory\ for\ 16\ color\ map}}
\DoxyCodeLine{00263\ \ \ \textcolor{keywordflow}{if}\ (\_colorMap\ ==\ \textcolor{keyword}{nullptr})\ \_colorMap\ =\ (uint16\_t\ *)calloc(16,\ \textcolor{keyword}{sizeof}(uint16\_t));}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{if}\ (colors\ >\ 16)\ colors\ =\ 16;}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \textcolor{comment}{//\ Copy\ map\ colors}}
\DoxyCodeLine{00268\ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ i\ =\ 0;\ i\ <\ colors;\ i++)}
\DoxyCodeLine{00269\ \ \ \{}
\DoxyCodeLine{00270\ \ \ \ \ \_colorMap[i]\ =\ pgm\_read\_word(colorMap++);}
\DoxyCodeLine{00271\ \ \ \}}
\DoxyCodeLine{00272\ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00276\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ frameBuffer}}
\DoxyCodeLine{00277\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ For\ 1\ bpp\ Sprites,\ select\ the\ frame\ used\ for\ graphics}}
\DoxyCodeLine{00278\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00279\ \textcolor{comment}{//\ Frames\ are\ numbered\ 1\ and\ 2}}
\DoxyCodeLine{00280\ \textcolor{keywordtype}{void}*\ TFT\_eSprite::frameBuffer(int8\_t\ f)}
\DoxyCodeLine{00281\ \{}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{if}\ (\ f\ ==\ 2\ )\ \_img8\ =\ \_img8\_2;}
\DoxyCodeLine{00285\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \_img8\ =\ \_img8\_1;}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ \_img\ =\ (uint16\_t*)\_img8;}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \textcolor{comment}{//if\ (\_bpp\ ==\ 8)\ \_img8\ =\ \_img8;}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)\ \_img4\ =\ \_img8;}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \textcolor{keywordflow}{return}\ \_img8;}
\DoxyCodeLine{00294\ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00298\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ setColorDepth}}
\DoxyCodeLine{00299\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Set\ bits\ per\ pixel\ for\ colour\ (1,\ 8\ or\ 16)}}
\DoxyCodeLine{00300\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00301\ \textcolor{keywordtype}{void}*\ TFT\_eSprite::setColorDepth(int8\_t\ b)}
\DoxyCodeLine{00302\ \{}
\DoxyCodeLine{00303\ \ \ \textcolor{comment}{//\ Do\ not\ re-\/create\ the\ sprite\ if\ the\ colour\ depth\ does\ not\ change}}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ b)\ \textcolor{keywordflow}{return}\ \_img8\_1;}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \textcolor{comment}{//\ Validate\ the\ new\ colour\ depth}}
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{if}\ (\ b\ >\ 8\ )\ \_bpp\ =\ 16;\ \ \textcolor{comment}{//\ Bytes\ per\ pixel}}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ b\ >\ 4\ )\ \_bpp\ =\ 8;}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ b\ >\ 1\ )\ \_bpp\ =\ 4;}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{else}\ \_bpp\ =\ 1;}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \textcolor{comment}{//\ Can't\ change\ an\ existing\ sprite's\ colour\ depth\ so\ delete\ and\ create\ a\ new\ one}}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{if}\ (\_created)\ \{}
\DoxyCodeLine{00314\ \ \ \ \ deleteSprite();}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{keywordflow}{return}\ createSprite(\_dwidth,\ \_dheight);}
\DoxyCodeLine{00316\ \ \ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00319\ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00323\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ getColorDepth}}
\DoxyCodeLine{00324\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Get\ bits\ per\ pixel\ for\ colour\ (1,\ 8\ or\ 16)}}
\DoxyCodeLine{00325\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00326\ int8\_t\ TFT\_eSprite::getColorDepth(\textcolor{keywordtype}{void})}
\DoxyCodeLine{00327\ \{}
\DoxyCodeLine{00328\ \ \ \textcolor{keywordflow}{if}\ (\_created)\ \textcolor{keywordflow}{return}\ \_bpp;}
\DoxyCodeLine{00329\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00330\ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00334\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ setBitmapColor}}
\DoxyCodeLine{00335\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Set\ the\ 1bpp\ foreground\ foreground\ and\ background\ colour}}
\DoxyCodeLine{00336\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00337\ \textcolor{keywordtype}{void}\ TFT\_eSprite::setBitmapColor(uint16\_t\ c,\ uint16\_t\ b)}
\DoxyCodeLine{00338\ \{}
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{if}\ (c\ ==\ b)\ b\ =\ \string~c;}
\DoxyCodeLine{00340\ \ \ \_tft-\/>bitmap\_fg\ =\ c;}
\DoxyCodeLine{00341\ \ \ \_tft-\/>bitmap\_bg\ =\ b;}
\DoxyCodeLine{00342\ \}}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00346\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ setPaletteColor}}
\DoxyCodeLine{00347\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Set\ the\ 4bpp\ palette\ color\ at\ the\ given\ index}}
\DoxyCodeLine{00348\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00349\ \textcolor{keywordtype}{void}\ TFT\_eSprite::setPaletteColor(uint8\_t\ index,\ uint16\_t\ color)}
\DoxyCodeLine{00350\ \{}
\DoxyCodeLine{00351\ \ \ \textcolor{keywordflow}{if}\ (\_colorMap\ ==\ \textcolor{keyword}{nullptr}\ ||\ index\ >\ 15)\ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ out\ of\ bounds}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \_colorMap[index]\ =\ color;}
\DoxyCodeLine{00354\ \}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00358\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ getPaletteColor}}
\DoxyCodeLine{00359\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Return\ the\ palette\ color\ at\ 4bpp\ index,\ or\ 0\ on\ error.}}
\DoxyCodeLine{00360\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00361\ uint16\_t\ TFT\_eSprite::getPaletteColor(uint8\_t\ index)}
\DoxyCodeLine{00362\ \{}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordflow}{if}\ (\_colorMap\ ==\ \textcolor{keyword}{nullptr}\ ||\ index\ >\ 15)\ \textcolor{keywordflow}{return}\ 0;\ \textcolor{comment}{//\ out\ of\ bounds}}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{return}\ \_colorMap[index];}
\DoxyCodeLine{00366\ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00370\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ deleteSprite}}
\DoxyCodeLine{00371\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Delete\ the\ sprite\ to\ free\ up\ memory\ (RAM)}}
\DoxyCodeLine{00372\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00373\ \textcolor{keywordtype}{void}\ TFT\_eSprite::deleteSprite(\textcolor{keywordtype}{void})}
\DoxyCodeLine{00374\ \{}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordflow}{if}\ (\_colorMap\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00376\ \ \ \{}
\DoxyCodeLine{00377\ \ \ \ \ free(\_colorMap);}
\DoxyCodeLine{00378\ \ \ \ \ \_colorMap\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00379\ \ \ \}}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \textcolor{keywordflow}{if}\ (\_created)}
\DoxyCodeLine{00382\ \ \ \{}
\DoxyCodeLine{00383\ \ \ \ \ free(\_img8\_1);}
\DoxyCodeLine{00384\ \ \ \ \ \_img8\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00385\ \ \ \ \ \_created\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00386\ \ \ \ \ \_vpOoB\ \ \ =\ \textcolor{keyword}{true};\ \ \textcolor{comment}{//\ TFT\_eSPI\ class\ write()\ uses\ this\ to\ check\ for\ valid\ sprite}}
\DoxyCodeLine{00387\ \ \ \}}
\DoxyCodeLine{00388\ \}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00392\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushRotated\ -\/\ Fast\ fixed\ point\ integer\ maths\ version}}
\DoxyCodeLine{00393\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Push\ rotated\ Sprite\ to\ TFT\ screen}}
\DoxyCodeLine{00394\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00395\ \textcolor{preprocessor}{\#define\ FP\_SCALE\ 10}}
\DoxyCodeLine{00396\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::pushRotated(int16\_t\ angle,\ uint32\_t\ transp)}
\DoxyCodeLine{00397\ \{}
\DoxyCodeLine{00398\ \ \ \textcolor{keywordflow}{if}\ (\ !\_created\ ||\ \_tft-\/>\_vpOoB)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \textcolor{comment}{//\ Bounding\ box\ parameters}}
\DoxyCodeLine{00401\ \ \ int16\_t\ min\_x;}
\DoxyCodeLine{00402\ \ \ int16\_t\ min\_y;}
\DoxyCodeLine{00403\ \ \ int16\_t\ max\_x;}
\DoxyCodeLine{00404\ \ \ int16\_t\ max\_y;}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \textcolor{comment}{//\ Get\ the\ bounding\ box\ of\ this\ rotated\ source\ Sprite\ relative\ to\ Sprite\ pivot}}
\DoxyCodeLine{00407\ \ \ \textcolor{keywordflow}{if}\ (\ !getRotatedBounds(angle,\ \&min\_x,\ \&min\_y,\ \&max\_x,\ \&max\_y)\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ uint16\_t\ sline\_buffer[max\_x\ -\/\ min\_x\ +\ 1];}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ int32\_t\ xt\ =\ min\_x\ -\/\ \_tft-\/>\_xPivot;}
\DoxyCodeLine{00412\ \ \ int32\_t\ yt\ =\ min\_y\ -\/\ \_tft-\/>\_yPivot;}
\DoxyCodeLine{00413\ \ \ uint32\_t\ xe\ =\ \_dwidth\ <<\ FP\_SCALE;}
\DoxyCodeLine{00414\ \ \ uint32\_t\ ye\ =\ \_dheight\ <<\ FP\_SCALE;}
\DoxyCodeLine{00415\ \ \ uint16\_t\ tpcolor\ =\ (uint16\_t)transp;}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \textcolor{keywordflow}{if}\ (transp\ !=\ 0x00FFFFFF)\ \{}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)\ tpcolor\ =\ \_colorMap[transp\ \&\ 0x0F];}
\DoxyCodeLine{00419\ \ \ \ \ tpcolor\ =\ tpcolor>>8\ |\ tpcolor<<8;\ \textcolor{comment}{//\ Working\ with\ swapped\ color\ bytes}}
\DoxyCodeLine{00420\ \ \ \}}
\DoxyCodeLine{00421\ \ \ \_tft-\/>startWrite();\ \textcolor{comment}{//\ Avoid\ transaction\ overhead\ for\ every\ tft\ pixel}}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ \textcolor{comment}{//\ Scan\ destination\ bounding\ box\ and\ fetch\ transformed\ pixels\ from\ source\ Sprite}}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ y\ =\ min\_y;\ y\ <=\ max\_y;\ y++,\ yt++)\ \{}
\DoxyCodeLine{00425\ \ \ \ \ int32\_t\ x\ =\ min\_x;}
\DoxyCodeLine{00426\ \ \ \ \ uint32\_t\ xs\ =\ (\_cosra\ *\ xt\ -\/\ (\_sinra\ *\ yt\ -\/\ (\_xPivot\ <<\ FP\_SCALE))\ +\ (1\ <<\ (FP\_SCALE\ -\/\ 1)));}
\DoxyCodeLine{00427\ \ \ \ \ uint32\_t\ ys\ =\ (\_sinra\ *\ xt\ +\ (\_cosra\ *\ yt\ +\ (\_yPivot\ <<\ FP\_SCALE))\ +\ (1\ <<\ (FP\_SCALE\ -\/\ 1)));}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordflow}{while}\ ((xs\ >=\ xe\ ||\ ys\ >=\ ye)\ \&\&\ x\ <\ max\_x)\ \{\ x++;\ xs\ +=\ \_cosra;\ ys\ +=\ \_sinra;\ \}}
\DoxyCodeLine{00430\ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ ==\ max\_x)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \ \ uint32\_t\ pixel\_count\ =\ 0;}
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ uint32\_t\ rp;}
\DoxyCodeLine{00435\ \ \ \ \ \ \ int32\_t\ xp\ =\ xs\ >>\ FP\_SCALE;}
\DoxyCodeLine{00436\ \ \ \ \ \ \ int32\_t\ yp\ =\ ys\ >>\ FP\_SCALE;}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ \{rp\ =\ \_img[xp\ +\ yp\ *\ \_iwidth];\ \}}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ rp\ =\ readPixel(xp,\ yp);\ rp\ =\ (uint16\_t)(rp>>8\ |\ rp<<8);\ \}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transp\ !=\ 0x00FFFFFF\ \&\&\ tpcolor\ ==\ rp)\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel\_count)\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TFT\ window\ is\ already\ clipped,\ so\ this\ is\ faster\ than\ pushImage()}}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \_tft-\/>setWindow(x\ -\/\ pixel\_count,\ y,\ x\ -\/\ 1,\ y);}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \_tft-\/>pushPixels(sline\_buffer,\ pixel\_count);}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ pixel\_count\ =\ 0;}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ sline\_buffer[pixel\_count++]\ =\ rp;}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00450\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (++x\ <\ max\_x\ \&\&\ (xs\ +=\ \_cosra)\ <\ xe\ \&\&\ (ys\ +=\ \_sinra)\ <\ ye);}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel\_count)\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \textcolor{comment}{//\ TFT\ window\ is\ already\ clipped,\ so\ this\ is\ faster\ than\ pushImage()}}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \_tft-\/>setWindow(x\ -\/\ pixel\_count,\ y,\ x\ -\/\ 1,\ y);}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \_tft-\/>pushPixels(sline\_buffer,\ pixel\_count);}
\DoxyCodeLine{00455\ \ \ \ \ \}}
\DoxyCodeLine{00456\ \ \ \}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \_tft-\/>endWrite();\ \textcolor{comment}{//\ End\ transaction}}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00461\ \}}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00465\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushRotated\ -\/\ Fast\ fixed\ point\ integer\ maths\ version}}
\DoxyCodeLine{00466\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Push\ a\ rotated\ copy\ of\ the\ Sprite\ to\ another\ Sprite}}
\DoxyCodeLine{00467\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00468\ \textcolor{comment}{//\ Not\ compatible\ with\ 4bpp}}
\DoxyCodeLine{00469\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::pushRotated(TFT\_eSprite\ *spr,\ int16\_t\ angle,\ uint32\_t\ transp)}
\DoxyCodeLine{00470\ \{}
\DoxyCodeLine{00471\ \ \ \textcolor{keywordflow}{if}\ (\ !\_created\ \ ||\ \_bpp\ ==\ 4)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Check\ this\ Sprite\ is\ created}}
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{if}\ (\ !spr-\/>\_created\ \ ||\ spr-\/>\_bpp\ ==\ 4)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \textcolor{comment}{//\ Ckeck\ destination\ Sprite\ is\ created}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \textcolor{comment}{//\ Bounding\ box\ parameters}}
\DoxyCodeLine{00475\ \ \ int16\_t\ min\_x;}
\DoxyCodeLine{00476\ \ \ int16\_t\ min\_y;}
\DoxyCodeLine{00477\ \ \ int16\_t\ max\_x;}
\DoxyCodeLine{00478\ \ \ int16\_t\ max\_y;}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ \textcolor{comment}{//\ Get\ the\ bounding\ box\ of\ this\ rotated\ source\ Sprite}}
\DoxyCodeLine{00481\ \ \ \textcolor{keywordflow}{if}\ (\ !getRotatedBounds(spr,\ angle,\ \&min\_x,\ \&min\_y,\ \&max\_x,\ \&max\_y)\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \ \ uint16\_t\ sline\_buffer[max\_x\ -\/\ min\_x\ +\ 1];}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ int32\_t\ xt\ =\ min\_x\ -\/\ spr-\/>\_xPivot;}
\DoxyCodeLine{00486\ \ \ int32\_t\ yt\ =\ min\_y\ -\/\ spr-\/>\_yPivot;}
\DoxyCodeLine{00487\ \ \ uint32\_t\ xe\ =\ \_dwidth\ <<\ FP\_SCALE;}
\DoxyCodeLine{00488\ \ \ uint32\_t\ ye\ =\ \_dheight\ <<\ FP\_SCALE;}
\DoxyCodeLine{00489\ \ \ uint16\_t\ tpcolor\ =\ (uint16\_t)transp;}
\DoxyCodeLine{00490\ \ \ }
\DoxyCodeLine{00491\ \ \ \textcolor{keywordflow}{if}\ (transp\ !=\ 0x00FFFFFF)\ \{}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)\ tpcolor\ =\ \_colorMap[transp\ \&\ 0x0F];}
\DoxyCodeLine{00493\ \ \ \ \ tpcolor\ =\ tpcolor>>8\ |\ tpcolor<<8;\ \textcolor{comment}{//\ Working\ with\ swapped\ color\ bytes}}
\DoxyCodeLine{00494\ \ \ \}}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \textcolor{keywordtype}{bool}\ oldSwapBytes\ =\ spr-\/>getSwapBytes();}
\DoxyCodeLine{00497\ \ \ spr-\/>setSwapBytes(\textcolor{keyword}{false});}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \textcolor{comment}{//\ Scan\ destination\ bounding\ box\ and\ fetch\ transformed\ pixels\ from\ source\ Sprite}}
\DoxyCodeLine{00500\ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ y\ =\ min\_y;\ y\ <=\ max\_y;\ y++,\ yt++)\ \{}
\DoxyCodeLine{00501\ \ \ \ \ int32\_t\ x\ =\ min\_x;}
\DoxyCodeLine{00502\ \ \ \ \ uint32\_t\ xs\ =\ (\_cosra\ *\ xt\ -\/\ (\_sinra\ *\ yt\ -\/\ (\_xPivot\ <<\ FP\_SCALE))\ +\ (1\ <<\ (FP\_SCALE\ -\/\ 1)));}
\DoxyCodeLine{00503\ \ \ \ \ uint32\_t\ ys\ =\ (\_sinra\ *\ xt\ +\ (\_cosra\ *\ yt\ +\ (\_yPivot\ <<\ FP\_SCALE))\ +\ (1\ <<\ (FP\_SCALE\ -\/\ 1)));}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ \ \ \textcolor{keywordflow}{while}\ ((xs\ >=\ xe\ ||\ ys\ >=\ ye)\ \&\&\ x\ <\ max\_x)\ \{\ x++;\ xs\ +=\ \_cosra;\ ys\ +=\ \_sinra;\ \}}
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ ==\ max\_x)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ uint32\_t\ pixel\_count\ =\ 0;}
\DoxyCodeLine{00509\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00510\ \ \ \ \ \ \ uint32\_t\ rp;}
\DoxyCodeLine{00511\ \ \ \ \ \ \ int32\_t\ xp\ =\ xs\ >>\ FP\_SCALE;}
\DoxyCodeLine{00512\ \ \ \ \ \ \ int32\_t\ yp\ =\ ys\ >>\ FP\_SCALE;}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ rp\ =\ \_img[xp\ +\ yp\ *\ \_iwidth];}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ rp\ =\ readPixel(xp,\ yp);\ rp\ =\ (uint16\_t)(rp>>8\ |\ rp<<8);\ \}}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transp\ !=\ 0x00FFFFFF\ \&\&\ tpcolor\ ==\ rp)\ \{}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel\_count)\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ spr-\/>pushImage(x\ -\/\ pixel\_count,\ y,\ pixel\_count,\ 1,\ sline\_buffer);}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ pixel\_count\ =\ 0;}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ sline\_buffer[pixel\_count++]\ =\ rp;}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00524\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (++x\ <\ max\_x\ \&\&\ (xs\ +=\ \_cosra)\ <\ xe\ \&\&\ (ys\ +=\ \_sinra)\ <\ ye);}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel\_count)\ spr-\/>pushImage(x\ -\/\ pixel\_count,\ y,\ pixel\_count,\ 1,\ sline\_buffer);}
\DoxyCodeLine{00526\ \ \ \}}
\DoxyCodeLine{00527\ \ \ spr-\/>setSwapBytes(oldSwapBytes);}
\DoxyCodeLine{00528\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00529\ \}}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00533\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ getRotatedBounds}}
\DoxyCodeLine{00534\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Get\ TFT\ bounding\ box\ of\ a\ rotated\ Sprite\ wrt\ pivot}}
\DoxyCodeLine{00535\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00536\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::getRotatedBounds(int16\_t\ angle,\ int16\_t\ *min\_x,\ int16\_t\ *min\_y,}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int16\_t\ *max\_x,\ int16\_t\ *max\_y)}
\DoxyCodeLine{00538\ \{}
\DoxyCodeLine{00539\ \ \ \textcolor{comment}{//\ Get\ the\ bounding\ box\ of\ this\ rotated\ source\ Sprite\ relative\ to\ Sprite\ pivot}}
\DoxyCodeLine{00540\ \ \ getRotatedBounds(angle,\ width(),\ height(),\ \_xPivot,\ \_yPivot,\ min\_x,\ min\_y,\ max\_x,\ max\_y);}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ \textcolor{comment}{//\ Move\ bounding\ box\ so\ source\ Sprite\ pivot\ coincides\ with\ TFT\ pivot}}
\DoxyCodeLine{00543\ \ \ *min\_x\ +=\ \_tft-\/>\_xPivot;}
\DoxyCodeLine{00544\ \ \ *max\_x\ +=\ \_tft-\/>\_xPivot;}
\DoxyCodeLine{00545\ \ \ *min\_y\ +=\ \_tft-\/>\_yPivot;}
\DoxyCodeLine{00546\ \ \ *max\_y\ +=\ \_tft-\/>\_yPivot;}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \textcolor{comment}{//\ Return\ if\ bounding\ box\ is\ outside\ of\ TFT\ viewport}}
\DoxyCodeLine{00549\ \ \ \textcolor{keywordflow}{if}\ (*min\_x\ >\ \_tft-\/>\_vpW)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00550\ \ \ \textcolor{keywordflow}{if}\ (*min\_y\ >\ \_tft-\/>\_vpH)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00551\ \ \ \textcolor{keywordflow}{if}\ (*max\_x\ <\ \_tft-\/>\_vpX)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00552\ \ \ \textcolor{keywordflow}{if}\ (*max\_y\ <\ \_tft-\/>\_vpY)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00553\ }
\DoxyCodeLine{00554\ \ \ \textcolor{comment}{//\ Clip\ bounding\ box\ to\ be\ within\ TFT\ viewport}}
\DoxyCodeLine{00555\ \ \ \textcolor{keywordflow}{if}\ (*min\_x\ <\ \_tft-\/>\_vpX)\ *min\_x\ =\ \_tft-\/>\_vpX;}
\DoxyCodeLine{00556\ \ \ \textcolor{keywordflow}{if}\ (*min\_y\ <\ \_tft-\/>\_vpY)\ *min\_y\ =\ \_tft-\/>\_vpY;}
\DoxyCodeLine{00557\ \ \ \textcolor{keywordflow}{if}\ (*max\_x\ >\ \_tft-\/>\_vpW)\ *max\_x\ =\ \_tft-\/>\_vpW;}
\DoxyCodeLine{00558\ \ \ \textcolor{keywordflow}{if}\ (*max\_y\ >\ \_tft-\/>\_vpH)\ *max\_y\ =\ \_tft-\/>\_vpH;}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00561\ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00564\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00565\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ getRotatedBounds}}
\DoxyCodeLine{00566\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Get\ destination\ Sprite\ bounding\ box\ of\ a\ rotated\ Sprite\ wrt\ pivot}}
\DoxyCodeLine{00567\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00568\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::getRotatedBounds(TFT\_eSprite\ *spr,\ int16\_t\ angle,\ int16\_t\ *min\_x,\ int16\_t\ *min\_y,}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int16\_t\ *max\_x,\ int16\_t\ *max\_y)}
\DoxyCodeLine{00570\ \{}
\DoxyCodeLine{00571\ \ \ \textcolor{comment}{//\ Get\ the\ bounding\ box\ of\ this\ rotated\ source\ Sprite\ relative\ to\ Sprite\ pivot}}
\DoxyCodeLine{00572\ \ \ getRotatedBounds(angle,\ width(),\ height(),\ \_xPivot,\ \_yPivot,\ min\_x,\ min\_y,\ max\_x,\ max\_y);}
\DoxyCodeLine{00573\ }
\DoxyCodeLine{00574\ \ \ \textcolor{comment}{//\ Move\ bounding\ box\ so\ source\ Sprite\ pivot\ coincides\ with\ destination\ Sprite\ pivot}}
\DoxyCodeLine{00575\ \ \ *min\_x\ +=\ spr-\/>\_xPivot;}
\DoxyCodeLine{00576\ \ \ *max\_x\ +=\ spr-\/>\_xPivot;}
\DoxyCodeLine{00577\ \ \ *min\_y\ +=\ spr-\/>\_yPivot;}
\DoxyCodeLine{00578\ \ \ *max\_y\ +=\ spr-\/>\_yPivot;}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \textcolor{comment}{//\ Test\ only\ to\ show\ bounding\ box}}
\DoxyCodeLine{00581\ \ \ \textcolor{comment}{//\ spr-\/>fillSprite(TFT\_BLACK);}}
\DoxyCodeLine{00582\ \ \ \textcolor{comment}{//\ spr-\/>drawRect(min\_x,\ min\_y,\ max\_x\ -\/\ min\_x\ +\ 1,\ max\_y\ -\/\ min\_y\ +\ 1,\ TFT\_GREEN);}}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \ \ \textcolor{comment}{//\ Return\ if\ bounding\ box\ is\ completely\ outside\ of\ destination\ Sprite}}
\DoxyCodeLine{00585\ \ \ \textcolor{keywordflow}{if}\ (*min\_x\ >\ spr-\/>width())\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00586\ \ \ \textcolor{keywordflow}{if}\ (*min\_y\ >\ spr-\/>height())\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00587\ \ \ \textcolor{keywordflow}{if}\ (*max\_x\ <\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00588\ \ \ \textcolor{keywordflow}{if}\ (*max\_y\ <\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \textcolor{comment}{//\ Clip\ bounding\ box\ to\ Sprite\ boundaries}}
\DoxyCodeLine{00591\ \ \ \textcolor{comment}{//\ Clipping\ to\ a\ viewport\ will\ be\ done\ by\ destination\ Sprite\ pushImage\ function}}
\DoxyCodeLine{00592\ \ \ \textcolor{keywordflow}{if}\ (*min\_x\ <\ 0)\ min\_x\ =\ 0;}
\DoxyCodeLine{00593\ \ \ \textcolor{keywordflow}{if}\ (*min\_y\ <\ 0)\ min\_y\ =\ 0;}
\DoxyCodeLine{00594\ \ \ \textcolor{keywordflow}{if}\ (*max\_x\ >\ spr-\/>width())\ \ *max\_x\ =\ spr-\/>width();}
\DoxyCodeLine{00595\ \ \ \textcolor{keywordflow}{if}\ (*max\_y\ >\ spr-\/>height())\ *max\_y\ =\ spr-\/>height();}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00598\ \}}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00602\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ rotatedBounds}}
\DoxyCodeLine{00603\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Get\ bounding\ box\ of\ a\ rotated\ Sprite\ wrt\ pivot}}
\DoxyCodeLine{00604\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00605\ \textcolor{keywordtype}{void}\ TFT\_eSprite::getRotatedBounds(int16\_t\ angle,\ int16\_t\ w,\ int16\_t\ h,\ int16\_t\ xp,\ int16\_t\ yp,}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int16\_t\ *min\_x,\ int16\_t\ *min\_y,\ int16\_t\ *max\_x,\ int16\_t\ *max\_y)}
\DoxyCodeLine{00607\ \{}
\DoxyCodeLine{00608\ \ \ \textcolor{comment}{//\ Trig\ values\ for\ the\ rotation}}
\DoxyCodeLine{00609\ \ \ \textcolor{keywordtype}{float}\ radAngle\ =\ -\/angle\ *\ 0.0174532925;\ \textcolor{comment}{//\ Convert\ degrees\ to\ radians}}
\DoxyCodeLine{00610\ \ \ \textcolor{keywordtype}{float}\ sina\ =\ sin(radAngle);}
\DoxyCodeLine{00611\ \ \ \textcolor{keywordtype}{float}\ cosa\ =\ cos(radAngle);}
\DoxyCodeLine{00612\ }
\DoxyCodeLine{00613\ \ \ w\ -\/=\ xp;\ \textcolor{comment}{//\ w\ is\ now\ right\ edge\ coordinate\ relative\ to\ xp}}
\DoxyCodeLine{00614\ \ \ h\ -\/=\ yp;\ \textcolor{comment}{//\ h\ is\ now\ bottom\ edge\ coordinate\ relative\ to\ yp}}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \textcolor{comment}{//\ Calculate\ new\ corner\ coordinates}}
\DoxyCodeLine{00617\ \ \ int16\_t\ x0\ =\ -\/xp\ *\ cosa\ -\/\ yp\ *\ sina;}
\DoxyCodeLine{00618\ \ \ int16\_t\ y0\ =\ \ xp\ *\ sina\ -\/\ yp\ *\ cosa;}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \ \ int16\_t\ x1\ =\ \ w\ *\ cosa\ -\/\ yp\ *\ sina;}
\DoxyCodeLine{00621\ \ \ int16\_t\ y1\ =\ -\/w\ *\ sina\ -\/\ yp\ *\ cosa;}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \ \ int16\_t\ x2\ =\ \ h\ *\ sina\ +\ w\ *\ cosa;}
\DoxyCodeLine{00624\ \ \ int16\_t\ y2\ =\ \ h\ *\ cosa\ -\/\ w\ *\ sina;}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ int16\_t\ x3\ =\ \ h\ *\ sina\ -\/\ xp\ *\ cosa;}
\DoxyCodeLine{00627\ \ \ int16\_t\ y3\ =\ \ h\ *\ cosa\ +\ xp\ *\ sina;}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00629\ \ \ \textcolor{comment}{//\ Find\ bounding\ box\ extremes,\ enlarge\ box\ to\ accomodate\ rounding\ errors}}
\DoxyCodeLine{00630\ \ \ *min\_x\ =\ x0-\/2;}
\DoxyCodeLine{00631\ \ \ \textcolor{keywordflow}{if}\ (x1\ <\ *min\_x)\ *min\_x\ =\ x1-\/2;}
\DoxyCodeLine{00632\ \ \ \textcolor{keywordflow}{if}\ (x2\ <\ *min\_x)\ *min\_x\ =\ x2-\/2;}
\DoxyCodeLine{00633\ \ \ \textcolor{keywordflow}{if}\ (x3\ <\ *min\_x)\ *min\_x\ =\ x3-\/2;}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ *max\_x\ =\ x0+2;}
\DoxyCodeLine{00636\ \ \ \textcolor{keywordflow}{if}\ (x1\ >\ *max\_x)\ *max\_x\ =\ x1+2;}
\DoxyCodeLine{00637\ \ \ \textcolor{keywordflow}{if}\ (x2\ >\ *max\_x)\ *max\_x\ =\ x2+2;}
\DoxyCodeLine{00638\ \ \ \textcolor{keywordflow}{if}\ (x3\ >\ *max\_x)\ *max\_x\ =\ x3+2;}
\DoxyCodeLine{00639\ }
\DoxyCodeLine{00640\ \ \ *min\_y\ =\ y0-\/2;}
\DoxyCodeLine{00641\ \ \ \textcolor{keywordflow}{if}\ (y1\ <\ *min\_y)\ *min\_y\ =\ y1-\/2;}
\DoxyCodeLine{00642\ \ \ \textcolor{keywordflow}{if}\ (y2\ <\ *min\_y)\ *min\_y\ =\ y2-\/2;}
\DoxyCodeLine{00643\ \ \ \textcolor{keywordflow}{if}\ (y3\ <\ *min\_y)\ *min\_y\ =\ y3-\/2;}
\DoxyCodeLine{00644\ }
\DoxyCodeLine{00645\ \ \ *max\_y\ =\ y0+2;}
\DoxyCodeLine{00646\ \ \ \textcolor{keywordflow}{if}\ (y1\ >\ *max\_y)\ *max\_y\ =\ y1+2;}
\DoxyCodeLine{00647\ \ \ \textcolor{keywordflow}{if}\ (y2\ >\ *max\_y)\ *max\_y\ =\ y2+2;}
\DoxyCodeLine{00648\ \ \ \textcolor{keywordflow}{if}\ (y3\ >\ *max\_y)\ *max\_y\ =\ y3+2;}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ \_sinra\ =\ round(sina\ *\ (1<<FP\_SCALE));}
\DoxyCodeLine{00651\ \ \ \_cosra\ =\ round(cosa\ *\ (1<<FP\_SCALE));}
\DoxyCodeLine{00652\ \}}
\DoxyCodeLine{00653\ }
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00656\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushSprite}}
\DoxyCodeLine{00657\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Push\ the\ sprite\ to\ the\ TFT\ at\ x,\ y}}
\DoxyCodeLine{00658\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00659\ \textcolor{keywordtype}{void}\ TFT\_eSprite::pushSprite(int32\_t\ x,\ int32\_t\ y)}
\DoxyCodeLine{00660\ \{}
\DoxyCodeLine{00661\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00662\ }
\DoxyCodeLine{00663\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{00664\ \ \ \{}
\DoxyCodeLine{00665\ \ \ \ \ \textcolor{keywordtype}{bool}\ oldSwapBytes\ =\ \_tft-\/>getSwapBytes();}
\DoxyCodeLine{00666\ \ \ \ \ \_tft-\/>setSwapBytes(\textcolor{keyword}{false});}
\DoxyCodeLine{00667\ \ \ \ \ \_tft-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img\ );}
\DoxyCodeLine{00668\ \ \ \ \ \_tft-\/>setSwapBytes(oldSwapBytes);}
\DoxyCodeLine{00669\ \ \ \}}
\DoxyCodeLine{00670\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{00671\ \ \ \{}
\DoxyCodeLine{00672\ \ \ \ \ \_tft-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img4,\ \textcolor{keyword}{false},\ \_colorMap);}
\DoxyCodeLine{00673\ \ \ \}}
\DoxyCodeLine{00674\ \ \ \textcolor{keywordflow}{else}\ \_tft-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img8,\ (\textcolor{keywordtype}{bool})(\_bpp\ ==\ 8));}
\DoxyCodeLine{00675\ \}}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00679\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushSprite}}
\DoxyCodeLine{00680\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Push\ the\ sprite\ to\ the\ TFT\ at\ x,\ y\ with\ transparent\ colour}}
\DoxyCodeLine{00681\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00682\ \textcolor{keywordtype}{void}\ TFT\_eSprite::pushSprite(int32\_t\ x,\ int32\_t\ y,\ uint16\_t\ transp)}
\DoxyCodeLine{00683\ \{}
\DoxyCodeLine{00684\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{00687\ \ \ \{}
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{keywordtype}{bool}\ oldSwapBytes\ =\ \_tft-\/>getSwapBytes();}
\DoxyCodeLine{00689\ \ \ \ \ \_tft-\/>setSwapBytes(\textcolor{keyword}{false});}
\DoxyCodeLine{00690\ \ \ \ \ \_tft-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img,\ transp\ );}
\DoxyCodeLine{00691\ \ \ \ \ \_tft-\/>setSwapBytes(oldSwapBytes);}
\DoxyCodeLine{00692\ \ \ \}}
\DoxyCodeLine{00693\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{00694\ \ \ \{}
\DoxyCodeLine{00695\ \ \ \ \ transp\ =\ (uint8\_t)((transp\ \&\ 0xE000)>>8\ |\ (transp\ \&\ 0x0700)>>6\ |\ (transp\ \&\ 0x0018)>>3);}
\DoxyCodeLine{00696\ \ \ \ \ \_tft-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img8,\ (uint8\_t)transp,\ (\textcolor{keywordtype}{bool})\textcolor{keyword}{true});}
\DoxyCodeLine{00697\ \ \ \}}
\DoxyCodeLine{00698\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{00699\ \ \ \{}
\DoxyCodeLine{00700\ \ \ \ \ \_tft-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img4,\ (uint8\_t)(transp\ \&\ 0x0F),\ \textcolor{keyword}{false},\ \_colorMap);}
\DoxyCodeLine{00701\ \ \ \}}
\DoxyCodeLine{00702\ \ \ \textcolor{keywordflow}{else}\ \_tft-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img8,\ 0,\ (\textcolor{keywordtype}{bool})\textcolor{keyword}{false});}
\DoxyCodeLine{00703\ \}}
\DoxyCodeLine{00704\ }
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00707\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushToSprite}}
\DoxyCodeLine{00708\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Push\ the\ sprite\ to\ another\ sprite\ at\ x,\ y}}
\DoxyCodeLine{00709\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00710\ \textcolor{comment}{//\ Note:\ The\ following\ sprite\ to\ sprite\ colour\ depths\ are\ currently\ supported:}}
\DoxyCodeLine{00711\ \textcolor{comment}{//\ \ \ \ Source\ \ \ \ Destination}}
\DoxyCodeLine{00712\ \textcolor{comment}{//\ \ \ \ 16bpp\ \ -\/>\ 16bpp}}
\DoxyCodeLine{00713\ \textcolor{comment}{//\ \ \ \ 16bpp\ \ -\/>\ \ 8bpp}}
\DoxyCodeLine{00714\ \textcolor{comment}{//\ \ \ \ \ 8bpp\ \ -\/>\ \ 8bpp}}
\DoxyCodeLine{00715\ \textcolor{comment}{//\ \ \ \ \ 4bpp\ \ -\/>\ \ 4bpp\ (note:\ color\ translation\ depends\ on\ the\ 2\ sprites\ palette\ colors)}}
\DoxyCodeLine{00716\ \textcolor{comment}{//\ \ \ \ \ 1bpp\ \ -\/>\ \ 1bpp\ (note:\ color\ translation\ depends\ on\ the\ 2\ sprites\ bitmap\ colors)}}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::pushToSprite(TFT\_eSprite\ *dspr,\ int32\_t\ x,\ int32\_t\ y)}
\DoxyCodeLine{00719\ \{}
\DoxyCodeLine{00720\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00721\ \ \ \textcolor{keywordflow}{if}\ (!dspr-\/>created())\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00723\ \ \ \textcolor{comment}{//\ Check\ destination\ sprite\ compatibility}}
\DoxyCodeLine{00724\ \ \ int8\_t\ ds\_bpp\ =\ dspr-\/>getColorDepth();}
\DoxyCodeLine{00725\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16\ \&\&\ ds\_bpp\ !=\ 16\ \&\&\ ds\_bpp\ !=\ \ 8)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00726\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ \ 8\ \&\&\ ds\_bpp\ !=\ \ 8)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00727\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ \ 4\ \&\&\ ds\_bpp\ !=\ \ 4)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00728\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ \ 1\ \&\&\ ds\_bpp\ !=\ \ 1)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00729\ }
\DoxyCodeLine{00730\ \ \ \textcolor{keywordtype}{bool}\ oldSwapBytes\ =\ dspr-\/>getSwapBytes();}
\DoxyCodeLine{00731\ \ \ dspr-\/>setSwapBytes(\textcolor{keyword}{false});}
\DoxyCodeLine{00732\ \ \ dspr-\/>pushImage(x,\ y,\ \_dwidth,\ \_dheight,\ \_img,\ \_bpp);}
\DoxyCodeLine{00733\ \ \ dspr-\/>setSwapBytes(oldSwapBytes);}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00735\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00736\ \}}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00740\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushToSprite}}
\DoxyCodeLine{00741\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Push\ the\ sprite\ to\ another\ sprite\ at\ x,\ y\ with\ transparent\ colour}}
\DoxyCodeLine{00742\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00743\ \textcolor{comment}{//\ Note:\ The\ following\ sprite\ to\ sprite\ colour\ depths\ are\ currently\ supported:}}
\DoxyCodeLine{00744\ \textcolor{comment}{//\ \ \ \ Source\ \ \ \ Destination}}
\DoxyCodeLine{00745\ \textcolor{comment}{//\ \ \ \ 16bpp\ \ -\/>\ 16bpp}}
\DoxyCodeLine{00746\ \textcolor{comment}{//\ \ \ \ 16bpp\ \ -\/>\ \ 8bpp}}
\DoxyCodeLine{00747\ \textcolor{comment}{//\ \ \ \ \ 8bpp\ \ -\/>\ \ 8bpp}}
\DoxyCodeLine{00748\ \textcolor{comment}{//\ \ \ \ \ 1bpp\ \ -\/>\ \ 1bpp}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::pushToSprite(TFT\_eSprite\ *dspr,\ int32\_t\ x,\ int32\_t\ y,\ uint16\_t\ transp)}
\DoxyCodeLine{00751\ \{}
\DoxyCodeLine{00752\ \ \ \textcolor{keywordflow}{if}\ (\ !\_created\ \ ||\ !dspr-\/>\_created)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Check\ Sprites\ exist}}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \textcolor{comment}{//\ Check\ destination\ sprite\ compatibility}}
\DoxyCodeLine{00755\ \ \ int8\_t\ ds\_bpp\ =\ dspr-\/>getColorDepth();}
\DoxyCodeLine{00756\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16\ \&\&\ ds\_bpp\ !=\ 16\ \&\&\ ds\_bpp\ !=\ \ 8)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00757\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ \ 8\ \&\&\ ds\_bpp\ !=\ \ 8)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00758\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ \ 4\ ||\ ds\_bpp\ ==\ \ 4)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00759\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ \ 1\ \&\&\ ds\_bpp\ !=\ \ 1)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \textcolor{keywordtype}{bool}\ oldSwapBytes\ =\ dspr-\/>getSwapBytes();}
\DoxyCodeLine{00762\ \ \ uint16\_t\ sline\_buffer[width()];}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ transp\ =\ transp>>8\ |\ transp<<8;}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \textcolor{comment}{//\ Scan\ destination\ bounding\ box\ and\ fetch\ transformed\ pixels\ from\ source\ Sprite}}
\DoxyCodeLine{00767\ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ ys\ =\ 0;\ ys\ <\ height();\ ys++)\ \{}
\DoxyCodeLine{00768\ \ \ \ \ int32\_t\ ox\ =\ x;}
\DoxyCodeLine{00769\ \ \ \ \ uint32\_t\ pixel\_count\ =\ 0;}
\DoxyCodeLine{00770\ }
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ xs\ =\ 0;\ xs\ <\ width();\ xs++)\ \{}
\DoxyCodeLine{00772\ \ \ \ \ \ \ uint16\_t\ rp\ =\ 0;}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ rp\ =\ \_img[xs\ +\ ys\ *\ width()];}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ rp\ =\ readPixel(xs,\ ys);\ rp\ =\ rp>>8\ |\ rp<<8;\ \}}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{comment}{//dspr-\/>drawPixel(xs,\ ys,\ rp);}}
\DoxyCodeLine{00776\ }
\DoxyCodeLine{00777\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transp\ ==\ rp)\ \{}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel\_count)\ \{}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ dspr-\/>pushImage(ox,\ y,\ pixel\_count,\ 1,\ sline\_buffer);}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ ox\ +=\ pixel\_count;}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ pixel\_count\ =\ 0;}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ ox++;}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ sline\_buffer[pixel\_count++]\ =\ rp;}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00788\ \ \ \ \ \}}
\DoxyCodeLine{00789\ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel\_count)\ dspr-\/>pushImage(ox,\ y,\ pixel\_count,\ 1,\ sline\_buffer);}
\DoxyCodeLine{00790\ \ \ \ \ y++;}
\DoxyCodeLine{00791\ \ \ \}}
\DoxyCodeLine{00792\ \ \ dspr-\/>setSwapBytes(oldSwapBytes);}
\DoxyCodeLine{00793\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00794\ \}}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00797\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00798\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushSprite}}
\DoxyCodeLine{00799\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Push\ a\ cropped\ sprite\ to\ the\ TFT\ at\ tx,\ ty}}
\DoxyCodeLine{00800\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00801\ \textcolor{keywordtype}{bool}\ TFT\_eSprite::pushSprite(int32\_t\ tx,\ int32\_t\ ty,\ int32\_t\ sx,\ int32\_t\ sy,\ int32\_t\ sw,\ int32\_t\ sh)}
\DoxyCodeLine{00802\ \{}
\DoxyCodeLine{00803\ \ \ \textcolor{keywordflow}{if}\ (!\_created)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00804\ }
\DoxyCodeLine{00805\ \ \ \textcolor{comment}{//\ Perform\ window\ boundary\ checks\ and\ crop\ if\ needed}}
\DoxyCodeLine{00806\ \ \ setWindow(sx,\ sy,\ sx\ +\ sw\ -\/\ 1,\ sy\ +\ sh\ -\/\ 1);}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ \ \ \textcolor{comment}{/*\ These\ global\ variables\ are\ now\ populated\ for\ the\ sprite}}
\DoxyCodeLine{00809\ \textcolor{comment}{\ \ \_xs\ =\ x\ start\ coordinate}}
\DoxyCodeLine{00810\ \textcolor{comment}{\ \ \_ys\ =\ y\ start\ coordinate}}
\DoxyCodeLine{00811\ \textcolor{comment}{\ \ \_xe\ =\ x\ end\ coordinate\ (inclusive)}}
\DoxyCodeLine{00812\ \textcolor{comment}{\ \ \_ye\ =\ y\ end\ coordinate\ (inclusive)}}
\DoxyCodeLine{00813\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00815\ \ \ \textcolor{comment}{//\ Calculate\ new\ sprite\ window\ bounding\ box\ width\ and\ height}}
\DoxyCodeLine{00816\ \ \ sw\ =\ \_xe\ -\/\ \_xs\ +\ 1;}
\DoxyCodeLine{00817\ \ \ sh\ =\ \_ye\ -\/\ \_ys\ +\ 1;}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00819\ \ \ \textcolor{keywordflow}{if}\ (\_ys\ >=\ \_iheight)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00820\ }
\DoxyCodeLine{00821\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{00822\ \ \ \{}
\DoxyCodeLine{00823\ \ \ \ \ \textcolor{keywordtype}{bool}\ oldSwapBytes\ =\ \_tft-\/>getSwapBytes();}
\DoxyCodeLine{00824\ \ \ \ \ \_tft-\/>setSwapBytes(\textcolor{keyword}{false});}
\DoxyCodeLine{00825\ }
\DoxyCodeLine{00826\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ a\ faster\ block\ copy\ to\ screen\ is\ possible}}
\DoxyCodeLine{00827\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ sx\ ==\ 0\ \&\&\ sw\ ==\ \_dwidth)}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \_tft-\/>pushImage(tx,\ ty,\ sw,\ sh,\ \_img\ +\ \_iwidth\ *\ \_ys\ );}
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ Render\ line\ by\ line}}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (sh-\/-\/)}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \_tft-\/>pushImage(tx,\ ty++,\ sw,\ 1,\ \_img\ +\ \_xs\ +\ \_iwidth\ *\ \_ys++\ );}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00833\ \ \ \ \ \_tft-\/>setSwapBytes(oldSwapBytes);}
\DoxyCodeLine{00834\ \ \ \}}
\DoxyCodeLine{00835\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{00836\ \ \ \{}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ a\ faster\ block\ copy\ to\ screen\ is\ possible}}
\DoxyCodeLine{00838\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ sx\ ==\ 0\ \&\&\ sw\ ==\ \_dwidth)}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \_tft-\/>pushImage(tx,\ ty,\ sw,\ sh,\ \_img8\ +\ \_iwidth\ *\ \_ys,\ (\textcolor{keywordtype}{bool})\textcolor{keyword}{true}\ );}
\DoxyCodeLine{00840\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ Render\ line\ by\ line}}
\DoxyCodeLine{00841\ \ \ \ \ \textcolor{keywordflow}{while}\ (sh-\/-\/)}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \_tft-\/>pushImage(tx,\ ty++,\ sw,\ 1,\ \_img8\ +\ \_xs\ +\ \_iwidth\ *\ \_ys++,\ (\textcolor{keywordtype}{bool})\textcolor{keyword}{true}\ );}
\DoxyCodeLine{00843\ \ \ \}}
\DoxyCodeLine{00844\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{00845\ \ \ \{}
\DoxyCodeLine{00846\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ a\ faster\ block\ copy\ to\ screen\ is\ possible}}
\DoxyCodeLine{00847\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ sx\ ==\ 0\ \&\&\ sw\ ==\ \_dwidth)}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \_tft-\/>pushImage(tx,\ ty,\ sw,\ sh,\ \_img4\ +\ (\_iwidth>>1)\ *\ \_ys,\ \textcolor{keyword}{false},\ \_colorMap\ );}
\DoxyCodeLine{00849\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ Render\ line\ by\ line}}
\DoxyCodeLine{00850\ \ \ \ \ \{}
\DoxyCodeLine{00851\ \ \ \ \ \ \ int32\_t\ ds\ =\ \_xs\&1;\ \textcolor{comment}{//\ Odd\ x\ start\ pixel}}
\DoxyCodeLine{00852\ }
\DoxyCodeLine{00853\ \ \ \ \ \ \ int32\_t\ de\ =\ 0;\ \ \ \ \ \textcolor{comment}{//\ Odd\ x\ end\ pixel}}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((sw\ >\ ds)\ \&\&\ (\_xe\&1))\ de\ =\ 1;}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \ \ \ \ uint32\_t\ dm\ =\ 0;\ \ \ \ \ \textcolor{comment}{//\ Midsection\ pixel\ count}}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sw\ >\ (ds+de))\ dm\ =\ sw\ -\/\ ds\ -\/\ de;}
\DoxyCodeLine{00858\ \ \ \ \ \ \ sw-\/-\/;}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ \ \ uint32\_t\ yp\ =\ (\_xs\ +\ ds\ +\ \_iwidth\ *\ \_ys)>>1;}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \_tft-\/>startWrite();}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (sh-\/-\/)}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ds)\ \_tft-\/>drawPixel(tx,\ ty,\ readPixel(\_xs,\ \_ys)\ );}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dm)\ \_tft-\/>pushImage(tx\ +\ ds,\ ty,\ dm,\ 1,\ \_img4\ +\ yp,\ \textcolor{keyword}{false},\ \_colorMap\ );}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (de)\ \_tft-\/>drawPixel(tx\ +\ sw,\ ty,\ readPixel(\_xe,\ \_ys)\ );}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \_ys++;}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ ty++;}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ yp\ +=\ (\_iwidth>>1);}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \_tft-\/>endWrite();}
\DoxyCodeLine{00872\ \ \ \ \ \}}
\DoxyCodeLine{00873\ \ \ \}}
\DoxyCodeLine{00874\ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ 1bpp}}
\DoxyCodeLine{00875\ \ \ \{}
\DoxyCodeLine{00876\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ a\ faster\ block\ copy\ to\ screen\ is\ possible}}
\DoxyCodeLine{00877\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ sx\ ==\ 0\ \&\&\ sw\ ==\ \_dwidth)}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \_tft-\/>pushImage(tx,\ ty,\ sw,\ sh,\ \_img8\ +\ (\_bitwidth>>3)\ *\ \_ys,\ (\textcolor{keywordtype}{bool})\textcolor{keyword}{false}\ );}
\DoxyCodeLine{00879\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ Render\ line\ by\ line}}
\DoxyCodeLine{00880\ \ \ \ \ \{}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \_tft-\/>startWrite();}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (sh-\/-\/)}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \_tft-\/>pushImage(tx,\ ty++,\ sw,\ 1,\ \_img8\ +\ (\_bitwidth>>3)\ *\ \_ys++,\ (\textcolor{keywordtype}{bool})\textcolor{keyword}{false}\ );}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \_tft-\/>endWrite();}
\DoxyCodeLine{00887\ \ \ \ \ \}}
\DoxyCodeLine{00888\ \ \ \}}
\DoxyCodeLine{00889\ }
\DoxyCodeLine{00890\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00891\ \}}
\DoxyCodeLine{00892\ }
\DoxyCodeLine{00893\ }
\DoxyCodeLine{00894\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00895\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ readPixelValue}}
\DoxyCodeLine{00896\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Read\ the\ color\ map\ index\ of\ a\ pixel\ at\ defined\ coordinates}}
\DoxyCodeLine{00897\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00898\ uint16\_t\ TFT\_eSprite::readPixelValue(int32\_t\ x,\ int32\_t\ y)}
\DoxyCodeLine{00899\ \{}
\DoxyCodeLine{00900\ \ \ \textcolor{keywordflow}{if}\ (\_vpOoB\ \ ||\ !\_created)\ \textcolor{keywordflow}{return}\ 0xFF;}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ x+=\ \_xDatum;}
\DoxyCodeLine{00903\ \ \ y+=\ \_yDatum;}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ \textcolor{comment}{//\ Range\ checking}}
\DoxyCodeLine{00906\ \ \ \textcolor{keywordflow}{if}\ ((x\ <\ \_vpX)\ ||\ (y\ <\ \_vpY)\ ||(x\ >=\ \_vpW)\ ||\ (y\ >=\ \_vpH))\ \textcolor{keywordflow}{return}\ 0xFF;}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{00909\ \ \ \{}
\DoxyCodeLine{00910\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ pixel\ colour}}
\DoxyCodeLine{00911\ \ \ \ \ \textcolor{keywordflow}{return}\ readPixel(x\ -\/\ \_xDatum,\ y\ -\/\ \_yDatum);}
\DoxyCodeLine{00912\ \ \ \}}
\DoxyCodeLine{00913\ }
\DoxyCodeLine{00914\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{00915\ \ \ \{}
\DoxyCodeLine{00916\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ pixel\ byte\ value}}
\DoxyCodeLine{00917\ \ \ \ \ \textcolor{keywordflow}{return}\ \_img8[x\ +\ y\ *\ \_iwidth];}
\DoxyCodeLine{00918\ \ \ \}}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00920\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{00921\ \ \ \{}
\DoxyCodeLine{00922\ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ >=\ \_dwidth)\ \textcolor{keywordflow}{return}\ 0xFF;}
\DoxyCodeLine{00923\ \ \ \ \ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_img4[((x+y*\_iwidth)>>1)]\ >>\ 4;\ \ \ \textcolor{comment}{//\ even\ index\ =\ bits\ 7\ ..\ 4}}
\DoxyCodeLine{00925\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_img4[((x+y*\_iwidth)>>1)]\ \&\ 0x0F;\ \textcolor{comment}{//\ odd\ index\ =\ bits\ 3\ ..\ 0.}}
\DoxyCodeLine{00927\ \ \ \}}
\DoxyCodeLine{00928\ }
\DoxyCodeLine{00929\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 1)}
\DoxyCodeLine{00930\ \ \ \{}
\DoxyCodeLine{00931\ \ \ \ \ \textcolor{comment}{//\ Note:\ \_dwidth\ and\ \_dheight\ bounds\ not\ checked\ (rounded\ up\ -\/iwidth\ and\ \_iheight\ used)}}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{keywordflow}{if}\ (rotation\ ==\ 1)}
\DoxyCodeLine{00933\ \ \ \ \ \{}
\DoxyCodeLine{00934\ \ \ \ \ \ \ uint16\_t\ tx\ =\ x;}
\DoxyCodeLine{00935\ \ \ \ \ \ \ x\ =\ \_dheight\ -\/\ y\ -\/\ 1;}
\DoxyCodeLine{00936\ \ \ \ \ \ \ y\ =\ tx;}
\DoxyCodeLine{00937\ \ \ \ \ \}}
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (rotation\ ==\ 2)}
\DoxyCodeLine{00939\ \ \ \ \ \{}
\DoxyCodeLine{00940\ \ \ \ \ \ \ x\ =\ \_dwidth\ -\/\ x\ -\/\ 1;}
\DoxyCodeLine{00941\ \ \ \ \ \ \ y\ =\ \_dheight\ -\/\ y\ -\/\ 1;}
\DoxyCodeLine{00942\ \ \ \ \ \}}
\DoxyCodeLine{00943\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (rotation\ ==\ 3)}
\DoxyCodeLine{00944\ \ \ \ \ \{}
\DoxyCodeLine{00945\ \ \ \ \ \ \ uint16\_t\ tx\ =\ x;}
\DoxyCodeLine{00946\ \ \ \ \ \ \ x\ =\ y;}
\DoxyCodeLine{00947\ \ \ \ \ \ \ y\ =\ \_dwidth\ -\/\ tx\ -\/\ 1;}
\DoxyCodeLine{00948\ \ \ \ \ \}}
\DoxyCodeLine{00949\ \ \ \ \ \textcolor{comment}{//\ Return\ 1\ or\ 0}}
\DoxyCodeLine{00950\ \ \ \ \ \textcolor{keywordflow}{return}\ (\_img8[(x\ +\ y\ *\ \_bitwidth)>>3]\ >>\ (7-\/(x\ \&\ 0x7)))\ \&\ 0x01;}
\DoxyCodeLine{00951\ \ \ \}}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00953\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00954\ \}}
\DoxyCodeLine{00955\ }
\DoxyCodeLine{00956\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{00957\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ readPixel}}
\DoxyCodeLine{00958\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Read\ 565\ colour\ of\ a\ pixel\ at\ defined\ coordinates}}
\DoxyCodeLine{00959\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{00960\ uint16\_t\ TFT\_eSprite::readPixel(int32\_t\ x,\ int32\_t\ y)}
\DoxyCodeLine{00961\ \{}
\DoxyCodeLine{00962\ \ \ \textcolor{keywordflow}{if}\ (\_vpOoB\ \ ||\ !\_created)\ \textcolor{keywordflow}{return}\ 0xFFFF;}
\DoxyCodeLine{00963\ }
\DoxyCodeLine{00964\ \ \ x+=\ \_xDatum;}
\DoxyCodeLine{00965\ \ \ y+=\ \_yDatum;}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \textcolor{comment}{//\ Range\ checking}}
\DoxyCodeLine{00968\ \ \ \textcolor{keywordflow}{if}\ ((x\ <\ \_vpX)\ ||\ (y\ <\ \_vpY)\ ||(x\ >=\ \_vpW)\ ||\ (y\ >=\ \_vpH))\ \textcolor{keywordflow}{return}\ 0xFFFF;}
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00970\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{00971\ \ \ \{}
\DoxyCodeLine{00972\ \ \ \ \ uint16\_t\ color\ =\ \_img[x\ +\ y\ *\ \_iwidth];}
\DoxyCodeLine{00973\ \ \ \ \ \textcolor{keywordflow}{return}\ (color\ >>\ 8)\ |\ (color\ <<\ 8);}
\DoxyCodeLine{00974\ \ \ \}}
\DoxyCodeLine{00975\ }
\DoxyCodeLine{00976\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{00977\ \ \ \{}
\DoxyCodeLine{00978\ \ \ \ \ uint16\_t\ color\ =\ \_img8[x\ +\ y\ *\ \_iwidth];}
\DoxyCodeLine{00979\ \ \ \ \ \textcolor{keywordflow}{if}\ (color\ !=\ 0)}
\DoxyCodeLine{00980\ \ \ \ \ \{}
\DoxyCodeLine{00981\ \ \ \ \ uint8\_t\ \ blue[]\ =\ \{0,\ 11,\ 21,\ 31\};}
\DoxyCodeLine{00982\ \ \ \ \ \ \ color\ =\ \ \ (color\ \&\ 0xE0)<<8\ |\ (color\ \&\ 0xC0)<<5}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ (color\ \&\ 0x1C)<<6\ |\ (color\ \&\ 0x1C)<<3}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ blue[color\ \&\ 0x03];}
\DoxyCodeLine{00985\ \ \ \ \ \}}
\DoxyCodeLine{00986\ \ \ \ \ \textcolor{keywordflow}{return}\ color;}
\DoxyCodeLine{00987\ \ \ \}}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{00990\ \ \ \{}
\DoxyCodeLine{00991\ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ >=\ \_dwidth)\ \textcolor{keywordflow}{return}\ 0xFFFF;}
\DoxyCodeLine{00992\ \ \ \ \ uint16\_t\ color;}
\DoxyCodeLine{00993\ \ \ \ \ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{00994\ \ \ \ \ \ \ color\ =\ \_colorMap[\_img4[((x+y*\_iwidth)>>1)]\ >>\ 4];\ \ \ \textcolor{comment}{//\ even\ index\ =\ bits\ 7\ ..\ 4}}
\DoxyCodeLine{00995\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00996\ \ \ \ \ \ \ color\ =\ \_colorMap[\_img4[((x+y*\_iwidth)>>1)]\ \&\ 0x0F];\ \textcolor{comment}{//\ odd\ index\ =\ bits\ 3\ ..\ 0.}}
\DoxyCodeLine{00997\ \ \ \ \ \textcolor{keywordflow}{return}\ color;}
\DoxyCodeLine{00998\ \ \ \}}
\DoxyCodeLine{00999\ }
\DoxyCodeLine{01000\ \ \ \textcolor{comment}{//\ Note:\ Must\ be\ 1bpp}}
\DoxyCodeLine{01001\ \ \ \textcolor{comment}{//\ \_dwidth\ and\ \_dheight\ bounds\ not\ checked\ (rounded\ up\ -\/iwidth\ and\ \_iheight\ used)}}
\DoxyCodeLine{01002\ \ \ \textcolor{keywordflow}{if}\ (rotation\ ==\ 1)}
\DoxyCodeLine{01003\ \ \ \{}
\DoxyCodeLine{01004\ \ \ \ \ uint16\_t\ tx\ =\ x;}
\DoxyCodeLine{01005\ \ \ \ \ x\ =\ \_dheight\ -\/\ y\ -\/\ 1;}
\DoxyCodeLine{01006\ \ \ \ \ y\ =\ tx;}
\DoxyCodeLine{01007\ \ \ \}}
\DoxyCodeLine{01008\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (rotation\ ==\ 2)}
\DoxyCodeLine{01009\ \ \ \{}
\DoxyCodeLine{01010\ \ \ \ \ x\ =\ \_dwidth\ -\/\ x\ -\/\ 1;}
\DoxyCodeLine{01011\ \ \ \ \ y\ =\ \_dheight\ -\/\ y\ -\/\ 1;}
\DoxyCodeLine{01012\ \ \ \}}
\DoxyCodeLine{01013\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (rotation\ ==\ 3)}
\DoxyCodeLine{01014\ \ \ \{}
\DoxyCodeLine{01015\ \ \ \ \ uint16\_t\ tx\ =\ x;}
\DoxyCodeLine{01016\ \ \ \ \ x\ =\ y;}
\DoxyCodeLine{01017\ \ \ \ \ y\ =\ \_dwidth\ -\/\ tx\ -\/\ 1;}
\DoxyCodeLine{01018\ \ \ \}}
\DoxyCodeLine{01019\ }
\DoxyCodeLine{01020\ \ \ uint16\_t\ color\ =\ (\_img8[(x\ +\ y\ *\ \_bitwidth)>>3]\ <<\ (x\ \&\ 0x7))\ \&\ 0x80;}
\DoxyCodeLine{01021\ }
\DoxyCodeLine{01022\ \ \ \textcolor{keywordflow}{if}\ (color)\ \textcolor{keywordflow}{return}\ \_tft-\/>bitmap\_fg;}
\DoxyCodeLine{01023\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_tft-\/>bitmap\_bg;}
\DoxyCodeLine{01024\ \}}
\DoxyCodeLine{01025\ }
\DoxyCodeLine{01026\ }
\DoxyCodeLine{01027\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01028\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushImage}}
\DoxyCodeLine{01029\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ push\ image\ into\ a\ defined\ area\ of\ a\ sprite}}
\DoxyCodeLine{01030\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01031\ \textcolor{keywordtype}{void}\ \ TFT\_eSprite::pushImage(int32\_t\ x,\ int32\_t\ y,\ int32\_t\ w,\ int32\_t\ h,\ uint16\_t\ *data,\ uint8\_t\ sbpp)}
\DoxyCodeLine{01032\ \{}
\DoxyCodeLine{01033\ \ \ \textcolor{keywordflow}{if}\ (data\ ==\ \textcolor{keyword}{nullptr}\ ||\ !\_created)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01035\ \ \ PI\_CLIP;}
\DoxyCodeLine{01036\ }
\DoxyCodeLine{01037\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ \textcolor{comment}{//\ Plot\ a\ 16\ bpp\ image\ into\ a\ 16\ bpp\ Sprite}}
\DoxyCodeLine{01038\ \ \ \{}
\DoxyCodeLine{01039\ \ \ \ \ \textcolor{comment}{//\ Pointer\ within\ original\ image}}
\DoxyCodeLine{01040\ \ \ \ \ uint8\_t\ *ptro\ =\ (uint8\_t\ *)data\ +\ ((dx\ +\ dy\ *\ w)\ <<\ 1);}
\DoxyCodeLine{01041\ \ \ \ \ \textcolor{comment}{//\ Pointer\ within\ sprite\ image}}
\DoxyCodeLine{01042\ \ \ \ \ uint8\_t\ *ptrs\ =\ (uint8\_t\ *)\_img\ +\ ((x\ +\ y\ *\ \_iwidth)\ <<\ 1);}
\DoxyCodeLine{01043\ }
\DoxyCodeLine{01044\ \ \ \ \ \textcolor{keywordflow}{if}(\_swapBytes)}
\DoxyCodeLine{01045\ \ \ \ \ \{}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (dh-\/-\/)}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fast\ copy\ with\ a\ 1\ byte\ shift}}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ memcpy(ptrs+1,\ ptro,\ (dw<<1)\ -\/\ 1);}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ correct\ just\ the\ even\ numbered\ bytes}}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ xp\ =\ 0;\ xp\ <\ (dw<<1);\ xp+=2)}
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \ \ ptrs[xp]\ =\ ptro[xp+1];;}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ ptro\ +=\ w<<1;}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ ptrs\ +=\ \_iwidth<<1;}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01058\ \ \ \ \ \}}
\DoxyCodeLine{01059\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01060\ \ \ \ \ \{}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (dh-\/-\/)}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ memcpy(ptrs,\ ptro,\ dw<<1);}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ ptro\ +=\ w\ <<\ 1;}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ ptrs\ +=\ \_iwidth\ <<\ 1;}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01067\ \ \ \ \ \}}
\DoxyCodeLine{01068\ \ \ \}}
\DoxyCodeLine{01069\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8\ \&\&\ sbpp\ ==\ 8)\ \textcolor{comment}{//\ Plot\ a\ 8\ bpp\ image\ into\ a\ 8\ bpp\ Sprite}}
\DoxyCodeLine{01070\ \ \ \{}
\DoxyCodeLine{01071\ \ \ \ \ \textcolor{comment}{//\ Pointer\ within\ original\ image}}
\DoxyCodeLine{01072\ \ \ \ \ uint8\_t\ *ptro\ =\ (uint8\_t\ *)data\ +\ (dx\ +\ dy\ *\ w);}
\DoxyCodeLine{01073\ \ \ \ \ \textcolor{comment}{//\ Pointer\ within\ sprite\ image}}
\DoxyCodeLine{01074\ \ \ \ \ uint8\_t\ *ptrs\ =\ (uint8\_t\ *)\_img\ +\ (x\ +\ y\ *\ \_iwidth);}
\DoxyCodeLine{01075\ }
\DoxyCodeLine{01076\ \ \ \ \ \textcolor{keywordflow}{while}\ (dh-\/-\/)}
\DoxyCodeLine{01077\ \ \ \ \ \{}
\DoxyCodeLine{01078\ \ \ \ \ \ \ memcpy(ptrs,\ ptro,\ dw);}
\DoxyCodeLine{01079\ \ \ \ \ \ \ ptro\ +=\ w;}
\DoxyCodeLine{01080\ \ \ \ \ \ \ ptrs\ +=\ \_iwidth;}
\DoxyCodeLine{01081\ \ \ \ \ \}}
\DoxyCodeLine{01082\ \ \ \}}
\DoxyCodeLine{01083\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)\ \textcolor{comment}{//\ Plot\ a\ 16\ bpp\ image\ into\ a\ 8\ bpp\ Sprite}}
\DoxyCodeLine{01084\ \ \ \{}
\DoxyCodeLine{01085\ \ \ \ \ uint16\_t\ lastColor\ =\ 0;}
\DoxyCodeLine{01086\ \ \ \ \ uint8\_t\ \ color8\ \ \ \ =\ 0;}
\DoxyCodeLine{01087\ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ yp\ =\ dy;\ yp\ <\ dy\ +\ dh;\ yp++)}
\DoxyCodeLine{01088\ \ \ \ \ \{}
\DoxyCodeLine{01089\ \ \ \ \ \ \ int32\_t\ xyw\ =\ x\ +\ y\ *\ \_iwidth;}
\DoxyCodeLine{01090\ \ \ \ \ \ \ int32\_t\ dxypw\ =\ dx\ +\ yp\ *\ w;}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ xp\ =\ dx;\ xp\ <\ dx\ +\ dw;\ xp++)}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ uint16\_t\ color\ =\ data[dxypw++];}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\ !=\ lastColor)\ \{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ When\ data\ source\ is\ a\ sprite,\ the\ bytes\ are\ already\ swapped}}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\_swapBytes)\ color8\ =\ (uint8\_t)((color\ \&\ 0xE0)\ |\ (color\ \&\ 0x07)<<2\ |\ (color\ \&\ 0x1800)>>11);}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ color8\ =\ (uint8\_t)((color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3);}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ lastColor\ =\ color;}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \ \ \_img8[xyw++]\ =\ color8;}
\DoxyCodeLine{01101\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01102\ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01103\ \ \ \ \ \}}
\DoxyCodeLine{01104\ \ \ \}}
\DoxyCodeLine{01105\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01106\ \ \ \{}
\DoxyCodeLine{01107\ \ \ \ \ \textcolor{comment}{//\ The\ image\ is\ assumed\ to\ be\ 4-\/bit,\ where\ each\ byte\ corresponds\ to\ two\ pixels.}}
\DoxyCodeLine{01108\ \ \ \ \ \textcolor{comment}{//\ much\ faster\ when\ aligned\ to\ a\ byte\ boundary,\ because\ the\ alternative\ is\ slower,\ requiring}}
\DoxyCodeLine{01109\ \ \ \ \ \textcolor{comment}{//\ tedious\ bit\ operations.}}
\DoxyCodeLine{01110\ }
\DoxyCodeLine{01111\ \ \ \ \ \textcolor{keywordtype}{int}\ sWidth\ =\ (\_iwidth\ >>\ 1);}
\DoxyCodeLine{01112\ \ \ \ \ uint8\_t\ *ptr\ =\ (uint8\_t\ *)data;}
\DoxyCodeLine{01113\ }
\DoxyCodeLine{01114\ \ \ \ \ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 0\ \&\&\ (dx\ \&\ 0x01)\ ==\ 0\ \&\&\ (dw\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{01115\ \ \ \ \ \{}
\DoxyCodeLine{01116\ \ \ \ \ \ \ x\ =\ (x\ >>\ 1)\ +\ y\ *\ sWidth;}
\DoxyCodeLine{01117\ \ \ \ \ \ \ dw\ =\ (dw\ >>\ 1);}
\DoxyCodeLine{01118\ \ \ \ \ \ \ dx\ =\ (dx\ >>\ 1)\ +\ dy\ *\ (w>>1);}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (dh-\/-\/)}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ memcpy(\_img4\ +\ x,\ ptr\ +\ dx,\ dw);}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ dx\ +=\ (w\ >>\ 1);}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ x\ +=\ sWidth;}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01125\ \ \ \ \ \}}
\DoxyCodeLine{01126\ \ \ \ \ \textcolor{keywordflow}{else}\ \ \textcolor{comment}{//\ not\ optimized}}
\DoxyCodeLine{01127\ \ \ \ \ \{}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ yp\ =\ dy;\ yp\ <\ dy\ +\ dh;\ yp++)}
\DoxyCodeLine{01129\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ int32\_t\ ox\ =\ x;}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ xp\ =\ dx;\ xp\ <\ dx\ +\ dw;\ xp++)}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ uint32\_t\ color;}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((xp\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ color\ =\ (ptr[((xp+yp*w)>>1)]\ \&\ 0xF0)\ >>\ 4;\ \textcolor{comment}{//\ even\ index\ =\ bits\ 7\ ..\ 4}}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \ \ color\ =\ ptr[((xp-\/1+yp*w)>>1)]\ \&\ 0x0F;\ \ \ \ \ \ \textcolor{comment}{//\ odd\ index\ =\ bits\ 3\ ..\ 0.}}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ drawPixel(ox,\ y,\ color);}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ ox++;}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01143\ \ \ \ \ \}}
\DoxyCodeLine{01144\ \ \ \}}
\DoxyCodeLine{01145\ }
\DoxyCodeLine{01146\ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ 1bpp}}
\DoxyCodeLine{01147\ \ \ \{}
\DoxyCodeLine{01148\ \ \ \ \ \textcolor{comment}{//\ Plot\ a\ 1bpp\ image\ into\ a\ 1bpp\ Sprite}}
\DoxyCodeLine{01149\ \ \ \ \ uint32\_t\ ww\ =\ \ (w+7)>>3;\ \textcolor{comment}{//\ Width\ of\ source\ image\ line\ in\ bytes}}
\DoxyCodeLine{01150\ \ \ \ \ uint8\_t\ *ptr\ =\ (uint8\_t\ *)data;}
\DoxyCodeLine{01151\ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ yp\ =\ dy;\ \ yp\ <\ dy\ +\ dh;\ yp++)}
\DoxyCodeLine{01152\ \ \ \ \ \{}
\DoxyCodeLine{01153\ \ \ \ \ \ \ uint32\_t\ yw\ =\ yp\ *\ ww;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Byte\ starting\ the\ line\ containing\ source\ pixel}}
\DoxyCodeLine{01154\ \ \ \ \ \ \ int32\_t\ ox\ =\ x;}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ xp\ =\ dx;\ xp\ <\ dx\ +\ dw;\ xp++)}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ uint16\_t\ readPixel\ =\ (ptr[(xp>>3)\ +\ yw]\ \&\ (0x80\ >>\ (xp\ \&\ 0x7))\ );}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ drawPixel(ox++,\ y,\ readPixel);}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01160\ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01161\ \ \ \ \ \}}
\DoxyCodeLine{01162\ \ \ \}}
\DoxyCodeLine{01163\ \}}
\DoxyCodeLine{01164\ }
\DoxyCodeLine{01165\ }
\DoxyCodeLine{01166\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01167\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushImage}}
\DoxyCodeLine{01168\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ push\ 565\ colour\ FLASH\ (PROGMEM)\ image\ into\ a\ defined\ area}}
\DoxyCodeLine{01169\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01170\ \textcolor{keywordtype}{void}\ \ TFT\_eSprite::pushImage(int32\_t\ x,\ int32\_t\ y,\ int32\_t\ w,\ int32\_t\ h,\ \textcolor{keyword}{const}\ uint16\_t\ *data)}
\DoxyCodeLine{01171\ \{}
\DoxyCodeLine{01172\ \textcolor{preprocessor}{\#ifdef\ ESP32}}
\DoxyCodeLine{01173\ \ \ pushImage(x,\ y,\ w,\ h,\ (uint16\_t*)\ data);}
\DoxyCodeLine{01174\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01175\ \ \ \textcolor{comment}{//\ Partitioned\ memory\ FLASH\ processor}}
\DoxyCodeLine{01176\ \ \ \textcolor{keywordflow}{if}\ (data\ ==\ \textcolor{keyword}{nullptr}\ ||\ !\_created)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01177\ }
\DoxyCodeLine{01178\ \ \ PI\_CLIP;}
\DoxyCodeLine{01179\ }
\DoxyCodeLine{01180\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ \textcolor{comment}{//\ Plot\ a\ 16\ bpp\ image\ into\ a\ 16\ bpp\ Sprite}}
\DoxyCodeLine{01181\ \ \ \{}
\DoxyCodeLine{01182\ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ yp\ =\ dy;\ yp\ <\ dy\ +\ dh;\ yp++)}
\DoxyCodeLine{01183\ \ \ \ \ \{}
\DoxyCodeLine{01184\ \ \ \ \ \ \ int32\_t\ ox\ =\ x;}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ xp\ =\ dx;\ xp\ <\ dx\ +\ dw;\ xp++)}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ uint16\_t\ color\ =\ pgm\_read\_word(data\ +\ xp\ +\ yp\ *\ w);}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\_swapBytes)\ color\ =\ color<<8\ |\ color>>8;}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ \_img[ox\ +\ y\ *\ \_iwidth]\ =\ color;}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ ox++;}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01192\ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01193\ \ \ \ \ \}}
\DoxyCodeLine{01194\ \ \ \}}
\DoxyCodeLine{01195\ }
\DoxyCodeLine{01196\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)\ \textcolor{comment}{//\ Plot\ a\ 16\ bpp\ image\ into\ a\ 8\ bpp\ Sprite}}
\DoxyCodeLine{01197\ \ \ \{}
\DoxyCodeLine{01198\ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ yp\ =\ dy;\ yp\ <\ dy\ +\ dh;\ yp++)}
\DoxyCodeLine{01199\ \ \ \ \ \{}
\DoxyCodeLine{01200\ \ \ \ \ \ \ int32\_t\ ox\ =\ x;}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ xp\ =\ dx;\ xp\ <\ dx\ +\ dw;\ xp++)}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ uint16\_t\ color\ =\ pgm\_read\_word(data\ +\ xp\ +\ yp\ *\ w);}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\_swapBytes)\ color\ =\ color<<8\ |\ color>>8;}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \_img8[ox\ +\ y\ *\ \_iwidth]\ =\ (uint8\_t)((color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3);}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ ox++;}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01208\ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01209\ \ \ \ \ \}}
\DoxyCodeLine{01210\ \ \ \}}
\DoxyCodeLine{01211\ }
\DoxyCodeLine{01212\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01213\ \ \ \{}
\DoxyCodeLine{01214\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ TFT\_eSPI\_DEBUG}}
\DoxyCodeLine{01215\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}TFT\_eSprite::pushImage(int32\_t\ x,\ int32\_t\ y,\ int32\_t\ w,\ int32\_t\ h,\ const\ uint16\_t\ *data)\ not\ implemented"{}});}
\DoxyCodeLine{01216\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{01217\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01218\ \ \ \}}
\DoxyCodeLine{01219\ }
\DoxyCodeLine{01220\ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ Plot\ a\ 1bpp\ image\ into\ a\ 1bpp\ Sprite}}
\DoxyCodeLine{01221\ \ \ \{}
\DoxyCodeLine{01222\ \ \ \ \ x-\/=\ \_xDatum;\ \ \ \textcolor{comment}{//\ Remove\ offsets,\ drawPixel\ will\ add}}
\DoxyCodeLine{01223\ \ \ \ \ y-\/=\ \_yDatum;}
\DoxyCodeLine{01224\ \ \ \ \ uint16\_t\ bsw\ =\ \ (w+7)\ >>\ 3;\ \textcolor{comment}{//\ Width\ in\ bytes\ of\ source\ image\ line}}
\DoxyCodeLine{01225\ \ \ \ \ uint8\_t\ *ptr\ =\ ((uint8\_t*)data)\ +\ dy\ *\ bsw;}
\DoxyCodeLine{01226\ \ \ \ \ }
\DoxyCodeLine{01227\ \ \ \ \ \textcolor{keywordflow}{while}\ (dh-\/-\/)\ \{}
\DoxyCodeLine{01228\ \ \ \ \ \ \ int32\_t\ odx\ =\ dx;}
\DoxyCodeLine{01229\ \ \ \ \ \ \ int32\_t\ ox\ \ =\ x;}
\DoxyCodeLine{01230\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (odx\ <\ dx\ +\ dw)\ \{}
\DoxyCodeLine{01231\ \ \ \ \ \ \ \ \ uint8\_t\ pbyte\ =\ pgm\_read\_byte(ptr\ +\ (odx>>3));}
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ uint8\_t\ mask\ =\ 0x80\ >>\ (odx\ \&\ 7);}
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (mask)\ \{}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ p\ =\ pbyte\ \&\ mask;}
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ \ \ mask\ =\ mask\ >>\ 1;}
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ \ \ drawPixel(ox++,\ y,\ p);}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \ \ odx++;}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01239\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01240\ \ \ \ \ \ \ ptr\ +=\ bsw;}
\DoxyCodeLine{01241\ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01242\ \ \ \ \ \}}
\DoxyCodeLine{01243\ \ \ \}}
\DoxyCodeLine{01244\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ if\ ESP32\ check}}
\DoxyCodeLine{01245\ \}}
\DoxyCodeLine{01246\ }
\DoxyCodeLine{01247\ }
\DoxyCodeLine{01248\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01249\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ setWindow}}
\DoxyCodeLine{01250\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Set\ the\ bounds\ of\ a\ window\ in\ the\ sprite}}
\DoxyCodeLine{01251\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01252\ \textcolor{comment}{//\ Intentionally\ not\ constrained\ to\ viewport\ area,\ does\ not\ manage\ 1bpp\ rotations}}
\DoxyCodeLine{01253\ \textcolor{keywordtype}{void}\ TFT\_eSprite::setWindow(int32\_t\ x0,\ int32\_t\ y0,\ int32\_t\ x1,\ int32\_t\ y1)}
\DoxyCodeLine{01254\ \{}
\DoxyCodeLine{01255\ \ \ \textcolor{keywordflow}{if}\ (x0\ >\ x1)\ transpose(x0,\ x1);}
\DoxyCodeLine{01256\ \ \ \textcolor{keywordflow}{if}\ (y0\ >\ y1)\ transpose(y0,\ y1);}
\DoxyCodeLine{01257\ \ \ }
\DoxyCodeLine{01258\ \ \ int32\_t\ w\ =\ width();}
\DoxyCodeLine{01259\ \ \ int32\_t\ h\ =\ height();}
\DoxyCodeLine{01260\ }
\DoxyCodeLine{01261\ \ \ \textcolor{keywordflow}{if}\ ((x0\ >=\ w)\ ||\ (x1\ <\ 0)\ ||\ (y0\ >=\ h)\ ||\ (y1\ <\ 0))}
\DoxyCodeLine{01262\ \ \ \{\ \textcolor{comment}{//\ Point\ to\ that\ extra\ "{}off\ screen"{}\ pixel}}
\DoxyCodeLine{01263\ \ \ \ \ \_xs\ =\ 0;}
\DoxyCodeLine{01264\ \ \ \ \ \_ys\ =\ \_dheight;}
\DoxyCodeLine{01265\ \ \ \ \ \_xe\ =\ 0;}
\DoxyCodeLine{01266\ \ \ \ \ \_ye\ =\ \_dheight;}
\DoxyCodeLine{01267\ \ \ \}}
\DoxyCodeLine{01268\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01269\ \ \ \{}
\DoxyCodeLine{01270\ \ \ \ \ \textcolor{keywordflow}{if}\ (x0\ <\ 0)\ x0\ =\ 0;}
\DoxyCodeLine{01271\ \ \ \ \ \textcolor{keywordflow}{if}\ (x1\ >=\ w)\ x1\ =\ w\ -\/\ 1;}
\DoxyCodeLine{01272\ \ \ \ \ \textcolor{keywordflow}{if}\ (y0\ <\ 0)\ y0\ =\ 0;}
\DoxyCodeLine{01273\ \ \ \ \ \textcolor{keywordflow}{if}\ (y1\ >=\ h)\ y1\ =\ h\ -\/\ 1;}
\DoxyCodeLine{01274\ }
\DoxyCodeLine{01275\ \ \ \ \ \_xs\ =\ x0;}
\DoxyCodeLine{01276\ \ \ \ \ \_ys\ =\ y0;}
\DoxyCodeLine{01277\ \ \ \ \ \_xe\ =\ x1;}
\DoxyCodeLine{01278\ \ \ \ \ \_ye\ =\ y1;}
\DoxyCodeLine{01279\ \ \ \}}
\DoxyCodeLine{01280\ }
\DoxyCodeLine{01281\ \ \ \_xptr\ =\ \_xs;}
\DoxyCodeLine{01282\ \ \ \_yptr\ =\ \_ys;}
\DoxyCodeLine{01283\ \}}
\DoxyCodeLine{01284\ }
\DoxyCodeLine{01285\ }
\DoxyCodeLine{01286\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01287\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushColor}}
\DoxyCodeLine{01288\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Send\ a\ new\ pixel\ to\ the\ set\ window}}
\DoxyCodeLine{01289\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01290\ \textcolor{keywordtype}{void}\ TFT\_eSprite::pushColor(uint16\_t\ color)}
\DoxyCodeLine{01291\ \{}
\DoxyCodeLine{01292\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01293\ }
\DoxyCodeLine{01294\ \ \ \textcolor{comment}{//\ Write\ the\ colour\ to\ RAM\ in\ set\ window}}
\DoxyCodeLine{01295\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{01296\ \ \ \ \ \_img\ [\_xptr\ +\ \_yptr\ *\ \_iwidth]\ =\ (uint16\_t)\ (color\ >>\ 8)\ |\ (color\ <<\ 8);}
\DoxyCodeLine{01297\ }
\DoxyCodeLine{01298\ \ \ \textcolor{keywordflow}{else}\ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01299\ \ \ \ \ \_img8[\_xptr\ +\ \_yptr\ *\ \_iwidth]\ =\ (uint8\_t\ )((color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3);}
\DoxyCodeLine{01300\ }
\DoxyCodeLine{01301\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01302\ \ \ \{}
\DoxyCodeLine{01303\ \ \ \ \ uint8\_t\ c\ =\ (uint8\_t)color\ \&\ 0x0F;}
\DoxyCodeLine{01304\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_xptr\ \&\ 0x01)\ ==\ 0)\ \{}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ =\ (c\ <<\ 4)\ |\ (\_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ \&\ 0x0F);\ \ \textcolor{comment}{//\ new\ color\ is\ in\ bits\ 7\ ..\ 4}}
\DoxyCodeLine{01306\ \ \ \ \ \}}
\DoxyCodeLine{01307\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ =\ (\_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ \&\ 0xF0)\ |\ c;\ \textcolor{comment}{//\ new\ color\ is\ the\ low\ bits}}
\DoxyCodeLine{01309\ \ \ \ \ \}}
\DoxyCodeLine{01310\ \ \ \}}
\DoxyCodeLine{01311\ }
\DoxyCodeLine{01312\ \ \ \textcolor{keywordflow}{else}\ drawPixel(\_xptr,\ \_yptr,\ color);}
\DoxyCodeLine{01313\ }
\DoxyCodeLine{01314\ \ \ \textcolor{comment}{//\ Increment\ x}}
\DoxyCodeLine{01315\ \ \ \_xptr++;}
\DoxyCodeLine{01316\ }
\DoxyCodeLine{01317\ \ \ \textcolor{comment}{//\ Wrap\ on\ x\ and\ y\ to\ start,\ increment\ y\ if\ needed}}
\DoxyCodeLine{01318\ \ \ \textcolor{keywordflow}{if}\ (\_xptr\ >\ \_xe)}
\DoxyCodeLine{01319\ \ \ \{}
\DoxyCodeLine{01320\ \ \ \ \ \_xptr\ =\ \_xs;}
\DoxyCodeLine{01321\ \ \ \ \ \_yptr++;}
\DoxyCodeLine{01322\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_yptr\ >\ \_ye)\ \_yptr\ =\ \_ys;}
\DoxyCodeLine{01323\ \ \ \}}
\DoxyCodeLine{01324\ }
\DoxyCodeLine{01325\ \}}
\DoxyCodeLine{01326\ }
\DoxyCodeLine{01327\ }
\DoxyCodeLine{01328\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01329\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ pushColor}}
\DoxyCodeLine{01330\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Send\ a\ "{}len"{}\ new\ pixels\ to\ the\ set\ window}}
\DoxyCodeLine{01331\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01332\ \textcolor{keywordtype}{void}\ TFT\_eSprite::pushColor(uint16\_t\ color,\ uint32\_t\ len)}
\DoxyCodeLine{01333\ \{}
\DoxyCodeLine{01334\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01335\ }
\DoxyCodeLine{01336\ \ \ uint16\_t\ pixelColor;}
\DoxyCodeLine{01337\ }
\DoxyCodeLine{01338\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{01339\ \ \ \ \ pixelColor\ =\ (uint16\_t)\ (color\ >>\ 8)\ |\ (color\ <<\ 8);}
\DoxyCodeLine{01340\ }
\DoxyCodeLine{01341\ \ \ \textcolor{keywordflow}{else}\ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01342\ \ \ \ \ pixelColor\ =\ (color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3;}
\DoxyCodeLine{01343\ }
\DoxyCodeLine{01344\ \ \ \textcolor{keywordflow}{else}\ pixelColor\ =\ (uint16\_t)\ color;\ \textcolor{comment}{//\ for\ 1bpp\ or\ 4bpp}}
\DoxyCodeLine{01345\ }
\DoxyCodeLine{01346\ \ \ \textcolor{keywordflow}{while}(len-\/-\/)\ writeColor(pixelColor);}
\DoxyCodeLine{01347\ \}}
\DoxyCodeLine{01348\ }
\DoxyCodeLine{01349\ }
\DoxyCodeLine{01350\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01351\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ writeColor}}
\DoxyCodeLine{01352\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Write\ a\ pixel\ with\ pre-\/formatted\ colour\ to\ the\ set\ window}}
\DoxyCodeLine{01353\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01354\ \textcolor{keywordtype}{void}\ TFT\_eSprite::writeColor(uint16\_t\ color)}
\DoxyCodeLine{01355\ \{}
\DoxyCodeLine{01356\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01357\ }
\DoxyCodeLine{01358\ \ \ \textcolor{comment}{//\ Write\ 16-\/bit\ RGB\ 565\ encoded\ colour\ to\ RAM}}
\DoxyCodeLine{01359\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ \_img\ [\_xptr\ +\ \_yptr\ *\ \_iwidth]\ =\ color;}
\DoxyCodeLine{01360\ }
\DoxyCodeLine{01361\ \ \ \textcolor{comment}{//\ Write\ 8-\/bit\ RGB\ 332\ encoded\ colour\ to\ RAM}}
\DoxyCodeLine{01362\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)\ \_img8[\_xptr\ +\ \_yptr\ *\ \_iwidth]\ =\ (uint8\_t)\ color;}
\DoxyCodeLine{01363\ }
\DoxyCodeLine{01364\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01365\ \ \ \{}
\DoxyCodeLine{01366\ \ \ \ \ uint8\_t\ c\ =\ (uint8\_t)color\ \&\ 0x0F;}
\DoxyCodeLine{01367\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_xptr\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{01368\ \ \ \ \ \ \ \_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ =\ (c\ <<\ 4)\ |\ (\_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ \&\ 0x0F);\ \ \textcolor{comment}{//\ new\ color\ is\ in\ bits\ 7\ ..\ 4}}
\DoxyCodeLine{01369\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ =\ (\_img4[(\_xptr\ +\ \_yptr\ *\ \_iwidth)>>1]\ \&\ 0xF0)\ |\ c;\ \textcolor{comment}{//\ new\ color\ is\ the\ low\ bits\ (x\ is\ odd)}}
\DoxyCodeLine{01371\ \ \ \}}
\DoxyCodeLine{01372\ }
\DoxyCodeLine{01373\ \ \ \textcolor{keywordflow}{else}\ drawPixel(\_xptr,\ \_yptr,\ color);}
\DoxyCodeLine{01374\ }
\DoxyCodeLine{01375\ \ \ \textcolor{comment}{//\ Increment\ x}}
\DoxyCodeLine{01376\ \ \ \_xptr++;}
\DoxyCodeLine{01377\ }
\DoxyCodeLine{01378\ \ \ \textcolor{comment}{//\ Wrap\ on\ x\ and\ y\ to\ start,\ increment\ y\ if\ needed}}
\DoxyCodeLine{01379\ \ \ \textcolor{keywordflow}{if}\ (\_xptr\ >\ \_xe)}
\DoxyCodeLine{01380\ \ \ \{}
\DoxyCodeLine{01381\ \ \ \ \ \_xptr\ =\ \_xs;}
\DoxyCodeLine{01382\ \ \ \ \ \_yptr++;}
\DoxyCodeLine{01383\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_yptr\ >\ \_ye)\ \_yptr\ =\ \_ys;}
\DoxyCodeLine{01384\ \ \ \}}
\DoxyCodeLine{01385\ \}}
\DoxyCodeLine{01386\ }
\DoxyCodeLine{01387\ }
\DoxyCodeLine{01388\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01389\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ setScrollRect}}
\DoxyCodeLine{01390\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Set\ scroll\ area\ within\ the\ sprite\ and\ the\ gap\ fill\ colour}}
\DoxyCodeLine{01391\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01392\ \textcolor{comment}{//\ Intentionally\ not\ constrained\ to\ viewport\ area}}
\DoxyCodeLine{01393\ \textcolor{keywordtype}{void}\ TFT\_eSprite::setScrollRect(int32\_t\ x,\ int32\_t\ y,\ int32\_t\ w,\ int32\_t\ h,\ uint16\_t\ color)}
\DoxyCodeLine{01394\ \{}
\DoxyCodeLine{01395\ \ \ \textcolor{keywordflow}{if}\ ((x\ >=\ \_iwidth)\ ||\ (y\ >=\ \_iheight)\ ||\ !\_created\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01396\ }
\DoxyCodeLine{01397\ \ \ \textcolor{keywordflow}{if}\ (x\ <\ 0)\ \{\ w\ +=\ x;\ x\ =\ 0;\ \}}
\DoxyCodeLine{01398\ \ \ \textcolor{keywordflow}{if}\ (y\ <\ 0)\ \{\ h\ +=\ y;\ y\ =\ 0;\ \}}
\DoxyCodeLine{01399\ }
\DoxyCodeLine{01400\ \ \ \textcolor{keywordflow}{if}\ ((x\ +\ w)\ >\ \_iwidth\ )\ w\ =\ \_iwidth\ \ -\/\ x;}
\DoxyCodeLine{01401\ \ \ \textcolor{keywordflow}{if}\ ((y\ +\ h)\ >\ \_iheight)\ h\ =\ \_iheight\ -\/\ y;}
\DoxyCodeLine{01402\ }
\DoxyCodeLine{01403\ \ \ \textcolor{keywordflow}{if}\ (\ w\ <\ 1\ ||\ h\ <\ 1)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01404\ }
\DoxyCodeLine{01405\ \ \ \_sx\ =\ x;}
\DoxyCodeLine{01406\ \ \ \_sy\ =\ y;}
\DoxyCodeLine{01407\ \ \ \_sw\ =\ w;}
\DoxyCodeLine{01408\ \ \ \_sh\ =\ h;}
\DoxyCodeLine{01409\ }
\DoxyCodeLine{01410\ \ \ \_scolor\ =\ color;}
\DoxyCodeLine{01411\ \}}
\DoxyCodeLine{01412\ }
\DoxyCodeLine{01413\ }
\DoxyCodeLine{01414\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01415\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ scroll}}
\DoxyCodeLine{01416\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Scroll\ dx,dy\ pixels,\ positive\ right,down,\ negative\ left,up}}
\DoxyCodeLine{01417\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01418\ \textcolor{keywordtype}{void}\ TFT\_eSprite::scroll(int16\_t\ dx,\ int16\_t\ dy)}
\DoxyCodeLine{01419\ \{}
\DoxyCodeLine{01420\ \ \ \textcolor{keywordflow}{if}\ (abs(dx)\ >=\ \_sw\ ||\ abs(dy)\ >=\ \_sh)}
\DoxyCodeLine{01421\ \ \ \{}
\DoxyCodeLine{01422\ \ \ \ \ fillRect\ (\_sx,\ \_sy,\ \_sw,\ \_sh,\ \_scolor);}
\DoxyCodeLine{01423\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01424\ \ \ \}}
\DoxyCodeLine{01425\ }
\DoxyCodeLine{01426\ \ \ \textcolor{comment}{//\ Fetch\ the\ scroll\ area\ width\ and\ height\ set\ by\ setScrollRect()}}
\DoxyCodeLine{01427\ \ \ uint32\_t\ w\ \ =\ \_sw\ -\/\ abs(dx);\ \textcolor{comment}{//\ line\ width\ to\ copy}}
\DoxyCodeLine{01428\ \ \ uint32\_t\ h\ \ =\ \_sh\ -\/\ abs(dy);\ \textcolor{comment}{//\ lines\ to\ copy}}
\DoxyCodeLine{01429\ \ \ int32\_t\ iw\ \ =\ \_iwidth;\ \ \ \ \ \ \ \textcolor{comment}{//\ rounded\ up\ width\ of\ sprite}}
\DoxyCodeLine{01430\ }
\DoxyCodeLine{01431\ \ \ \textcolor{comment}{//\ Fetch\ the\ x,y\ origin\ set\ by\ setScrollRect()}}
\DoxyCodeLine{01432\ \ \ uint32\_t\ tx\ =\ \_sx;\ \textcolor{comment}{//\ to\ x}}
\DoxyCodeLine{01433\ \ \ uint32\_t\ fx\ =\ \_sx;\ \textcolor{comment}{//\ from\ x}}
\DoxyCodeLine{01434\ \ \ uint32\_t\ ty\ =\ \_sy;\ \textcolor{comment}{//\ to\ y}}
\DoxyCodeLine{01435\ \ \ uint32\_t\ fy\ =\ \_sy;\ \textcolor{comment}{//\ from\ y}}
\DoxyCodeLine{01436\ }
\DoxyCodeLine{01437\ \ \ \textcolor{comment}{//\ Adjust\ for\ x\ delta}}
\DoxyCodeLine{01438\ \ \ \textcolor{keywordflow}{if}\ (dx\ <=\ 0)\ fx\ -\/=\ dx;}
\DoxyCodeLine{01439\ \ \ \textcolor{keywordflow}{else}\ tx\ +=\ dx;}
\DoxyCodeLine{01440\ }
\DoxyCodeLine{01441\ \ \ \textcolor{comment}{//\ Adjust\ for\ y\ delta}}
\DoxyCodeLine{01442\ \ \ \textcolor{keywordflow}{if}\ (dy\ <=\ 0)\ fy\ -\/=\ dy;}
\DoxyCodeLine{01443\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01444\ \ \ \{\ \textcolor{comment}{//\ Scrolling\ down\ so\ start\ copy\ from\ bottom}}
\DoxyCodeLine{01445\ \ \ \ \ ty\ =\ ty\ +\ \_sh\ -\/\ 1;\ \textcolor{comment}{//\ "{}To"{}\ pointer}}
\DoxyCodeLine{01446\ \ \ \ \ iw\ =\ -\/iw;\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pointer\ moves\ backwards}}
\DoxyCodeLine{01447\ \ \ \ \ fy\ =\ ty\ -\/\ dy;\ \ \ \ \ \ \textcolor{comment}{//\ "{}From"{}\ pointer}}
\DoxyCodeLine{01448\ \ \ \}}
\DoxyCodeLine{01449\ }
\DoxyCodeLine{01450\ \ \ \textcolor{comment}{//\ Calculate\ "{}from\ y"{}\ and\ "{}to\ y"{}\ pointers\ in\ RAM}}
\DoxyCodeLine{01451\ \ \ uint32\_t\ fyp\ =\ fx\ +\ fy\ *\ \_iwidth;}
\DoxyCodeLine{01452\ \ \ uint32\_t\ typ\ =\ tx\ +\ ty\ *\ \_iwidth;}
\DoxyCodeLine{01453\ }
\DoxyCodeLine{01454\ \ \ \textcolor{comment}{//\ Now\ move\ the\ pixels\ in\ RAM}}
\DoxyCodeLine{01455\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{01456\ \ \ \{}
\DoxyCodeLine{01457\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01458\ \ \ \ \ \{\ \textcolor{comment}{//\ move\ pixel\ lines\ (to,\ from,\ byte\ count)}}
\DoxyCodeLine{01459\ \ \ \ \ \ \ memmove(\ \_img\ +\ typ,\ \_img\ +\ fyp,\ w<<1);}
\DoxyCodeLine{01460\ \ \ \ \ \ \ typ\ +=\ iw;}
\DoxyCodeLine{01461\ \ \ \ \ \ \ fyp\ +=\ iw;}
\DoxyCodeLine{01462\ \ \ \ \ \}}
\DoxyCodeLine{01463\ \ \ \}}
\DoxyCodeLine{01464\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01465\ \ \ \{}
\DoxyCodeLine{01466\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01467\ \ \ \ \ \{\ \textcolor{comment}{//\ move\ pixel\ lines\ (to,\ from,\ byte\ count)}}
\DoxyCodeLine{01468\ \ \ \ \ \ \ memmove(\ \_img8\ +\ typ,\ \_img8\ +\ fyp,\ w);}
\DoxyCodeLine{01469\ \ \ \ \ \ \ typ\ +=\ iw;}
\DoxyCodeLine{01470\ \ \ \ \ \ \ fyp\ +=\ iw;}
\DoxyCodeLine{01471\ \ \ \ \ \}}
\DoxyCodeLine{01472\ \ \ \}}
\DoxyCodeLine{01473\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01474\ \ \ \{}
\DoxyCodeLine{01475\ \ \ \ \ \textcolor{comment}{//\ could\ optimize\ for\ scrolling\ by\ even\ \#\ pixels\ using\ memove\ (later)}}
\DoxyCodeLine{01476\ \ \ \ \ \textcolor{keywordflow}{if}\ (dx\ >\ \ 0)\ \{\ tx\ +=\ w;\ fx\ +=\ w;\ \}\ \textcolor{comment}{//\ Start\ from\ right\ edge}}
\DoxyCodeLine{01477\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01478\ \ \ \ \ \{\ \textcolor{comment}{//\ move\ pixels\ one\ by\ one}}
\DoxyCodeLine{01479\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint16\_t\ xp\ =\ 0;\ xp\ <\ w;\ xp++)}
\DoxyCodeLine{01480\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dx\ <=\ 0)\ drawPixel(tx\ +\ xp,\ ty,\ readPixelValue(fx\ +\ xp,\ fy));}
\DoxyCodeLine{01482\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dx\ >\ \ 0)\ drawPixel(tx\ -\/\ xp,\ ty,\ readPixelValue(fx\ -\/\ xp,\ fy));}
\DoxyCodeLine{01483\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01484\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dy\ <=\ 0)\ \ \{\ ty++;\ fy++;\ \}}
\DoxyCodeLine{01485\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \{\ ty-\/-\/;\ fy-\/-\/;\ \}}
\DoxyCodeLine{01486\ \ \ \ \ \}}
\DoxyCodeLine{01487\ \ \ \}}
\DoxyCodeLine{01488\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 1\ )}
\DoxyCodeLine{01489\ \ \ \{}
\DoxyCodeLine{01490\ \ \ \ \ \textcolor{keywordflow}{if}\ (dx\ >\ \ 0)\ \{\ tx\ +=\ w;\ fx\ +=\ w;\ \}\ \textcolor{comment}{//\ Start\ from\ right\ edge}}
\DoxyCodeLine{01491\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01492\ \ \ \ \ \{\ \textcolor{comment}{//\ move\ pixels\ one\ by\ one}}
\DoxyCodeLine{01493\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint16\_t\ xp\ =\ 0;\ xp\ <\ w;\ xp++)}
\DoxyCodeLine{01494\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dx\ <=\ 0)\ drawPixel(tx\ +\ xp,\ ty,\ readPixelValue(fx\ +\ xp,\ fy));}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dx\ >\ \ 0)\ drawPixel(tx\ -\/\ xp,\ ty,\ readPixelValue(fx\ -\/\ xp,\ fy));}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dy\ <=\ 0)\ \ \{\ ty++;\ fy++;\ \}}
\DoxyCodeLine{01499\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \{\ ty-\/-\/;\ fy-\/-\/;\ \}}
\DoxyCodeLine{01500\ \ \ \ \ \}}
\DoxyCodeLine{01501\ \ \ \}}
\DoxyCodeLine{01502\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Not\ 1,\ 4,\ 8\ or\ 16\ bpp}}
\DoxyCodeLine{01503\ }
\DoxyCodeLine{01504\ \ \ \textcolor{comment}{//\ Fill\ the\ gap\ left\ by\ the\ scrolling}}
\DoxyCodeLine{01505\ \ \ \textcolor{keywordflow}{if}\ (dx\ >\ 0)\ fillRect(\_sx,\ \_sy,\ dx,\ \_sh,\ \_scolor);}
\DoxyCodeLine{01506\ \ \ \textcolor{keywordflow}{if}\ (dx\ <\ 0)\ fillRect(\_sx\ +\ \_sw\ +\ dx,\ \_sy,\ -\/dx,\ \_sh,\ \_scolor);}
\DoxyCodeLine{01507\ \ \ \textcolor{keywordflow}{if}\ (dy\ >\ 0)\ fillRect(\_sx,\ \_sy,\ \_sw,\ dy,\ \_scolor);}
\DoxyCodeLine{01508\ \ \ \textcolor{keywordflow}{if}\ (dy\ <\ 0)\ fillRect(\_sx,\ \_sy\ +\ \_sh\ +\ dy,\ \_sw,\ -\/dy,\ \_scolor);}
\DoxyCodeLine{01509\ \}}
\DoxyCodeLine{01510\ }
\DoxyCodeLine{01511\ }
\DoxyCodeLine{01512\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01513\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ fillSprite}}
\DoxyCodeLine{01514\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Fill\ the\ whole\ sprite\ with\ defined\ colour}}
\DoxyCodeLine{01515\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01516\ \textcolor{keywordtype}{void}\ TFT\_eSprite::fillSprite(uint32\_t\ color)}
\DoxyCodeLine{01517\ \{}
\DoxyCodeLine{01518\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ ||\ \_vpOoB)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01519\ }
\DoxyCodeLine{01520\ \ \ \textcolor{comment}{//\ Use\ memset\ if\ possible\ as\ it\ is\ super\ fast}}
\DoxyCodeLine{01521\ \ \ \textcolor{keywordflow}{if}(\_xDatum\ ==\ 0\ \&\&\ \_yDatum\ ==\ 0\ \ \&\&\ \ \_xWidth\ ==\ width())}
\DoxyCodeLine{01522\ \ \ \{}
\DoxyCodeLine{01523\ \ \ \ \ \textcolor{keywordflow}{if}(\_bpp\ ==\ 16)\ \{}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (uint8\_t)color\ ==\ (uint8\_t)(color>>8)\ )\ \{}
\DoxyCodeLine{01525\ \ \ \ \ \ \ \ \ memset(\_img,\ \ (uint8\_t)color,\ \_iwidth\ *\ \_yHeight\ *\ 2);}
\DoxyCodeLine{01526\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01527\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ fillRect(\_vpX,\ \_vpY,\ \_xWidth,\ \_yHeight,\ color);}
\DoxyCodeLine{01528\ \ \ \ \ \}}
\DoxyCodeLine{01529\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01530\ \ \ \ \ \{}
\DoxyCodeLine{01531\ \ \ \ \ \ \ color\ =\ (color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3;}
\DoxyCodeLine{01532\ \ \ \ \ \ \ memset(\_img8,\ (uint8\_t)color,\ \_iwidth\ *\ \_yHeight);}
\DoxyCodeLine{01533\ \ \ \ \ \}}
\DoxyCodeLine{01534\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01535\ \ \ \ \ \{}
\DoxyCodeLine{01536\ \ \ \ \ \ \ uint8\_t\ c\ =\ ((color\ \&\ 0x0F)\ |\ (((color\ \&\ 0x0F)\ <<\ 4)\ \&\ 0xF0));}
\DoxyCodeLine{01537\ \ \ \ \ \ \ memset(\_img4,\ c,\ (\_iwidth\ *\ \_yHeight)\ >>\ 1);}
\DoxyCodeLine{01538\ \ \ \ \ \}}
\DoxyCodeLine{01539\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 1)}
\DoxyCodeLine{01540\ \ \ \ \ \{}
\DoxyCodeLine{01541\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(color)\ memset(\_img8,\ 0xFF,\ (\_bitwidth>>3)\ *\ \_dheight\ +\ 1);}
\DoxyCodeLine{01542\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ memset(\_img8,\ 0x00,\ (\_bitwidth>>3)\ *\ \_dheight\ +\ 1);}
\DoxyCodeLine{01543\ \ \ \ \ \}}
\DoxyCodeLine{01544\ \ \ \}}
\DoxyCodeLine{01545\ \ \ \textcolor{keywordflow}{else}\ fillRect(\_vpX\ -\/\ \_xDatum,\ \_vpY\ -\/\ \_yDatum,\ \_xWidth,\ \_yHeight,\ color);}
\DoxyCodeLine{01546\ \}}
\DoxyCodeLine{01547\ }
\DoxyCodeLine{01548\ }
\DoxyCodeLine{01549\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01550\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ width}}
\DoxyCodeLine{01551\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Return\ the\ width\ of\ sprite}}
\DoxyCodeLine{01552\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01553\ \textcolor{comment}{//\ Return\ the\ size\ of\ the\ sprite}}
\DoxyCodeLine{01554\ int16\_t\ TFT\_eSprite::width(\textcolor{keywordtype}{void})}
\DoxyCodeLine{01555\ \{}
\DoxyCodeLine{01556\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ )\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01558\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ >\ 1)\ \{}
\DoxyCodeLine{01559\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_vpDatum)\ \textcolor{keywordflow}{return}\ \_xWidth;}
\DoxyCodeLine{01560\ \ \ \ \ \textcolor{keywordflow}{return}\ \_dwidth;}
\DoxyCodeLine{01561\ \ \ \}}
\DoxyCodeLine{01562\ }
\DoxyCodeLine{01563\ \ \ \textcolor{keywordflow}{if}\ (rotation\ \&\ 1)\ \{}
\DoxyCodeLine{01564\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_vpDatum)\ \textcolor{keywordflow}{return}\ \_xWidth;}
\DoxyCodeLine{01565\ \ \ \ \ \textcolor{keywordflow}{return}\ \_dheight;}
\DoxyCodeLine{01566\ \ \ \}}
\DoxyCodeLine{01567\ }
\DoxyCodeLine{01568\ \ \ \textcolor{keywordflow}{if}\ (\_vpDatum)\ \textcolor{keywordflow}{return}\ \_xWidth;}
\DoxyCodeLine{01569\ \ \ \textcolor{keywordflow}{return}\ \_dwidth;}
\DoxyCodeLine{01570\ \}}
\DoxyCodeLine{01571\ }
\DoxyCodeLine{01572\ }
\DoxyCodeLine{01573\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01574\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ height}}
\DoxyCodeLine{01575\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Return\ the\ height\ of\ sprite}}
\DoxyCodeLine{01576\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01577\ int16\_t\ TFT\_eSprite::height(\textcolor{keywordtype}{void})}
\DoxyCodeLine{01578\ \{}
\DoxyCodeLine{01579\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ )\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01580\ }
\DoxyCodeLine{01581\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ >\ 1)\ \{}
\DoxyCodeLine{01582\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_vpDatum)\ \textcolor{keywordflow}{return}\ \_yHeight;}
\DoxyCodeLine{01583\ \ \ \ \ \textcolor{keywordflow}{return}\ \_dheight;}
\DoxyCodeLine{01584\ \ \ \}}
\DoxyCodeLine{01585\ }
\DoxyCodeLine{01586\ \ \ \textcolor{keywordflow}{if}\ (rotation\ \&\ 1)\ \{}
\DoxyCodeLine{01587\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_vpDatum)\ \textcolor{keywordflow}{return}\ \_yHeight;}
\DoxyCodeLine{01588\ \ \ \ \ \textcolor{keywordflow}{return}\ \_dwidth;}
\DoxyCodeLine{01589\ \ \ \}}
\DoxyCodeLine{01590\ }
\DoxyCodeLine{01591\ \ \ \textcolor{keywordflow}{if}\ (\_vpDatum)\ \textcolor{keywordflow}{return}\ \_yHeight;}
\DoxyCodeLine{01592\ \ \ \textcolor{keywordflow}{return}\ \_dheight;}
\DoxyCodeLine{01593\ \}}
\DoxyCodeLine{01594\ }
\DoxyCodeLine{01595\ }
\DoxyCodeLine{01596\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01597\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ setRotation}}
\DoxyCodeLine{01598\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Rotate\ coordinate\ frame\ for\ 1bpp\ sprite}}
\DoxyCodeLine{01599\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01600\ \textcolor{comment}{//\ Does\ nothing\ for\ 4,\ 8\ and\ 16\ bpp\ sprites.}}
\DoxyCodeLine{01601\ \textcolor{keywordtype}{void}\ TFT\_eSprite::setRotation(uint8\_t\ r)}
\DoxyCodeLine{01602\ \{}
\DoxyCodeLine{01603\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ !=\ 1)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01604\ }
\DoxyCodeLine{01605\ \ \ rotation\ =\ r;}
\DoxyCodeLine{01606\ \ \ }
\DoxyCodeLine{01607\ \ \ \textcolor{keywordflow}{if}\ (rotation\&1)\ \{}
\DoxyCodeLine{01608\ \ \ \ \ resetViewport();}
\DoxyCodeLine{01609\ \ \ \}}
\DoxyCodeLine{01610\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01611\ \ \ \ \ resetViewport();}
\DoxyCodeLine{01612\ \ \ \}}
\DoxyCodeLine{01613\ \}}
\DoxyCodeLine{01614\ }
\DoxyCodeLine{01615\ }
\DoxyCodeLine{01616\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01617\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ getRotation}}
\DoxyCodeLine{01618\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Get\ rotation\ for\ 1bpp\ sprite}}
\DoxyCodeLine{01619\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01620\ uint8\_t\ TFT\_eSprite::getRotation(\textcolor{keywordtype}{void})}
\DoxyCodeLine{01621\ \{}
\DoxyCodeLine{01622\ \ \ \textcolor{keywordflow}{return}\ rotation;}
\DoxyCodeLine{01623\ \}}
\DoxyCodeLine{01624\ }
\DoxyCodeLine{01625\ }
\DoxyCodeLine{01626\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01627\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ drawPixel}}
\DoxyCodeLine{01628\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ push\ a\ single\ pixel\ at\ an\ arbitrary\ position}}
\DoxyCodeLine{01629\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01630\ \textcolor{keywordtype}{void}\ TFT\_eSprite::drawPixel(int32\_t\ x,\ int32\_t\ y,\ uint32\_t\ color)}
\DoxyCodeLine{01631\ \{}
\DoxyCodeLine{01632\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ ||\ \_vpOoB)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01633\ }
\DoxyCodeLine{01634\ \ \ x+=\ \_xDatum;}
\DoxyCodeLine{01635\ \ \ y+=\ \_yDatum;}
\DoxyCodeLine{01636\ }
\DoxyCodeLine{01637\ \ \ \textcolor{comment}{//\ Range\ checking}}
\DoxyCodeLine{01638\ \ \ \textcolor{keywordflow}{if}\ ((x\ <\ \_vpX)\ ||\ (y\ <\ \_vpY)\ ||(x\ >=\ \_vpW)\ ||\ (y\ >=\ \_vpH))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01639\ }
\DoxyCodeLine{01640\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{01641\ \ \ \{}
\DoxyCodeLine{01642\ \ \ \ \ color\ =\ (color\ >>\ 8)\ |\ (color\ <<\ 8);}
\DoxyCodeLine{01643\ \ \ \ \ \_img[x+y*\_iwidth]\ =\ (uint16\_t)\ color;}
\DoxyCodeLine{01644\ \ \ \}}
\DoxyCodeLine{01645\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01646\ \ \ \{}
\DoxyCodeLine{01647\ \ \ \ \ \_img8[x+y*\_iwidth]\ =\ (uint8\_t)((color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3);}
\DoxyCodeLine{01648\ \ \ \}}
\DoxyCodeLine{01649\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01650\ \ \ \{}
\DoxyCodeLine{01651\ \ \ \ \ uint8\_t\ c\ =\ color\ \&\ 0x0F;}
\DoxyCodeLine{01652\ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ (x+y*\_iwidth)>>1;;}
\DoxyCodeLine{01653\ \ \ \ \ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 0)\ \{}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \_img4[index]\ =\ (uint8\_t)((c\ <<\ 4)\ |\ (\_img4[index]\ \&\ 0x0F));}
\DoxyCodeLine{01655\ \ \ \ \ \}}
\DoxyCodeLine{01656\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01657\ \ \ \ \ \ \ \_img4[index]\ =\ \ (uint8\_t)(c\ |\ (\_img4[index]\ \&\ 0xF0));}
\DoxyCodeLine{01658\ \ \ \ \ \}}
\DoxyCodeLine{01659\ \ \ \}}
\DoxyCodeLine{01660\ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ 1\ bpp}}
\DoxyCodeLine{01661\ \ \ \{}
\DoxyCodeLine{01662\ \ \ \ \ \textcolor{keywordflow}{if}\ (rotation\ ==\ 1)}
\DoxyCodeLine{01663\ \ \ \ \ \{}
\DoxyCodeLine{01664\ \ \ \ \ \ \ uint16\_t\ tx\ =\ x;}
\DoxyCodeLine{01665\ \ \ \ \ \ \ x\ =\ \_dwidth\ -\/\ y\ -\/\ 1;}
\DoxyCodeLine{01666\ \ \ \ \ \ \ y\ =\ tx;}
\DoxyCodeLine{01667\ \ \ \ \ \}}
\DoxyCodeLine{01668\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (rotation\ ==\ 2)}
\DoxyCodeLine{01669\ \ \ \ \ \{}
\DoxyCodeLine{01670\ \ \ \ \ \ \ x\ =\ \_dwidth\ -\/\ x\ -\/\ 1;}
\DoxyCodeLine{01671\ \ \ \ \ \ \ y\ =\ \_dheight\ -\/\ y\ -\/\ 1;}
\DoxyCodeLine{01672\ \ \ \ \ \}}
\DoxyCodeLine{01673\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (rotation\ ==\ 3)}
\DoxyCodeLine{01674\ \ \ \ \ \{}
\DoxyCodeLine{01675\ \ \ \ \ \ \ uint16\_t\ tx\ =\ x;}
\DoxyCodeLine{01676\ \ \ \ \ \ \ x\ =\ y;}
\DoxyCodeLine{01677\ \ \ \ \ \ \ y\ =\ \_dheight\ -\/\ tx\ -\/\ 1;}
\DoxyCodeLine{01678\ \ \ \ \ \}}
\DoxyCodeLine{01679\ }
\DoxyCodeLine{01680\ \ \ \ \ \textcolor{keywordflow}{if}\ (color)\ \_img8[(x\ +\ y\ *\ \_bitwidth)>>3]\ |=\ \ (0x80\ >>\ (x\ \&\ 0x7));}
\DoxyCodeLine{01681\ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \_img8[(x\ +\ y\ *\ \_bitwidth)>>3]\ \&=\ \string~(0x80\ >>\ (x\ \&\ 0x7));}
\DoxyCodeLine{01682\ \ \ \}}
\DoxyCodeLine{01683\ \}}
\DoxyCodeLine{01684\ }
\DoxyCodeLine{01685\ }
\DoxyCodeLine{01686\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01687\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ drawLine}}
\DoxyCodeLine{01688\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ draw\ a\ line\ between\ 2\ arbitrary\ points}}
\DoxyCodeLine{01689\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01690\ \textcolor{keywordtype}{void}\ TFT\_eSprite::drawLine(int32\_t\ x0,\ int32\_t\ y0,\ int32\_t\ x1,\ int32\_t\ y1,\ uint32\_t\ color)}
\DoxyCodeLine{01691\ \{}
\DoxyCodeLine{01692\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ ||\ \_vpOoB)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01693\ }
\DoxyCodeLine{01694\ \ \ \textcolor{comment}{//\_xDatum\ and\ \_yDatum\ Not\ added\ here,\ it\ is\ added\ by\ drawPixel\ \&\ drawFastxLine}}
\DoxyCodeLine{01695\ }
\DoxyCodeLine{01696\ \ \ \textcolor{keywordtype}{bool}\ steep\ =\ abs(y1\ -\/\ y0)\ >\ abs(x1\ -\/\ x0);}
\DoxyCodeLine{01697\ \ \ \textcolor{keywordflow}{if}\ (steep)\ \{}
\DoxyCodeLine{01698\ \ \ \ \ transpose(x0,\ y0);}
\DoxyCodeLine{01699\ \ \ \ \ transpose(x1,\ y1);}
\DoxyCodeLine{01700\ \ \ \}}
\DoxyCodeLine{01701\ }
\DoxyCodeLine{01702\ \ \ \textcolor{keywordflow}{if}\ (x0\ >\ x1)\ \{}
\DoxyCodeLine{01703\ \ \ \ \ transpose(x0,\ x1);}
\DoxyCodeLine{01704\ \ \ \ \ transpose(y0,\ y1);}
\DoxyCodeLine{01705\ \ \ \}}
\DoxyCodeLine{01706\ }
\DoxyCodeLine{01707\ \ \ int32\_t\ dx\ =\ x1\ -\/\ x0,\ dy\ =\ abs(y1\ -\/\ y0);;}
\DoxyCodeLine{01708\ }
\DoxyCodeLine{01709\ \ \ int32\_t\ err\ =\ dx\ >>\ 1,\ ystep\ =\ -\/1,\ xs\ =\ x0,\ dlen\ =\ 0;}
\DoxyCodeLine{01710\ }
\DoxyCodeLine{01711\ \ \ \textcolor{keywordflow}{if}\ (y0\ <\ y1)\ ystep\ =\ 1;}
\DoxyCodeLine{01712\ }
\DoxyCodeLine{01713\ \ \ \textcolor{comment}{//\ Split\ into\ steep\ and\ not\ steep\ for\ FastH/V\ separation}}
\DoxyCodeLine{01714\ \ \ \textcolor{keywordflow}{if}\ (steep)\ \{}
\DoxyCodeLine{01715\ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ x0\ <=\ x1;\ x0++)\ \{}
\DoxyCodeLine{01716\ \ \ \ \ \ \ dlen++;}
\DoxyCodeLine{01717\ \ \ \ \ \ \ err\ -\/=\ dy;}
\DoxyCodeLine{01718\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (err\ <\ 0)\ \{}
\DoxyCodeLine{01719\ \ \ \ \ \ \ \ \ err\ +=\ dx;}
\DoxyCodeLine{01720\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dlen\ ==\ 1)\ drawPixel(y0,\ xs,\ color);}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ drawFastVLine(y0,\ xs,\ dlen,\ color);}
\DoxyCodeLine{01722\ \ \ \ \ \ \ \ \ dlen\ =\ 0;\ y0\ +=\ ystep;\ xs\ =\ x0\ +\ 1;}
\DoxyCodeLine{01723\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01724\ \ \ \ \ \}}
\DoxyCodeLine{01725\ \ \ \ \ \textcolor{keywordflow}{if}\ (dlen)\ drawFastVLine(y0,\ xs,\ dlen,\ color);}
\DoxyCodeLine{01726\ \ \ \}}
\DoxyCodeLine{01727\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01728\ \ \ \{}
\DoxyCodeLine{01729\ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ x0\ <=\ x1;\ x0++)\ \{}
\DoxyCodeLine{01730\ \ \ \ \ \ \ dlen++;}
\DoxyCodeLine{01731\ \ \ \ \ \ \ err\ -\/=\ dy;}
\DoxyCodeLine{01732\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (err\ <\ 0)\ \{}
\DoxyCodeLine{01733\ \ \ \ \ \ \ \ \ err\ +=\ dx;}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dlen\ ==\ 1)\ drawPixel(xs,\ y0,\ color);}
\DoxyCodeLine{01735\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ drawFastHLine(xs,\ y0,\ dlen,\ color);}
\DoxyCodeLine{01736\ \ \ \ \ \ \ \ \ dlen\ =\ 0;\ y0\ +=\ ystep;\ xs\ =\ x0\ +\ 1;}
\DoxyCodeLine{01737\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01738\ \ \ \ \ \}}
\DoxyCodeLine{01739\ \ \ \ \ \textcolor{keywordflow}{if}\ (dlen)\ drawFastHLine(xs,\ y0,\ dlen,\ color);}
\DoxyCodeLine{01740\ \ \ \}}
\DoxyCodeLine{01741\ \}}
\DoxyCodeLine{01742\ }
\DoxyCodeLine{01743\ }
\DoxyCodeLine{01744\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01745\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ drawFastVLine}}
\DoxyCodeLine{01746\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ draw\ a\ vertical\ line}}
\DoxyCodeLine{01747\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01748\ \textcolor{keywordtype}{void}\ TFT\_eSprite::drawFastVLine(int32\_t\ x,\ int32\_t\ y,\ int32\_t\ h,\ uint32\_t\ color)}
\DoxyCodeLine{01749\ \{}
\DoxyCodeLine{01750\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ ||\ \_vpOoB)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01751\ }
\DoxyCodeLine{01752\ \ \ x+=\ \_xDatum;}
\DoxyCodeLine{01753\ \ \ y+=\ \_yDatum;}
\DoxyCodeLine{01754\ }
\DoxyCodeLine{01755\ \ \ \textcolor{comment}{//\ Clipping}}
\DoxyCodeLine{01756\ \ \ \textcolor{keywordflow}{if}\ ((x\ <\ \_vpX)\ ||\ (x\ >=\ \_vpW)\ ||\ (y\ >=\ \_vpH))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01757\ }
\DoxyCodeLine{01758\ \ \ \textcolor{keywordflow}{if}\ (y\ <\ \_vpY)\ \{\ h\ +=\ y\ -\/\ \_vpY;\ y\ =\ \_vpY;\ \}}
\DoxyCodeLine{01759\ }
\DoxyCodeLine{01760\ \ \ \textcolor{keywordflow}{if}\ ((y\ +\ h)\ >\ \_vpH)\ h\ =\ \_vpH\ -\/\ y;}
\DoxyCodeLine{01761\ }
\DoxyCodeLine{01762\ \ \ \textcolor{keywordflow}{if}\ (h\ <\ 1)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01763\ }
\DoxyCodeLine{01764\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{01765\ \ \ \{}
\DoxyCodeLine{01766\ \ \ \ \ color\ =\ (color\ >>\ 8)\ |\ (color\ <<\ 8);}
\DoxyCodeLine{01767\ \ \ \ \ int32\_t\ yp\ =\ x\ +\ \_iwidth\ *\ y;}
\DoxyCodeLine{01768\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)\ \{\_img[yp]\ =\ (uint16\_t)\ color;\ yp\ +=\ \_iwidth;\}}
\DoxyCodeLine{01769\ \ \ \}}
\DoxyCodeLine{01770\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01771\ \ \ \{}
\DoxyCodeLine{01772\ \ \ \ \ color\ =\ (color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3;}
\DoxyCodeLine{01773\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)\ \_img8[x\ +\ \_iwidth\ *\ y++]\ =\ (uint8\_t)\ color;}
\DoxyCodeLine{01774\ \ \ \}}
\DoxyCodeLine{01775\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01776\ \ \ \{}
\DoxyCodeLine{01777\ \ \ \ \ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{01778\ \ \ \ \ \{}
\DoxyCodeLine{01779\ \ \ \ \ \ \ uint8\_t\ c\ =\ (uint8\_t)\ (color\ \&\ 0xF)\ <<\ 4;}
\DoxyCodeLine{01780\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)\ \{}
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ \_img4[(x\ +\ \_iwidth\ *\ y)>>1]\ =\ (uint8\_t)\ (c\ |\ (\_img4[(x\ +\ \_iwidth\ *\ y)>>1]\ \&\ 0x0F));}
\DoxyCodeLine{01782\ \ \ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01783\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01784\ \ \ \ \ \}}
\DoxyCodeLine{01785\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01786\ \ \ \ \ \ \ uint8\_t\ c\ =\ (uint8\_t)color\ \&\ 0xF;}
\DoxyCodeLine{01787\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)\ \{}
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ \_img4[(x\ +\ \_iwidth\ *\ y)>>1]\ =\ (uint8\_t)\ (c\ |\ (\_img4[(x\ +\ \_iwidth\ *\ y)>>1]\ \&\ 0xF0));\ \textcolor{comment}{//\ x\ is\ odd;\ new\ color\ goes\ into\ the\ low\ bits.}}
\DoxyCodeLine{01789\ \ \ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01790\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01791\ \ \ \ \ \}}
\DoxyCodeLine{01792\ \ \ \}}
\DoxyCodeLine{01793\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01794\ \ \ \{}
\DoxyCodeLine{01795\ \ \ \ \ x\ -\/=\ \_xDatum;\ \textcolor{comment}{//\ Remove\ any\ offset\ as\ it\ will\ be\ added\ by\ drawPixel}}
\DoxyCodeLine{01796\ \ \ \ \ y\ -\/=\ \_yDatum;}
\DoxyCodeLine{01797\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01798\ \ \ \ \ \{}
\DoxyCodeLine{01799\ \ \ \ \ \ \ drawPixel(x,\ y++,\ color);}
\DoxyCodeLine{01800\ \ \ \ \ \}}
\DoxyCodeLine{01801\ \ \ \}}
\DoxyCodeLine{01802\ \}}
\DoxyCodeLine{01803\ }
\DoxyCodeLine{01804\ }
\DoxyCodeLine{01805\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01806\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ drawFastHLine}}
\DoxyCodeLine{01807\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ draw\ a\ horizontal\ line}}
\DoxyCodeLine{01808\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01809\ \textcolor{keywordtype}{void}\ TFT\_eSprite::drawFastHLine(int32\_t\ x,\ int32\_t\ y,\ int32\_t\ w,\ uint32\_t\ color)}
\DoxyCodeLine{01810\ \{}
\DoxyCodeLine{01811\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ ||\ \_vpOoB)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01812\ }
\DoxyCodeLine{01813\ \ \ x+=\ \_xDatum;}
\DoxyCodeLine{01814\ \ \ y+=\ \_yDatum;}
\DoxyCodeLine{01815\ }
\DoxyCodeLine{01816\ \ \ \textcolor{comment}{//\ Clipping}}
\DoxyCodeLine{01817\ \ \ \textcolor{keywordflow}{if}\ ((y\ <\ \_vpY)\ ||\ (x\ >=\ \_vpW)\ ||\ (y\ >=\ \_vpH))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01818\ }
\DoxyCodeLine{01819\ \ \ \textcolor{keywordflow}{if}\ (x\ <\ \_vpX)\ \{\ w\ +=\ x\ -\/\ \_vpX;\ x\ =\ \_vpX;\ \}}
\DoxyCodeLine{01820\ }
\DoxyCodeLine{01821\ \ \ \textcolor{keywordflow}{if}\ ((x\ +\ w)\ >\ \_vpW)\ w\ =\ \_vpW\ -\/\ x;}
\DoxyCodeLine{01822\ }
\DoxyCodeLine{01823\ \ \ \textcolor{keywordflow}{if}\ (w\ <\ 1)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01824\ }
\DoxyCodeLine{01825\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{01826\ \ \ \{}
\DoxyCodeLine{01827\ \ \ \ \ color\ =\ (color\ >>\ 8)\ |\ (color\ <<\ 8);}
\DoxyCodeLine{01828\ \ \ \ \ \textcolor{keywordflow}{while}\ (w-\/-\/)\ \_img[\_iwidth\ *\ y\ +\ x++]\ =\ (uint16\_t)\ color;}
\DoxyCodeLine{01829\ \ \ \}}
\DoxyCodeLine{01830\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01831\ \ \ \{}
\DoxyCodeLine{01832\ \ \ \ \ color\ =\ (color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3;}
\DoxyCodeLine{01833\ \ \ \ \ memset(\_img8+\_iwidth\ *\ y\ +\ x,\ (uint8\_t)color,\ w);}
\DoxyCodeLine{01834\ \ \ \}}
\DoxyCodeLine{01835\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01836\ \ \ \{}
\DoxyCodeLine{01837\ \ \ \ \ uint8\_t\ c\ =\ (uint8\_t)color\ \&\ 0x0F;}
\DoxyCodeLine{01838\ \ \ \ \ uint8\_t\ c2\ =\ (c\ |\ ((c\ <<\ 4)\ \&\ 0xF0));}
\DoxyCodeLine{01839\ \ \ \ \ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 1)}
\DoxyCodeLine{01840\ \ \ \ \ \{}
\DoxyCodeLine{01841\ \ \ \ \ \ \ drawPixel(x\ -\/\ \_xDatum,\ y\ -\/\ \_yDatum,\ color);}
\DoxyCodeLine{01842\ \ \ \ \ \ \ x++;\ w-\/-\/;}
\DoxyCodeLine{01843\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (w\ <\ 1)}
\DoxyCodeLine{01844\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01845\ \ \ \ \ \}}
\DoxyCodeLine{01846\ }
\DoxyCodeLine{01847\ \ \ \ \ \textcolor{keywordflow}{if}\ (((w\ +\ x)\ \&\ 0x01)\ ==\ 1)}
\DoxyCodeLine{01848\ \ \ \ \ \{}
\DoxyCodeLine{01849\ \ \ \ \ \ \ \textcolor{comment}{//\ handle\ the\ extra\ one\ at\ the\ other\ end}}
\DoxyCodeLine{01850\ \ \ \ \ \ \ drawPixel(x\ -\/\ \_xDatum\ +\ w\ -\/\ 1,\ y\ -\/\ \_yDatum,\ color);}
\DoxyCodeLine{01851\ \ \ \ \ \ \ w-\/-\/;}
\DoxyCodeLine{01852\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (w\ <\ 1)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01853\ \ \ \ \ \}}
\DoxyCodeLine{01854\ \ \ \ \ memset(\_img4\ +\ ((\_iwidth\ *\ y\ +\ x)\ >>\ 1),\ c2,\ (w\ >>\ 1));}
\DoxyCodeLine{01855\ \ \ \}}
\DoxyCodeLine{01856\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01857\ \ \ \ \ x\ -\/=\ \_xDatum;\ \textcolor{comment}{//\ Remove\ any\ offset\ as\ it\ will\ be\ added\ by\ drawPixel}}
\DoxyCodeLine{01858\ \ \ \ \ y\ -\/=\ \_yDatum;}
\DoxyCodeLine{01859\ }
\DoxyCodeLine{01860\ \ \ \ \ \textcolor{keywordflow}{while}\ (w-\/-\/)}
\DoxyCodeLine{01861\ \ \ \ \ \{}
\DoxyCodeLine{01862\ \ \ \ \ \ \ drawPixel(x++,\ y,\ color);}
\DoxyCodeLine{01863\ \ \ \ \ \}}
\DoxyCodeLine{01864\ \ \ \}}
\DoxyCodeLine{01865\ \}}
\DoxyCodeLine{01866\ }
\DoxyCodeLine{01867\ }
\DoxyCodeLine{01868\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01869\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ fillRect}}
\DoxyCodeLine{01870\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ draw\ a\ filled\ rectangle}}
\DoxyCodeLine{01871\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01872\ \textcolor{keywordtype}{void}\ TFT\_eSprite::fillRect(int32\_t\ x,\ int32\_t\ y,\ int32\_t\ w,\ int32\_t\ h,\ uint32\_t\ color)}
\DoxyCodeLine{01873\ \{}
\DoxyCodeLine{01874\ \ \ \textcolor{keywordflow}{if}\ (!\_created\ ||\ \_vpOoB)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01875\ }
\DoxyCodeLine{01876\ \ \ x+=\ \_xDatum;}
\DoxyCodeLine{01877\ \ \ y+=\ \_yDatum;}
\DoxyCodeLine{01878\ }
\DoxyCodeLine{01879\ \ \ \textcolor{comment}{//\ Clipping}}
\DoxyCodeLine{01880\ \ \ \textcolor{keywordflow}{if}\ ((x\ >=\ \_vpW)\ ||\ (y\ >=\ \_vpH))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01881\ }
\DoxyCodeLine{01882\ \ \ \textcolor{keywordflow}{if}\ (x\ <\ \_vpX)\ \{\ w\ +=\ x\ -\/\ \_vpX;\ x\ =\ \_vpX;\ \}}
\DoxyCodeLine{01883\ \ \ \textcolor{keywordflow}{if}\ (y\ <\ \_vpY)\ \{\ h\ +=\ y\ -\/\ \_vpY;\ y\ =\ \_vpY;\ \}}
\DoxyCodeLine{01884\ }
\DoxyCodeLine{01885\ \ \ \textcolor{keywordflow}{if}\ ((x\ +\ w)\ >\ \_vpW)\ w\ =\ \_vpW\ -\/\ x;}
\DoxyCodeLine{01886\ \ \ \textcolor{keywordflow}{if}\ ((y\ +\ h)\ >\ \_vpH)\ h\ =\ \_vpH\ -\/\ y;}
\DoxyCodeLine{01887\ }
\DoxyCodeLine{01888\ \ \ \textcolor{keywordflow}{if}\ ((w\ <\ 1)\ ||\ (h\ <\ 1))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01889\ }
\DoxyCodeLine{01890\ \ \ int32\_t\ yp\ =\ \_iwidth\ *\ y\ +\ x;}
\DoxyCodeLine{01891\ }
\DoxyCodeLine{01892\ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)}
\DoxyCodeLine{01893\ \ \ \{}
\DoxyCodeLine{01894\ \ \ \ \ color\ =\ (color\ >>\ 8)\ |\ (color\ <<\ 8);}
\DoxyCodeLine{01895\ \ \ \ \ uint32\_t\ iw\ =\ w;}
\DoxyCodeLine{01896\ \ \ \ \ int32\_t\ ys\ =\ yp;}
\DoxyCodeLine{01897\ \ \ \ \ \textcolor{keywordflow}{if}(h-\/-\/)\ \ \{\textcolor{keywordflow}{while}\ (iw-\/-\/)\ \_img[yp++]\ =\ (uint16\_t)\ color;\}}
\DoxyCodeLine{01898\ \ \ \ \ yp\ =\ ys;}
\DoxyCodeLine{01899\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01900\ \ \ \ \ \{}
\DoxyCodeLine{01901\ \ \ \ \ \ \ yp\ +=\ \_iwidth;}
\DoxyCodeLine{01902\ \ \ \ \ \ \ memcpy(\ \_img+yp,\ \_img+ys,\ w<<1);}
\DoxyCodeLine{01903\ \ \ \ \ \}}
\DoxyCodeLine{01904\ \ \ \}}
\DoxyCodeLine{01905\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)}
\DoxyCodeLine{01906\ \ \ \{}
\DoxyCodeLine{01907\ \ \ \ \ color\ =\ (color\ \&\ 0xE000)>>8\ |\ (color\ \&\ 0x0700)>>6\ |\ (color\ \&\ 0x0018)>>3;}
\DoxyCodeLine{01908\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01909\ \ \ \ \ \{}
\DoxyCodeLine{01910\ \ \ \ \ \ \ memset(\_img8\ +\ yp,\ (uint8\_t)color,\ w);}
\DoxyCodeLine{01911\ \ \ \ \ \ \ yp\ +=\ \_iwidth;}
\DoxyCodeLine{01912\ \ \ \ \ \}}
\DoxyCodeLine{01913\ \ \ \}}
\DoxyCodeLine{01914\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 4)}
\DoxyCodeLine{01915\ \ \ \{}
\DoxyCodeLine{01916\ \ \ \ \ uint8\_t\ c1\ =\ (uint8\_t)color\ \&\ 0x0F;}
\DoxyCodeLine{01917\ \ \ \ \ uint8\_t\ c2\ =\ c1\ |\ ((c1\ <<\ 4)\ \&\ 0xF0);}
\DoxyCodeLine{01918\ \ \ \ \ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 0\ \&\&\ (w\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{01919\ \ \ \ \ \{}
\DoxyCodeLine{01920\ \ \ \ \ \ \ yp\ =\ (yp\ >>\ 1);}
\DoxyCodeLine{01921\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01922\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01923\ \ \ \ \ \ \ \ \ memset(\_img4\ +\ yp,\ c2,\ (w>>1));}
\DoxyCodeLine{01924\ \ \ \ \ \ \ \ \ yp\ +=\ (\_iwidth\ >>\ 1);}
\DoxyCodeLine{01925\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01926\ \ \ \ \ \}}
\DoxyCodeLine{01927\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((x\ \&\ 0x01)\ ==\ 0)}
\DoxyCodeLine{01928\ \ \ \ \ \{}
\DoxyCodeLine{01929\ }
\DoxyCodeLine{01930\ \ \ \ \ \ \ \textcolor{comment}{//\ same\ as\ above\ but\ you\ have\ a\ hangover\ on\ the\ right.}}
\DoxyCodeLine{01931\ \ \ \ \ \ \ yp\ =\ (yp\ >>\ 1);}
\DoxyCodeLine{01932\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01933\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01934\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (w\ >\ 1)}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \ \ \ \ memset(\_img4\ +\ yp,\ c2,\ (w-\/1)>>1);}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ handle\ the\ rightmost\ pixel\ by\ calling\ drawPixel}}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \ \ drawPixel(x+w-\/1-\/\_xDatum,\ y+h-\/\_yDatum,\ c1);}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \ \ yp\ +=\ (\_iwidth\ >>\ 1);}
\DoxyCodeLine{01939\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01940\ \ \ \ \ \}}
\DoxyCodeLine{01941\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((w\ \&\ 0x01)\ ==\ 1)}
\DoxyCodeLine{01942\ \ \ \ \ \{}
\DoxyCodeLine{01943\ \ \ \ \ \ \ yp\ =\ (yp\ +\ 1)\ >>\ 1;}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)\ \{}
\DoxyCodeLine{01945\ \ \ \ \ \ \ \ \ drawPixel(x-\/\_xDatum,\ y+h-\/\_yDatum,\ color\ \&\ 0x0F);}
\DoxyCodeLine{01946\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (w\ >\ 1)}
\DoxyCodeLine{01947\ \ \ \ \ \ \ \ \ \ \ memset(\_img4\ +\ yp,\ c2,\ (w-\/1)>>1);}
\DoxyCodeLine{01948\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ same\ as\ above\ but\ you\ have\ a\ hangover\ on\ the\ left\ instead}}
\DoxyCodeLine{01949\ \ \ \ \ \ \ \ \ yp\ +=\ (\_iwidth\ >>\ 1);}
\DoxyCodeLine{01950\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01951\ \ \ \ \ \}}
\DoxyCodeLine{01952\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01953\ \ \ \ \ \{}
\DoxyCodeLine{01954\ \ \ \ \ \ \ yp\ =\ (yp\ +\ 1)\ >>\ 1;}
\DoxyCodeLine{01955\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)\ \{}
\DoxyCodeLine{01956\ \ \ \ \ \ \ \ \ drawPixel(x-\/\_xDatum,\ y+h-\/\_yDatum,\ color\ \&\ 0x0F);}
\DoxyCodeLine{01957\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (w\ >\ 1)\ drawPixel(x+w-\/1-\/\_xDatum,\ y+h-\/\_yDatum,\ color\ \&\ 0x0F);}
\DoxyCodeLine{01958\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (w\ >\ 2)}
\DoxyCodeLine{01959\ \ \ \ \ \ \ \ \ \ \ memset(\_img4\ +\ yp,\ c2,\ (w-\/2)>>1);}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ maximal\ hacking,\ single\ pixels\ on\ left\ and\ right.}}
\DoxyCodeLine{01961\ \ \ \ \ \ \ \ \ yp\ +=\ (\_iwidth\ >>\ 1);}
\DoxyCodeLine{01962\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01963\ \ \ \ \ \}}
\DoxyCodeLine{01964\ \ \ \}}
\DoxyCodeLine{01965\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01966\ \ \ \{}
\DoxyCodeLine{01967\ \ \ \ \ x\ -\/=\ \_xDatum;}
\DoxyCodeLine{01968\ \ \ \ \ y\ -\/=\ \_yDatum;}
\DoxyCodeLine{01969\ \ \ \ \ \textcolor{keywordflow}{while}\ (h-\/-\/)}
\DoxyCodeLine{01970\ \ \ \ \ \{}
\DoxyCodeLine{01971\ \ \ \ \ \ \ int32\_t\ ww\ =\ w;}
\DoxyCodeLine{01972\ \ \ \ \ \ \ int32\_t\ xx\ =\ x;}
\DoxyCodeLine{01973\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (ww-\/-\/)\ drawPixel(xx++,\ y,\ color);}
\DoxyCodeLine{01974\ \ \ \ \ \ \ y++;}
\DoxyCodeLine{01975\ \ \ \ \ \}}
\DoxyCodeLine{01976\ \ \ \}}
\DoxyCodeLine{01977\ \}}
\DoxyCodeLine{01978\ }
\DoxyCodeLine{01979\ }
\DoxyCodeLine{01980\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{01981\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ drawChar}}
\DoxyCodeLine{01982\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ draw\ a\ single\ character\ in\ the\ Adafruit\ GLCD\ or\ freefont}}
\DoxyCodeLine{01983\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{01984\ \textcolor{keywordtype}{void}\ TFT\_eSprite::drawChar(int32\_t\ x,\ int32\_t\ y,\ uint16\_t\ c,\ uint32\_t\ color,\ uint32\_t\ bg,\ uint8\_t\ size)}
\DoxyCodeLine{01985\ \{}
\DoxyCodeLine{01986\ \ \ \textcolor{keywordflow}{if}\ (\ \_vpOoB\ ||\ !\_created\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01987\ }
\DoxyCodeLine{01988\ \ \ \textcolor{keywordflow}{if}\ (c\ <\ 32)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01989\ \textcolor{preprocessor}{\#ifdef\ LOAD\_GLCD}}
\DoxyCodeLine{01990\ \textcolor{comment}{//>>>>>>>>>>>>>>>>>>}}
\DoxyCodeLine{01991\ \textcolor{preprocessor}{\#ifdef\ LOAD\_GFXFF}}
\DoxyCodeLine{01992\ \ \ \textcolor{keywordflow}{if}(!gfxFont)\ \{\ \textcolor{comment}{//\ 'Classic'\ built-\/in\ font}}
\DoxyCodeLine{01993\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01994\ \textcolor{comment}{//>>>>>>>>>>>>>>>>>>}}
\DoxyCodeLine{01995\ }
\DoxyCodeLine{01996\ \ \ \textcolor{keywordflow}{if}\ ((x\ >=\ \_vpW\ -\/\ \_xDatum)\ ||\ \textcolor{comment}{//\ Clip\ right}}
\DoxyCodeLine{01997\ \ \ \ \ \ \ (y\ >=\ \_vpH\ -\/\ \_yDatum))\ \ \ \textcolor{comment}{//\ Clip\ bottom}}
\DoxyCodeLine{01998\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01999\ }
\DoxyCodeLine{02000\ \ \ \textcolor{keywordflow}{if}\ (((x\ +\ 6\ *\ size\ -\/\ 1)\ <\ (\_vpX\ -\/\ \_xDatum))\ ||\ \textcolor{comment}{//\ Clip\ left}}
\DoxyCodeLine{02001\ \ \ \ \ \ \ ((y\ +\ 8\ *\ size\ -\/\ 1)\ <\ (\_vpY\ -\/\ \_yDatum)))\ \ \ \textcolor{comment}{//\ Clip\ top}}
\DoxyCodeLine{02002\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02003\ }
\DoxyCodeLine{02004\ \ \ \textcolor{keywordflow}{if}\ (c\ >\ 255)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02005\ \ \ \textcolor{keywordflow}{if}\ (!\_cp437\ \&\&\ c\ >\ 175)\ c++;}
\DoxyCodeLine{02006\ }
\DoxyCodeLine{02007\ \ \ \textcolor{keywordtype}{bool}\ fillbg\ =\ (bg\ !=\ color);}
\DoxyCodeLine{02008\ }
\DoxyCodeLine{02009\ \ \ \textcolor{keywordflow}{if}\ ((size==1)\ \&\&\ fillbg)}
\DoxyCodeLine{02010\ \ \ \{}
\DoxyCodeLine{02011\ \ \ \ \ uint8\_t\ column[6];}
\DoxyCodeLine{02012\ \ \ \ \ uint8\_t\ mask\ =\ 0x1;}
\DoxyCodeLine{02013\ }
\DoxyCodeLine{02014\ \ \ \ \ \textcolor{keywordflow}{for}\ (int8\_t\ i\ =\ 0;\ i\ <\ 5;\ i++\ )\ column[i]\ =\ pgm\_read\_byte(font\ +\ (c\ *\ 5)\ +\ i);}
\DoxyCodeLine{02015\ \ \ \ \ column[5]\ =\ 0;}
\DoxyCodeLine{02016\ }
\DoxyCodeLine{02017\ \ \ \ \ int8\_t\ j,\ k;}
\DoxyCodeLine{02018\ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ 8;\ j++)\ \{}
\DoxyCodeLine{02019\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (k\ =\ 0;\ k\ <\ 5;\ k++\ )\ \{}
\DoxyCodeLine{02020\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (column[k]\ \&\ mask)\ \{}
\DoxyCodeLine{02021\ \ \ \ \ \ \ \ \ \ \ drawPixel(x\ +\ k,\ y\ +\ j,\ color);}
\DoxyCodeLine{02022\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02024\ \ \ \ \ \ \ \ \ \ \ drawPixel(x\ +\ k,\ y\ +\ j,\ bg);}
\DoxyCodeLine{02025\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02026\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02027\ }
\DoxyCodeLine{02028\ \ \ \ \ \ \ mask\ <<=\ 1;}
\DoxyCodeLine{02029\ }
\DoxyCodeLine{02030\ \ \ \ \ \ \ drawPixel(x\ +\ k,\ y\ +\ j,\ bg);}
\DoxyCodeLine{02031\ \ \ \ \ \}}
\DoxyCodeLine{02032\ \ \ \}}
\DoxyCodeLine{02033\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02034\ \ \ \{}
\DoxyCodeLine{02035\ \ \ \ \ \textcolor{keywordflow}{for}\ (int8\_t\ i\ =\ 0;\ i\ <\ 6;\ i++\ )\ \{}
\DoxyCodeLine{02036\ \ \ \ \ \ \ uint8\_t\ line;}
\DoxyCodeLine{02037\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ 5)}
\DoxyCodeLine{02038\ \ \ \ \ \ \ \ \ line\ =\ 0x0;}
\DoxyCodeLine{02039\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02040\ \ \ \ \ \ \ \ \ line\ =\ pgm\_read\_byte(font\ +\ (c\ *\ 5)\ +\ i);}
\DoxyCodeLine{02041\ }
\DoxyCodeLine{02042\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (size\ ==\ 1)\ \textcolor{comment}{//\ default\ size}}
\DoxyCodeLine{02043\ \ \ \ \ \ \ \{}
\DoxyCodeLine{02044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int8\_t\ j\ =\ 0;\ j\ <\ 8;\ j++)\ \{}
\DoxyCodeLine{02045\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x1)\ drawPixel(x\ +\ i,\ y\ +\ j,\ color);}
\DoxyCodeLine{02046\ \ \ \ \ \ \ \ \ \ \ line\ >>=\ 1;}
\DoxyCodeLine{02047\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02048\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02049\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ big\ size}}
\DoxyCodeLine{02050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int8\_t\ j\ =\ 0;\ j\ <\ 8;\ j++)\ \{}
\DoxyCodeLine{02051\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x1)\ fillRect(x\ +\ (i\ *\ size),\ y\ +\ (j\ *\ size),\ size,\ size,\ color);}
\DoxyCodeLine{02052\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (fillbg)\ fillRect(x\ +\ i\ *\ size,\ y\ +\ j\ *\ size,\ size,\ size,\ bg);}
\DoxyCodeLine{02053\ \ \ \ \ \ \ \ \ \ \ line\ >>=\ 1;}
\DoxyCodeLine{02054\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02055\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02056\ \ \ \ \ \}}
\DoxyCodeLine{02057\ \ \ \}}
\DoxyCodeLine{02058\ }
\DoxyCodeLine{02059\ \textcolor{comment}{//>>>>>>>>>>>>>>>>>>>>>>>>>>>}}
\DoxyCodeLine{02060\ \textcolor{preprocessor}{\#ifdef\ LOAD\_GFXFF}}
\DoxyCodeLine{02061\ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ Custom\ font}}
\DoxyCodeLine{02062\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02063\ \textcolor{comment}{//>>>>>>>>>>>>>>>>>>>>>>>>>>>}}
\DoxyCodeLine{02064\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LOAD\_GLCD}}
\DoxyCodeLine{02065\ }
\DoxyCodeLine{02066\ \textcolor{preprocessor}{\#ifdef\ LOAD\_GFXFF}}
\DoxyCodeLine{02067\ \ \ \ \ \textcolor{comment}{//\ Filter\ out\ bad\ characters\ not\ present\ in\ font}}
\DoxyCodeLine{02068\ \ \ \ \ \textcolor{keywordflow}{if}\ ((c\ >=\ pgm\_read\_word(\&gfxFont-\/>first))\ \&\&\ (c\ <=\ pgm\_read\_word(\&gfxFont-\/>last\ )))}
\DoxyCodeLine{02069\ \ \ \ \ \{}
\DoxyCodeLine{02070\ \textcolor{comment}{//>>>>>>>>>>>>>>>>>>>>>>>>>>>}}
\DoxyCodeLine{02071\ }
\DoxyCodeLine{02072\ \ \ \ \ \ \ c\ -\/=\ pgm\_read\_word(\&gfxFont-\/>first);}
\DoxyCodeLine{02073\ \ \ \ \ \ \ GFXglyph\ *glyph\ \ =\ \&(((GFXglyph\ *)pgm\_read\_dword(\&gfxFont-\/>glyph))[c]);}
\DoxyCodeLine{02074\ }
\DoxyCodeLine{02075\ \ \ \ \ \ \ uint8\_t\ \ w\ \ =\ pgm\_read\_byte(\&glyph-\/>width),}
\DoxyCodeLine{02076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ h\ \ =\ pgm\_read\_byte(\&glyph-\/>height);}
\DoxyCodeLine{02077\ \ \ \ \ \ \ int8\_t\ \ \ xo\ =\ pgm\_read\_byte(\&glyph-\/>xOffset),}
\DoxyCodeLine{02078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ yo\ =\ pgm\_read\_byte(\&glyph-\/>yOffset);}
\DoxyCodeLine{02079\ }
\DoxyCodeLine{02080\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((x\ +\ xo\ +\ w\ *\ size\ -\/\ 1)\ <\ (\_vpX\ -\/\ \_xDatum))\ ||\ \textcolor{comment}{//\ Clip\ left}}
\DoxyCodeLine{02081\ \ \ \ \ \ \ \ \ \ \ ((y\ +\ yo\ +\ h\ *\ size\ -\/\ 1)\ <\ (\_vpY\ -\/\ \_yDatum)))\ \ \ \textcolor{comment}{//\ Clip\ top}}
\DoxyCodeLine{02082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02083\ }
\DoxyCodeLine{02084\ \ \ \ \ \ \ uint8\_t\ \ *bitmap\ =\ (uint8\_t\ *)pgm\_read\_dword(\&gfxFont-\/>bitmap);}
\DoxyCodeLine{02085\ \ \ \ \ \ \ uint32\_t\ bo\ =\ pgm\_read\_word(\&glyph-\/>bitmapOffset);}
\DoxyCodeLine{02086\ }
\DoxyCodeLine{02087\ \ \ \ \ \ \ uint8\_t\ \ xx,\ yy,\ bits=0,\ bit=0;}
\DoxyCodeLine{02088\ \ \ \ \ \ \ \textcolor{comment}{//uint8\_t\ \ xa\ =\ pgm\_read\_byte(\&glyph-\/>xAdvance);}}
\DoxyCodeLine{02089\ \ \ \ \ \ \ int16\_t\ \ xo16\ =\ 0,\ yo16\ =\ 0;}
\DoxyCodeLine{02090\ }
\DoxyCodeLine{02091\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(size\ >\ 1)\ \{}
\DoxyCodeLine{02092\ \ \ \ \ \ \ \ \ xo16\ =\ xo;}
\DoxyCodeLine{02093\ \ \ \ \ \ \ \ \ yo16\ =\ yo;}
\DoxyCodeLine{02094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02095\ }
\DoxyCodeLine{02096\ \ \ \ \ \ \ uint16\_t\ hpc\ =\ 0;\ \textcolor{comment}{//\ Horizontal\ foreground\ pixel\ count}}
\DoxyCodeLine{02097\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(yy=0;\ yy<h;\ yy++)\ \{}
\DoxyCodeLine{02098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(xx=0;\ xx<w;\ xx++)\ \{}
\DoxyCodeLine{02099\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(bit\ ==\ 0)\ \{}
\DoxyCodeLine{02100\ \ \ \ \ \ \ \ \ \ \ \ \ bits\ =\ pgm\_read\_byte(\&bitmap[bo++]);}
\DoxyCodeLine{02101\ \ \ \ \ \ \ \ \ \ \ \ \ bit\ \ =\ 0x80;}
\DoxyCodeLine{02102\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02103\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(bits\ \&\ bit)\ hpc++;}
\DoxyCodeLine{02104\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (hpc)\ \{}
\DoxyCodeLine{02106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(size\ ==\ 1)\ drawFastHLine(x+xo+xx-\/hpc,\ y+yo+yy,\ hpc,\ color);}
\DoxyCodeLine{02107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ fillRect(x+(xo16+xx-\/hpc)*size,\ y+(yo16+yy)*size,\ size*hpc,\ size,\ color);}
\DoxyCodeLine{02108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hpc=0;}
\DoxyCodeLine{02109\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02110\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02111\ \ \ \ \ \ \ \ \ \ \ bit\ >>=\ 1;}
\DoxyCodeLine{02112\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Draw\ pixels\ for\ this\ line\ as\ we\ are\ about\ to\ increment\ yy}}
\DoxyCodeLine{02114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (hpc)\ \{}
\DoxyCodeLine{02115\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(size\ ==\ 1)\ drawFastHLine(x+xo+xx-\/hpc,\ y+yo+yy,\ hpc,\ color);}
\DoxyCodeLine{02116\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ fillRect(x+(xo16+xx-\/hpc)*size,\ y+(yo16+yy)*size,\ size*hpc,\ size,\ color);}
\DoxyCodeLine{02117\ \ \ \ \ \ \ \ \ \ \ hpc=0;}
\DoxyCodeLine{02118\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02119\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02120\ \ \ \ \ \}}
\DoxyCodeLine{02121\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02122\ }
\DoxyCodeLine{02123\ }
\DoxyCodeLine{02124\ \textcolor{preprocessor}{\#ifdef\ LOAD\_GLCD}}
\DoxyCodeLine{02125\ \textcolor{preprocessor}{\ \ \#ifdef\ LOAD\_GFXFF}}
\DoxyCodeLine{02126\ \ \ \}\ \textcolor{comment}{//\ End\ classic\ vs\ custom\ font}}
\DoxyCodeLine{02127\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{02128\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02129\ \textcolor{preprocessor}{\ \ \#ifndef\ LOAD\_GFXFF}}
\DoxyCodeLine{02130\ \ \ \ \ color\ =\ color;}
\DoxyCodeLine{02131\ \ \ \ \ bg\ =\ bg;}
\DoxyCodeLine{02132\ \ \ \ \ size\ =\ size;}
\DoxyCodeLine{02133\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{02134\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02135\ }
\DoxyCodeLine{02136\ \}}
\DoxyCodeLine{02137\ }
\DoxyCodeLine{02138\ }
\DoxyCodeLine{02139\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{02140\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ drawChar}}
\DoxyCodeLine{02141\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ draw\ a\ Unicode\ glyph\ into\ the\ sprite}}
\DoxyCodeLine{02142\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{02143\ \ \ \textcolor{comment}{//\ TODO:\ Rationalise\ with\ TFT\_eSPI}}
\DoxyCodeLine{02144\ \ \ \textcolor{comment}{//\ Any\ UTF-\/8\ decoding\ must\ be\ done\ before\ calling\ drawChar()}}
\DoxyCodeLine{02145\ int16\_t\ TFT\_eSprite::drawChar(uint16\_t\ uniCode,\ int32\_t\ x,\ int32\_t\ y)}
\DoxyCodeLine{02146\ \{}
\DoxyCodeLine{02147\ \ \ \textcolor{keywordflow}{return}\ drawChar(uniCode,\ x,\ y,\ textfont);}
\DoxyCodeLine{02148\ \}}
\DoxyCodeLine{02149\ }
\DoxyCodeLine{02150\ \ \ \textcolor{comment}{//\ Any\ UTF-\/8\ decoding\ must\ be\ done\ before\ calling\ drawChar()}}
\DoxyCodeLine{02151\ int16\_t\ TFT\_eSprite::drawChar(uint16\_t\ uniCode,\ int32\_t\ x,\ int32\_t\ y,\ uint8\_t\ font)}
\DoxyCodeLine{02152\ \{}
\DoxyCodeLine{02153\ \ \ \textcolor{keywordflow}{if}\ (\_vpOoB\ ||\ !uniCode)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{02154\ }
\DoxyCodeLine{02155\ \ \ \textcolor{keywordflow}{if}\ (font==1)\ \{}
\DoxyCodeLine{02156\ \textcolor{preprocessor}{\#ifdef\ LOAD\_GLCD}}
\DoxyCodeLine{02157\ \textcolor{preprocessor}{\ \ \#ifndef\ LOAD\_GFXFF}}
\DoxyCodeLine{02158\ \ \ \ \ drawChar(x,\ y,\ uniCode,\ textcolor,\ textbgcolor,\ textsize);}
\DoxyCodeLine{02159\ \ \ \ \ \textcolor{keywordflow}{return}\ 6\ *\ textsize;}
\DoxyCodeLine{02160\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{02161\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02162\ \textcolor{preprocessor}{\ \ \#ifndef\ LOAD\_GFXFF}}
\DoxyCodeLine{02163\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{02164\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{02165\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02166\ }
\DoxyCodeLine{02167\ \textcolor{preprocessor}{\#ifdef\ LOAD\_GFXFF}}
\DoxyCodeLine{02168\ \ \ \ \ drawChar(x,\ y,\ uniCode,\ textcolor,\ textbgcolor,\ textsize);}
\DoxyCodeLine{02169\ \ \ \ \ \textcolor{keywordflow}{if}(!gfxFont)\ \{\ \textcolor{comment}{//\ 'Classic'\ built-\/in\ font}}
\DoxyCodeLine{02170\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ LOAD\_GLCD}}
\DoxyCodeLine{02171\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 6\ *\ textsize;}
\DoxyCodeLine{02172\ \textcolor{preprocessor}{\ \ \ \ \#else}}
\DoxyCodeLine{02173\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{02174\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{02175\ \ \ \ \ \}}
\DoxyCodeLine{02176\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02177\ \ \ \ \ \ \ \textcolor{keywordflow}{if}((uniCode\ >=\ pgm\_read\_word(\&gfxFont-\/>first))\ \&\&\ (uniCode\ <=\ pgm\_read\_word(\&gfxFont-\/>last)\ ))\ \{}
\DoxyCodeLine{02178\ \ \ \ \ \ \ \ \ uint16\_t\ \ \ c2\ \ \ \ =\ uniCode\ -\/\ pgm\_read\_word(\&gfxFont-\/>first);}
\DoxyCodeLine{02179\ \ \ \ \ \ \ \ \ GFXglyph\ *glyph\ =\ \&(((GFXglyph\ *)pgm\_read\_dword(\&gfxFont-\/>glyph))[c2]);}
\DoxyCodeLine{02180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ pgm\_read\_byte(\&glyph-\/>xAdvance)\ *\ textsize;}
\DoxyCodeLine{02181\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02182\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{02184\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02185\ \ \ \ \ \}}
\DoxyCodeLine{02186\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02187\ \ \ \}}
\DoxyCodeLine{02188\ }
\DoxyCodeLine{02189\ \ \ \textcolor{keywordflow}{if}\ ((font>1)\ \&\&\ (font<9)\ \&\&\ ((uniCode\ <\ 32)\ ||\ (uniCode\ >\ 127)))\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{02190\ }
\DoxyCodeLine{02191\ \ \ int32\_t\ width\ \ =\ 0;}
\DoxyCodeLine{02192\ \ \ int32\_t\ height\ =\ 0;}
\DoxyCodeLine{02193\ \ \ uint32\_t\ flash\_address\ =\ 0;}
\DoxyCodeLine{02194\ \ \ uniCode\ -\/=\ 32;}
\DoxyCodeLine{02195\ }
\DoxyCodeLine{02196\ \textcolor{preprocessor}{\#ifdef\ LOAD\_FONT2}}
\DoxyCodeLine{02197\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ 2)\ \{}
\DoxyCodeLine{02198\ \ \ \ \ flash\_address\ =\ pgm\_read\_dword(\&chrtbl\_f16[uniCode]);}
\DoxyCodeLine{02199\ \ \ \ \ width\ =\ pgm\_read\_byte(widtbl\_f16\ +\ uniCode);}
\DoxyCodeLine{02200\ \ \ \ \ height\ =\ chr\_hgt\_f16;}
\DoxyCodeLine{02201\ \ \ \}}
\DoxyCodeLine{02202\ \textcolor{preprocessor}{\ \ \#ifdef\ LOAD\_RLE}}
\DoxyCodeLine{02203\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02204\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{02205\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02206\ }
\DoxyCodeLine{02207\ \textcolor{preprocessor}{\#ifdef\ LOAD\_RLE}}
\DoxyCodeLine{02208\ \ \ \{}
\DoxyCodeLine{02209\ \ \ \ \ \textcolor{keywordflow}{if}\ ((font>2)\ \&\&\ (font<9))\ \{}
\DoxyCodeLine{02210\ \ \ \ \ \ \ flash\_address\ =\ pgm\_read\_dword(\ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*)(pgm\_read\_dword(\ \&(fontdata[font].chartbl\ )\ )\ +\ uniCode*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void}\ *))\ );}
\DoxyCodeLine{02211\ \ \ \ \ \ \ width\ =\ pgm\_read\_byte(\ (uint8\_t\ *)pgm\_read\_dword(\ \&(fontdata[font].widthtbl\ )\ )\ +\ uniCode\ );}
\DoxyCodeLine{02212\ \ \ \ \ \ \ height=\ pgm\_read\_byte(\ \&fontdata[font].height\ );}
\DoxyCodeLine{02213\ \ \ \ \ \}}
\DoxyCodeLine{02214\ \ \ \}}
\DoxyCodeLine{02215\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02216\ }
\DoxyCodeLine{02217\ \ \ int32\_t\ xd\ =\ x\ +\ \_xDatum;}
\DoxyCodeLine{02218\ \ \ int32\_t\ yd\ =\ y\ +\ \_yDatum;}
\DoxyCodeLine{02219\ }
\DoxyCodeLine{02220\ \ \ \textcolor{keywordflow}{if}\ ((xd\ +\ width\ *\ textsize\ <\ \_vpX\ ||\ xd\ >=\ \_vpW)\ \&\&\ (yd\ +\ height\ *\ textsize\ <\ \_vpY\ ||\ yd\ >=\ \_vpH))\ \textcolor{keywordflow}{return}\ width\ *\ textsize\ ;}
\DoxyCodeLine{02221\ }
\DoxyCodeLine{02222\ \ \ int32\_t\ w\ =\ width;}
\DoxyCodeLine{02223\ \ \ int32\_t\ pX\ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{02224\ \ \ int32\_t\ pY\ \ \ \ \ \ =\ y;}
\DoxyCodeLine{02225\ \ \ uint8\_t\ line\ =\ 0;}
\DoxyCodeLine{02226\ \ \ \textcolor{keywordtype}{bool}\ clip\ =\ xd\ <\ \_vpX\ ||\ xd\ +\ width\ \ *\ textsize\ >=\ \_vpW\ ||\ yd\ <\ \_vpY\ ||\ yd\ +\ height\ *\ textsize\ >=\ \_vpH;}
\DoxyCodeLine{02227\ }
\DoxyCodeLine{02228\ \textcolor{preprocessor}{\#ifdef\ LOAD\_FONT2\ }\textcolor{comment}{//\ chop\ out\ code\ if\ we\ do\ not\ need\ it}}
\DoxyCodeLine{02229\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ 2)\ \{}
\DoxyCodeLine{02230\ \ \ \ \ w\ =\ w\ +\ 6;\ \textcolor{comment}{//\ Should\ be\ +\ 7\ but\ we\ need\ to\ compensate\ for\ width\ increment}}
\DoxyCodeLine{02231\ \ \ \ \ w\ =\ w\ /\ 8;}
\DoxyCodeLine{02232\ }
\DoxyCodeLine{02233\ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ i\ =\ 0;\ i\ <\ height;\ i++)}
\DoxyCodeLine{02234\ \ \ \ \ \{}
\DoxyCodeLine{02235\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (textcolor\ !=\ textbgcolor)\ fillRect(x,\ pY,\ width\ *\ textsize,\ textsize,\ textbgcolor);}
\DoxyCodeLine{02236\ }
\DoxyCodeLine{02237\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ k\ =\ 0;\ k\ <\ w;\ k++)}
\DoxyCodeLine{02238\ \ \ \ \ \ \ \{}
\DoxyCodeLine{02239\ \ \ \ \ \ \ \ \ line\ =\ pgm\_read\_byte((uint8\_t\ *)flash\_address\ +\ w\ *\ i\ +\ k);}
\DoxyCodeLine{02240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line)\ \{}
\DoxyCodeLine{02241\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (textsize\ ==\ 1)\ \{}
\DoxyCodeLine{02242\ \ \ \ \ \ \ \ \ \ \ \ \ pX\ =\ x\ +\ k\ *\ 8;}
\DoxyCodeLine{02243\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x80)\ drawPixel(pX,\ pY,\ textcolor);}
\DoxyCodeLine{02244\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x40)\ drawPixel(pX\ +\ 1,\ pY,\ textcolor);}
\DoxyCodeLine{02245\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x20)\ drawPixel(pX\ +\ 2,\ pY,\ textcolor);}
\DoxyCodeLine{02246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x10)\ drawPixel(pX\ +\ 3,\ pY,\ textcolor);}
\DoxyCodeLine{02247\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x08)\ drawPixel(pX\ +\ 4,\ pY,\ textcolor);}
\DoxyCodeLine{02248\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x04)\ drawPixel(pX\ +\ 5,\ pY,\ textcolor);}
\DoxyCodeLine{02249\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x02)\ drawPixel(pX\ +\ 6,\ pY,\ textcolor);}
\DoxyCodeLine{02250\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x01)\ drawPixel(pX\ +\ 7,\ pY,\ textcolor);}
\DoxyCodeLine{02251\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02252\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02253\ \ \ \ \ \ \ \ \ \ \ \ \ pX\ =\ x\ +\ k\ *\ 8\ *\ textsize;}
\DoxyCodeLine{02254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x80)\ fillRect(pX,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x40)\ fillRect(pX\ +\ textsize,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x20)\ fillRect(pX\ +\ 2\ *\ textsize,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x10)\ fillRect(pX\ +\ 3\ *\ textsize,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02258\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x08)\ fillRect(pX\ +\ 4\ *\ textsize,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02259\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x04)\ fillRect(pX\ +\ 5\ *\ textsize,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x02)\ fillRect(pX\ +\ 6\ *\ textsize,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02261\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x01)\ fillRect(pX\ +\ 7\ *\ textsize,\ pY,\ textsize,\ textsize,\ textcolor);}
\DoxyCodeLine{02262\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02263\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02264\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02265\ \ \ \ \ \ \ pY\ +=\ textsize;}
\DoxyCodeLine{02266\ \ \ \ \ \}}
\DoxyCodeLine{02267\ \ \ \}}
\DoxyCodeLine{02268\ }
\DoxyCodeLine{02269\ \textcolor{preprocessor}{\ \ \#ifdef\ LOAD\_RLE}}
\DoxyCodeLine{02270\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02271\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{02272\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//FONT2}}
\DoxyCodeLine{02273\ }
\DoxyCodeLine{02274\ \textcolor{preprocessor}{\#ifdef\ LOAD\_RLE\ \ }\textcolor{comment}{//674\ bytes\ of\ code}}
\DoxyCodeLine{02275\ \ \ \textcolor{comment}{//\ Font\ is\ not\ 2\ and\ hence\ is\ RLE\ encoded}}
\DoxyCodeLine{02276\ \ \ \{}
\DoxyCodeLine{02277\ \ \ \ \ w\ *=\ height;\ \textcolor{comment}{//\ Now\ w\ is\ total\ number\ of\ pixels\ in\ the\ character}}
\DoxyCodeLine{02278\ \ \ \ \ int16\_t\ color\ =\ textcolor;}
\DoxyCodeLine{02279\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ color\ =\ (textcolor\ >>\ 8)\ |\ (textcolor\ <<\ 8);}
\DoxyCodeLine{02280\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)\ color\ =\ ((textcolor\ \&\ 0xE000)>>8\ |\ (textcolor\ \&\ 0x0700)>>6\ |\ (textcolor\ \&\ 0x0018)>>3);}
\DoxyCodeLine{02281\ }
\DoxyCodeLine{02282\ \ \ \ \ int16\_t\ bgcolor\ =\ textbgcolor;}
\DoxyCodeLine{02283\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 16)\ bgcolor\ =\ (textbgcolor\ >>\ 8)\ |\ (textbgcolor\ <<\ 8);}
\DoxyCodeLine{02284\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_bpp\ ==\ 8)\ bgcolor\ =\ ((textbgcolor\ \&\ 0xE000)>>8\ |\ (textbgcolor\ \&\ 0x0700)>>6\ |\ (textbgcolor\ \&\ 0x0018)>>3);}
\DoxyCodeLine{02285\ }
\DoxyCodeLine{02286\ \ \ \ \ \textcolor{keywordflow}{if}\ (textcolor\ ==\ textbgcolor\ \&\&\ !clip\ \&\&\ \_bpp\ !=\ 1)\ \{}
\DoxyCodeLine{02287\ \ \ \ \ \ \ int32\_t\ px\ =\ 0,\ py\ =\ pY;\ \textcolor{comment}{//\ To\ hold\ character\ block\ start\ and\ end\ column\ and\ row\ values}}
\DoxyCodeLine{02288\ \ \ \ \ \ \ int32\_t\ pc\ =\ 0;\ \textcolor{comment}{//\ Pixel\ count}}
\DoxyCodeLine{02289\ \ \ \ \ \ \ uint8\_t\ np\ =\ textsize\ *\ textsize;\ \textcolor{comment}{//\ Number\ of\ pixels\ in\ a\ drawn\ pixel}}
\DoxyCodeLine{02290\ }
\DoxyCodeLine{02291\ \ \ \ \ \ \ uint8\_t\ tnp\ =\ 0;\ \textcolor{comment}{//\ Temporary\ copy\ of\ np\ for\ while\ loop}}
\DoxyCodeLine{02292\ \ \ \ \ \ \ uint8\_t\ ts\ =\ textsize\ -\/\ 1;\ \textcolor{comment}{//\ Temporary\ copy\ of\ textsize}}
\DoxyCodeLine{02293\ \ \ \ \ \ \ \textcolor{comment}{//\ 16-\/bit\ pixel\ count\ so\ maximum\ font\ size\ is\ equivalent\ to\ 180x180\ pixels\ in\ area}}
\DoxyCodeLine{02294\ \ \ \ \ \ \ \textcolor{comment}{//\ w\ is\ total\ number\ of\ pixels\ to\ plot\ to\ fill\ character\ block}}
\DoxyCodeLine{02295\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (pc\ <\ w)\ \{}
\DoxyCodeLine{02296\ \ \ \ \ \ \ \ \ line\ =\ pgm\_read\_byte((uint8\_t\ *)flash\_address);}
\DoxyCodeLine{02297\ \ \ \ \ \ \ \ \ flash\_address++;}
\DoxyCodeLine{02298\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x80)\ \{}
\DoxyCodeLine{02299\ \ \ \ \ \ \ \ \ \ \ line\ \&=\ 0x7F;}
\DoxyCodeLine{02300\ \ \ \ \ \ \ \ \ \ \ line++;}
\DoxyCodeLine{02301\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ts)\ \{}
\DoxyCodeLine{02302\ \ \ \ \ \ \ \ \ \ \ \ \ px\ =\ xd\ +\ textsize\ *\ (pc\ \%\ width);\ \textcolor{comment}{//\ Keep\ these\ px\ and\ py\ calculations\ outside\ the\ loop\ as\ they\ are\ slow}}
\DoxyCodeLine{02303\ \ \ \ \ \ \ \ \ \ \ \ \ py\ =\ yd\ +\ textsize\ *\ (pc\ /\ width);}
\DoxyCodeLine{02304\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02305\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02306\ \ \ \ \ \ \ \ \ \ \ \ \ px\ =\ xd\ +\ pc\ \%\ width;\ \textcolor{comment}{//\ Keep\ these\ px\ and\ py\ calculations\ outside\ the\ loop\ as\ they\ are\ slow}}
\DoxyCodeLine{02307\ \ \ \ \ \ \ \ \ \ \ \ \ py\ =\ yd\ +\ pc\ /\ width;}
\DoxyCodeLine{02308\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02309\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (line-\/-\/)\ \{\ \textcolor{comment}{//\ In\ this\ case\ the\ while(line-\/-\/)\ is\ faster}}
\DoxyCodeLine{02310\ \ \ \ \ \ \ \ \ \ \ \ \ pc++;\ \textcolor{comment}{//\ This\ is\ faster\ than\ putting\ pc+=line\ before\ while()?}}
\DoxyCodeLine{02311\ \ \ \ \ \ \ \ \ \ \ \ \ setWindow(px,\ py,\ px\ +\ ts,\ py\ +\ ts);}
\DoxyCodeLine{02312\ }
\DoxyCodeLine{02313\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ts)\ \{}
\DoxyCodeLine{02314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tnp\ =\ np;}
\DoxyCodeLine{02315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (tnp-\/-\/)\ writeColor(color);}
\DoxyCodeLine{02316\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ writeColor(color);}
\DoxyCodeLine{02318\ }
\DoxyCodeLine{02319\ \ \ \ \ \ \ \ \ \ \ \ \ px\ +=\ textsize;}
\DoxyCodeLine{02320\ }
\DoxyCodeLine{02321\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (px\ >=\ (xd\ +\ width\ *\ textsize))\ \{}
\DoxyCodeLine{02322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ px\ =\ xd;}
\DoxyCodeLine{02323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ py\ +=\ textsize;}
\DoxyCodeLine{02324\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02325\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02326\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02327\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02328\ \ \ \ \ \ \ \ \ \ \ line++;}
\DoxyCodeLine{02329\ \ \ \ \ \ \ \ \ \ \ pc\ +=\ line;}
\DoxyCodeLine{02330\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02331\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02332\ \ \ \ \ \}}
\DoxyCodeLine{02333\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02334\ \ \ \ \ \ \ \textcolor{comment}{//\ Text\ colour\ !=\ background\ and\ textsize\ =\ 1\ and\ character\ is\ within\ viewport\ area}}
\DoxyCodeLine{02335\ \ \ \ \ \ \ \textcolor{comment}{//\ so\ use\ faster\ drawing\ of\ characters\ and\ background\ using\ block\ write}}
\DoxyCodeLine{02336\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (textcolor\ !=\ textbgcolor\ \&\&\ textsize\ ==\ 1\ \&\&\ !clip\ \&\&\ \_bpp\ !=\ 1)}
\DoxyCodeLine{02337\ \ \ \ \ \ \ \{}
\DoxyCodeLine{02338\ \ \ \ \ \ \ \ \ setWindow(xd,\ yd,\ xd\ +\ width\ -\/\ 1,\ yd\ +\ height\ -\/\ 1);}
\DoxyCodeLine{02339\ }
\DoxyCodeLine{02340\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Maximum\ font\ size\ is\ equivalent\ to\ 180x180\ pixels\ in\ area}}
\DoxyCodeLine{02341\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (w\ >\ 0)\ \{}
\DoxyCodeLine{02342\ \ \ \ \ \ \ \ \ \ \ line\ =\ pgm\_read\_byte((uint8\_t\ *)flash\_address++);\ \textcolor{comment}{//\ 8\ bytes\ smaller\ when\ incrementing\ here}}
\DoxyCodeLine{02343\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x80)\ \{}
\DoxyCodeLine{02344\ \ \ \ \ \ \ \ \ \ \ \ \ line\ \&=\ 0x7F;}
\DoxyCodeLine{02345\ \ \ \ \ \ \ \ \ \ \ \ \ line++;\ w\ -\/=\ line;}
\DoxyCodeLine{02346\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (line-\/-\/)\ writeColor(color);}
\DoxyCodeLine{02347\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02348\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02349\ \ \ \ \ \ \ \ \ \ \ \ \ line++;\ w\ -\/=\ line;}
\DoxyCodeLine{02350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (line-\/-\/)\ writeColor(bgcolor);}
\DoxyCodeLine{02351\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02352\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02353\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02354\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02355\ \ \ \ \ \ \ \{}
\DoxyCodeLine{02356\ \ \ \ \ \ \ \ \ int32\_t\ px\ =\ 0,\ py\ =\ 0;\ \ \textcolor{comment}{//\ To\ hold\ character\ pixel\ coords}}
\DoxyCodeLine{02357\ \ \ \ \ \ \ \ \ int32\_t\ tx\ =\ 0,\ ty\ =\ 0;\ \ \textcolor{comment}{//\ To\ hold\ character\ TFT\ pixel\ coords}}
\DoxyCodeLine{02358\ \ \ \ \ \ \ \ \ int32\_t\ pc\ =\ 0;\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pixel\ count}}
\DoxyCodeLine{02359\ \ \ \ \ \ \ \ \ int32\_t\ pl\ =\ 0;\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pixel\ line\ length}}
\DoxyCodeLine{02360\ \ \ \ \ \ \ \ \ uint16\_t\ pcol\ =\ 0;\ \ \ \ \ \ \ \textcolor{comment}{//\ Pixel\ color}}
\DoxyCodeLine{02361\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ pf\ =\ \textcolor{keyword}{true};\ \ \ \ \ \ \textcolor{comment}{//\ Flag\ for\ plotting}}
\DoxyCodeLine{02362\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (pc\ <\ w)\ \{}
\DoxyCodeLine{02363\ \ \ \ \ \ \ \ \ \ \ line\ =\ pgm\_read\_byte((uint8\_t\ *)flash\_address);}
\DoxyCodeLine{02364\ \ \ \ \ \ \ \ \ \ \ flash\_address++;}
\DoxyCodeLine{02365\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (line\ \&\ 0x80)\ \{\ pcol\ =\ textcolor;\ line\ \&=\ 0x7F;\ pf\ =\ \textcolor{keyword}{true};\}}
\DoxyCodeLine{02366\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ pcol\ =\ textbgcolor;\ \textcolor{keywordflow}{if}\ (textcolor\ ==\ textbgcolor)\ pf\ =\ \textcolor{keyword}{false};\}}
\DoxyCodeLine{02367\ \ \ \ \ \ \ \ \ \ \ line++;}
\DoxyCodeLine{02368\ \ \ \ \ \ \ \ \ \ \ px\ =\ pc\ \%\ width;}
\DoxyCodeLine{02369\ \ \ \ \ \ \ \ \ \ \ tx\ =\ x\ +\ textsize\ *\ px;}
\DoxyCodeLine{02370\ \ \ \ \ \ \ \ \ \ \ py\ =\ pc\ /\ width;}
\DoxyCodeLine{02371\ \ \ \ \ \ \ \ \ \ \ ty\ =\ y\ +\ textsize\ *\ py;}
\DoxyCodeLine{02372\ }
\DoxyCodeLine{02373\ \ \ \ \ \ \ \ \ \ \ pl\ =\ 0;}
\DoxyCodeLine{02374\ \ \ \ \ \ \ \ \ \ \ pc\ +=\ line;}
\DoxyCodeLine{02375\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (line-\/-\/)\ \{}
\DoxyCodeLine{02376\ \ \ \ \ \ \ \ \ \ \ \ \ pl++;}
\DoxyCodeLine{02377\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((px+pl)\ >=\ width)\ \{}
\DoxyCodeLine{02378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pf)\ fillRect(tx,\ ty,\ pl\ *\ textsize,\ textsize,\ pcol);}
\DoxyCodeLine{02379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pl\ =\ 0;}
\DoxyCodeLine{02380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ px\ =\ 0;}
\DoxyCodeLine{02381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tx\ =\ x;}
\DoxyCodeLine{02382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ py\ ++;}
\DoxyCodeLine{02383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ty\ +=\ textsize;}
\DoxyCodeLine{02384\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02385\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02386\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pl\ \&\&\ pf)\ fillRect(tx,\ ty,\ pl\ *\ textsize,\ textsize,\ pcol);}
\DoxyCodeLine{02387\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02388\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02389\ \ \ \ \ \}}
\DoxyCodeLine{02390\ \ \ \}}
\DoxyCodeLine{02391\ \ \ \textcolor{comment}{//\ End\ of\ RLE\ font\ rendering}}
\DoxyCodeLine{02392\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02393\ }
\DoxyCodeLine{02394\ \textcolor{preprocessor}{\#if\ !defined\ (LOAD\_FONT2)\ \&\&\ !defined\ (LOAD\_RLE)}}
\DoxyCodeLine{02395\ \ \ \textcolor{comment}{//\ Stop\ warnings}}
\DoxyCodeLine{02396\ \ \ flash\_address\ =\ flash\_address;}
\DoxyCodeLine{02397\ \ \ w\ =\ w;}
\DoxyCodeLine{02398\ \ \ pX\ =\ pX;}
\DoxyCodeLine{02399\ \ \ pY\ =\ pY;}
\DoxyCodeLine{02400\ \ \ line\ =\ line;}
\DoxyCodeLine{02401\ \ \ clip\ =\ clip;}
\DoxyCodeLine{02402\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02403\ }
\DoxyCodeLine{02404\ \ \ \textcolor{keywordflow}{return}\ width\ *\ textsize;\ \ \ \ \textcolor{comment}{//\ x\ +}}
\DoxyCodeLine{02405\ \}}
\DoxyCodeLine{02406\ }
\DoxyCodeLine{02407\ }
\DoxyCodeLine{02408\ \textcolor{preprocessor}{\#ifdef\ SMOOTH\_FONT}}
\DoxyCodeLine{02409\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{02410\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ drawGlyph}}
\DoxyCodeLine{02411\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Write\ a\ character\ to\ the\ sprite\ cursor\ position}}
\DoxyCodeLine{02412\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{02413\ \textcolor{comment}{//}}
\DoxyCodeLine{02414\ \textcolor{keywordtype}{void}\ TFT\_eSprite::drawGlyph(uint16\_t\ code)}
\DoxyCodeLine{02415\ \{}
\DoxyCodeLine{02416\ \ \ uint16\_t\ fg\ =\ textcolor;}
\DoxyCodeLine{02417\ \ \ uint16\_t\ bg\ =\ textbgcolor;}
\DoxyCodeLine{02418\ \ \ \textcolor{keywordtype}{bool}\ getBG\ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02419\ \ \ \textcolor{keywordflow}{if}\ (fg\ ==\ bg)\ getBG\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02420\ }
\DoxyCodeLine{02421\ \ \ \textcolor{comment}{//\ Check\ if\ cursor\ has\ moved}}
\DoxyCodeLine{02422\ \ \ \textcolor{keywordflow}{if}\ (last\_cursor\_x\ !=\ cursor\_x)}
\DoxyCodeLine{02423\ \ \ \{}
\DoxyCodeLine{02424\ \ \ \ \ bg\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02425\ \ \ \ \ last\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02426\ \ \ \}}
\DoxyCodeLine{02427\ }
\DoxyCodeLine{02428\ \ \ \textcolor{keywordflow}{if}\ (code\ <\ 0x21)}
\DoxyCodeLine{02429\ \ \ \{}
\DoxyCodeLine{02430\ \ \ \ \ \textcolor{keywordflow}{if}\ (code\ ==\ 0x20)\ \{}
\DoxyCodeLine{02431\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fillbg)\ fillRect(bg\_cursor\_x,\ cursor\_y,\ (cursor\_x\ +\ gFont.spaceWidth)\ -\/\ bg\_cursor\_x,\ gFont.yAdvance,\ bg);}
\DoxyCodeLine{02432\ \ \ \ \ \ \ cursor\_x\ +=\ gFont.spaceWidth;}
\DoxyCodeLine{02433\ \ \ \ \ \ \ bg\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02434\ \ \ \ \ \ \ last\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02435\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02436\ \ \ \ \ \}}
\DoxyCodeLine{02437\ }
\DoxyCodeLine{02438\ \ \ \ \ \textcolor{keywordflow}{if}\ (code\ ==\ \textcolor{charliteral}{'\(\backslash\)n'})\ \{}
\DoxyCodeLine{02439\ \ \ \ \ \ \ cursor\_x\ =\ 0;}
\DoxyCodeLine{02440\ \ \ \ \ \ \ bg\_cursor\_x\ =\ 0;}
\DoxyCodeLine{02441\ \ \ \ \ \ \ last\_cursor\_x\ =\ 0;}
\DoxyCodeLine{02442\ \ \ \ \ \ \ cursor\_y\ +=\ gFont.yAdvance;}
\DoxyCodeLine{02443\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (textwrapY\ \&\&\ (cursor\_y\ >=\ height()))\ cursor\_y\ =\ 0;}
\DoxyCodeLine{02444\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02445\ \ \ \ \ \}}
\DoxyCodeLine{02446\ \ \ \}}
\DoxyCodeLine{02447\ }
\DoxyCodeLine{02448\ \ \ uint16\_t\ gNum\ =\ 0;}
\DoxyCodeLine{02449\ \ \ \textcolor{keywordtype}{bool}\ found\ =\ getUnicodeIndex(code,\ \&gNum);}
\DoxyCodeLine{02450\ }
\DoxyCodeLine{02451\ \ \ \textcolor{keywordflow}{if}\ (found)}
\DoxyCodeLine{02452\ \ \ \{}
\DoxyCodeLine{02453\ }
\DoxyCodeLine{02454\ \ \ \ \ \textcolor{keywordtype}{bool}\ newSprite\ =\ !\_created;}
\DoxyCodeLine{02455\ }
\DoxyCodeLine{02456\ \ \ \ \ \textcolor{keywordflow}{if}\ (newSprite)}
\DoxyCodeLine{02457\ \ \ \ \ \{}
\DoxyCodeLine{02458\ \ \ \ \ \ \ createSprite(gWidth[gNum],\ gFont.yAdvance);}
\DoxyCodeLine{02459\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(fg\ !=\ bg)\ fillSprite(bg);}
\DoxyCodeLine{02460\ \ \ \ \ \ \ cursor\_x\ =\ -\/gdX[gNum];}
\DoxyCodeLine{02461\ \ \ \ \ \ \ bg\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02462\ \ \ \ \ \ \ last\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02463\ \ \ \ \ \ \ cursor\_y\ =\ 0;}
\DoxyCodeLine{02464\ \ \ \ \ \}}
\DoxyCodeLine{02465\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02466\ \ \ \ \ \{}
\DoxyCodeLine{02467\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ textwrapX\ \&\&\ ((cursor\_x\ +\ gWidth[gNum]\ +\ gdX[gNum])\ >\ width()))\ \{}
\DoxyCodeLine{02468\ \ \ \ \ \ \ \ \ cursor\_y\ +=\ gFont.yAdvance;}
\DoxyCodeLine{02469\ \ \ \ \ \ \ \ \ cursor\_x\ =\ 0;}
\DoxyCodeLine{02470\ \ \ \ \ \ \ \ \ bg\_cursor\_x\ =\ 0;}
\DoxyCodeLine{02471\ \ \ \ \ \ \ \ \ last\_cursor\_x\ =\ 0;}
\DoxyCodeLine{02472\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02473\ }
\DoxyCodeLine{02474\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ textwrapY\ \&\&\ ((cursor\_y\ +\ gFont.yAdvance)\ >\ height()))\ cursor\_y\ =\ 0;}
\DoxyCodeLine{02475\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ cursor\_x\ ==\ 0)\ cursor\_x\ -\/=\ gdX[gNum];}
\DoxyCodeLine{02476\ \ \ \ \ \}}
\DoxyCodeLine{02477\ }
\DoxyCodeLine{02478\ \ \ \ \ uint8\_t*\ pbuffer\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02479\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t*\ gPtr\ =\ (\textcolor{keyword}{const}\ uint8\_t*)\ gFont.gArray;}
\DoxyCodeLine{02480\ }
\DoxyCodeLine{02481\ \textcolor{preprocessor}{\#ifdef\ FONT\_FS\_AVAILABLE}}
\DoxyCodeLine{02482\ \ \ \ \ \textcolor{keywordflow}{if}\ (fs\_font)\ \{}
\DoxyCodeLine{02483\ \ \ \ \ \ \ fontFile.seek(gBitmap[gNum],\ fs::SeekSet);\ \textcolor{comment}{//\ This\ is\ slow\ for\ a\ significant\ position\ shift!}}
\DoxyCodeLine{02484\ \ \ \ \ \ \ pbuffer\ =\ \ (uint8\_t*)malloc(gWidth[gNum]);}
\DoxyCodeLine{02485\ \ \ \ \ \}}
\DoxyCodeLine{02486\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02487\ }
\DoxyCodeLine{02488\ \ \ \ \ int16\_t\ cy\ =\ cursor\_y\ +\ gFont.maxAscent\ -\/\ gdY[gNum];}
\DoxyCodeLine{02489\ \ \ \ \ int16\_t\ cx\ =\ cursor\_x\ +\ gdX[gNum];}
\DoxyCodeLine{02490\ }
\DoxyCodeLine{02491\ \ \ \ \ \textcolor{comment}{//\ \ if\ (cx\ >\ width()\ \&\&\ bg\_cursor\_x\ >\ width())\ return;}}
\DoxyCodeLine{02492\ \ \ \ \ \textcolor{comment}{//\ \ if\ (cursor\_y\ >\ height())\ return;}}
\DoxyCodeLine{02493\ }
\DoxyCodeLine{02494\ \ \ \ \ int16\_t\ \ fxs\ =\ cx;}
\DoxyCodeLine{02495\ \ \ \ \ uint32\_t\ fl\ =\ 0;}
\DoxyCodeLine{02496\ \ \ \ \ int16\_t\ \ bxs\ =\ cx;}
\DoxyCodeLine{02497\ \ \ \ \ uint32\_t\ bl\ =\ 0;}
\DoxyCodeLine{02498\ \ \ \ \ int16\_t\ \ bx\ =\ 0;}
\DoxyCodeLine{02499\ \ \ \ \ uint8\_t\ pixel\ =\ 0;}
\DoxyCodeLine{02500\ }
\DoxyCodeLine{02501\ \ \ \ \ int16\_t\ fillwidth\ \ =\ 0;}
\DoxyCodeLine{02502\ \ \ \ \ int16\_t\ fillheight\ =\ 0;}
\DoxyCodeLine{02503\ }
\DoxyCodeLine{02504\ \ \ \ \ \textcolor{comment}{//\ Fill\ area\ above\ glyph}}
\DoxyCodeLine{02505\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fillbg)\ \{}
\DoxyCodeLine{02506\ \ \ \ \ \ \ fillwidth\ \ =\ (cursor\_x\ +\ gxAdvance[gNum])\ -\/\ bg\_cursor\_x;}
\DoxyCodeLine{02507\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fillwidth\ >\ 0)\ \{}
\DoxyCodeLine{02508\ \ \ \ \ \ \ \ \ fillheight\ =\ gFont.maxAscent\ -\/\ gdY[gNum];}
\DoxyCodeLine{02509\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fillheight\ >\ 0)\ \{}
\DoxyCodeLine{02510\ \ \ \ \ \ \ \ \ \ \ fillRect(bg\_cursor\_x,\ cursor\_y,\ fillwidth,\ fillheight,\ textbgcolor);}
\DoxyCodeLine{02511\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02512\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02513\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02514\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Could\ be\ negative}}
\DoxyCodeLine{02515\ \ \ \ \ \ \ \ \ fillwidth\ =\ 0;}
\DoxyCodeLine{02516\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02517\ }
\DoxyCodeLine{02518\ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ any\ area\ to\ left\ of\ glyph\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }}
\DoxyCodeLine{02519\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bg\_cursor\_x\ <\ cx)\ fillRect(bg\_cursor\_x,\ cy,\ cx\ -\/\ bg\_cursor\_x,\ gHeight[gNum],\ textbgcolor);}
\DoxyCodeLine{02520\ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ x\ position\ in\ glyph\ area\ where\ background\ starts}}
\DoxyCodeLine{02521\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bg\_cursor\_x\ >\ cx)\ bx\ =\ bg\_cursor\_x\ -\/\ cx;}
\DoxyCodeLine{02522\ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ any\ area\ to\ right\ of\ glyph}}
\DoxyCodeLine{02523\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cx\ +\ gWidth[gNum]\ <\ cursor\_x\ +\ gxAdvance[gNum])\ \{}
\DoxyCodeLine{02524\ \ \ \ \ \ \ \ \ fillRect(cx\ +\ gWidth[gNum],\ cy,\ (cursor\_x\ +\ gxAdvance[gNum])\ -\/\ (cx\ +\ gWidth[gNum]),\ gHeight[gNum],\ textbgcolor);}
\DoxyCodeLine{02525\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02526\ \ \ \ \ \}}
\DoxyCodeLine{02527\ }
\DoxyCodeLine{02528\ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ y\ =\ 0;\ y\ <\ gHeight[gNum];\ y++)}
\DoxyCodeLine{02529\ \ \ \ \ \{}
\DoxyCodeLine{02530\ \textcolor{preprocessor}{\#ifdef\ FONT\_FS\_AVAILABLE}}
\DoxyCodeLine{02531\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fs\_font)\ \{}
\DoxyCodeLine{02532\ \ \ \ \ \ \ \ \ fontFile.read(pbuffer,\ gWidth[gNum]);}
\DoxyCodeLine{02533\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02534\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02535\ }
\DoxyCodeLine{02536\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int32\_t\ x\ =\ 0;\ x\ <\ gWidth[gNum];\ x++)}
\DoxyCodeLine{02537\ \ \ \ \ \ \ \{}
\DoxyCodeLine{02538\ \textcolor{preprocessor}{\#ifdef\ FONT\_FS\_AVAILABLE}}
\DoxyCodeLine{02539\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fs\_font)\ pixel\ =\ pbuffer[x];}
\DoxyCodeLine{02540\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02541\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02542\ \ \ \ \ \ \ \ \ pixel\ =\ pgm\_read\_byte(gPtr\ +\ gBitmap[gNum]\ +\ x\ +\ gWidth[gNum]\ *\ y);}
\DoxyCodeLine{02543\ }
\DoxyCodeLine{02544\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel)}
\DoxyCodeLine{02545\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02546\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bl)\ \{\ drawFastHLine(\ bxs,\ y\ +\ cy,\ bl,\ bg);\ bl\ =\ 0;\ \}}
\DoxyCodeLine{02547\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pixel\ !=\ 0xFF)}
\DoxyCodeLine{02548\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02549\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fl)\ \{}
\DoxyCodeLine{02550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fl==1)\ drawPixel(fxs,\ y\ +\ cy,\ fg);}
\DoxyCodeLine{02551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ drawFastHLine(\ fxs,\ y\ +\ cy,\ fl,\ fg);}
\DoxyCodeLine{02552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fl\ =\ 0;}
\DoxyCodeLine{02553\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02554\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (getBG)\ bg\ =\ readPixel(x\ +\ cx,\ y\ +\ cy);}
\DoxyCodeLine{02555\ \ \ \ \ \ \ \ \ \ \ \ \ drawPixel(x\ +\ cx,\ y\ +\ cy,\ alphaBlend(pixel,\ fg,\ bg));}
\DoxyCodeLine{02556\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02557\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02558\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02559\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fl==0)\ fxs\ =\ x\ +\ cx;}
\DoxyCodeLine{02560\ \ \ \ \ \ \ \ \ \ \ \ \ fl++;}
\DoxyCodeLine{02561\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02562\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02563\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02564\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02565\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fl)\ \{\ drawFastHLine(\ fxs,\ y\ +\ cy,\ fl,\ fg);\ fl\ =\ 0;\ \}}
\DoxyCodeLine{02566\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fillbg)\ \{}
\DoxyCodeLine{02567\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ >=\ bx)\ \{}
\DoxyCodeLine{02568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bl==0)\ bxs\ =\ x\ +\ cx;}
\DoxyCodeLine{02569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bl++;}
\DoxyCodeLine{02570\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02571\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02572\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02573\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02574\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fl)\ \{\ drawFastHLine(\ fxs,\ y\ +\ cy,\ fl,\ fg);\ fl\ =\ 0;\ \}}
\DoxyCodeLine{02575\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bl)\ \{\ drawFastHLine(\ bxs,\ y\ +\ cy,\ bl,\ bg);\ bl\ =\ 0;\ \}}
\DoxyCodeLine{02576\ \ \ \ \ \}}
\DoxyCodeLine{02577\ }
\DoxyCodeLine{02578\ \ \ \ \ \textcolor{comment}{//\ Fill\ area\ below\ glyph}}
\DoxyCodeLine{02579\ \ \ \ \ \textcolor{keywordflow}{if}\ (fillwidth\ >\ 0)\ \{}
\DoxyCodeLine{02580\ \ \ \ \ \ \ fillheight\ =\ (cursor\_y\ +\ gFont.yAdvance)\ -\/\ (cy\ +\ gHeight[gNum]);}
\DoxyCodeLine{02581\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fillheight\ >\ 0)\ \{}
\DoxyCodeLine{02582\ \ \ \ \ \ \ \ \ fillRect(bg\_cursor\_x,\ cy\ +\ gHeight[gNum],\ fillwidth,\ fillheight,\ textbgcolor);}
\DoxyCodeLine{02583\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02584\ \ \ \ \ \}}
\DoxyCodeLine{02585\ }
\DoxyCodeLine{02586\ \ \ \ \ \textcolor{keywordflow}{if}\ (pbuffer)\ free(pbuffer);}
\DoxyCodeLine{02587\ \ \ \ \ cursor\_x\ +=\ gxAdvance[gNum];}
\DoxyCodeLine{02588\ }
\DoxyCodeLine{02589\ \ \ \ \ \textcolor{keywordflow}{if}\ (newSprite)}
\DoxyCodeLine{02590\ \ \ \ \ \{}
\DoxyCodeLine{02591\ \ \ \ \ \ \ pushSprite(cx,\ cursor\_y);}
\DoxyCodeLine{02592\ \ \ \ \ \ \ deleteSprite();}
\DoxyCodeLine{02593\ \ \ \ \ \}}
\DoxyCodeLine{02594\ \ \ \}}
\DoxyCodeLine{02595\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02596\ \ \ \{}
\DoxyCodeLine{02597\ \ \ \ \ \textcolor{comment}{//\ Not\ a\ Unicode\ in\ font\ so\ draw\ a\ rectangle\ and\ move\ on\ cursor}}
\DoxyCodeLine{02598\ \ \ \ \ drawRect(cursor\_x,\ cursor\_y\ +\ gFont.maxAscent\ -\/\ gFont.ascent,\ gFont.spaceWidth,\ gFont.ascent,\ fg);}
\DoxyCodeLine{02599\ \ \ \ \ cursor\_x\ +=\ gFont.spaceWidth\ +\ 1;}
\DoxyCodeLine{02600\ \ \ \}}
\DoxyCodeLine{02601\ \ \ bg\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02602\ \ \ last\_cursor\_x\ =\ cursor\_x;}
\DoxyCodeLine{02603\ \}}
\DoxyCodeLine{02604\ }
\DoxyCodeLine{02605\ }
\DoxyCodeLine{02606\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{02607\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ printToSprite}}
\DoxyCodeLine{02608\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Write\ a\ string\ to\ the\ sprite\ cursor\ position}}
\DoxyCodeLine{02609\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{02610\ \textcolor{keywordtype}{void}\ TFT\_eSprite::printToSprite(String\ \textcolor{keywordtype}{string})}
\DoxyCodeLine{02611\ \{}
\DoxyCodeLine{02612\ \ \ \textcolor{keywordflow}{if}(!fontLoaded)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02613\ \ \ printToSprite((\textcolor{keywordtype}{char}*)\textcolor{keywordtype}{string}.c\_str(),\ \textcolor{keywordtype}{string}.length());}
\DoxyCodeLine{02614\ \}}
\DoxyCodeLine{02615\ }
\DoxyCodeLine{02616\ }
\DoxyCodeLine{02617\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{02618\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ printToSprite}}
\DoxyCodeLine{02619\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Write\ a\ string\ to\ the\ sprite\ cursor\ position}}
\DoxyCodeLine{02620\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{02621\ \textcolor{keywordtype}{void}\ TFT\_eSprite::printToSprite(\textcolor{keywordtype}{char}\ *cbuffer,\ uint16\_t\ len)\ \textcolor{comment}{//String\ string)}}
\DoxyCodeLine{02622\ \{}
\DoxyCodeLine{02623\ \ \ \textcolor{keywordflow}{if}(!fontLoaded)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02624\ }
\DoxyCodeLine{02625\ \ \ uint16\_t\ n\ =\ 0;}
\DoxyCodeLine{02626\ \ \ \textcolor{keywordtype}{bool}\ newSprite\ =\ !\_created;}
\DoxyCodeLine{02627\ \ \ int16\_t\ \ cursorX\ =\ \_tft-\/>cursor\_x;}
\DoxyCodeLine{02628\ }
\DoxyCodeLine{02629\ \ \ \textcolor{keywordflow}{if}\ (newSprite)}
\DoxyCodeLine{02630\ \ \ \{}
\DoxyCodeLine{02631\ \ \ \ \ int16\_t\ sWidth\ =\ 0;}
\DoxyCodeLine{02632\ \ \ \ \ uint16\_t\ index\ =\ 0;}
\DoxyCodeLine{02633\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ first\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02634\ \ \ \ \ \textcolor{keywordflow}{while}\ (n\ <\ len)}
\DoxyCodeLine{02635\ \ \ \ \ \{}
\DoxyCodeLine{02636\ \ \ \ \ \ \ uint16\_t\ unicode\ =\ decodeUTF8((uint8\_t*)cbuffer,\ \&n,\ len\ -\/\ n);}
\DoxyCodeLine{02637\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (getUnicodeIndex(unicode,\ \&index))}
\DoxyCodeLine{02638\ \ \ \ \ \ \ \{}
\DoxyCodeLine{02639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (first)\ \{}
\DoxyCodeLine{02640\ \ \ \ \ \ \ \ \ \ \ first\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02641\ \ \ \ \ \ \ \ \ \ \ sWidth\ -\/=\ gdX[index];}
\DoxyCodeLine{02642\ \ \ \ \ \ \ \ \ \ \ cursorX\ +=\ gdX[index];}
\DoxyCodeLine{02643\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02644\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ ==\ len)\ sWidth\ +=\ (\ gWidth[index]\ +\ gdX[index]);}
\DoxyCodeLine{02645\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ sWidth\ +=\ gxAdvance[index];}
\DoxyCodeLine{02646\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02647\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ sWidth\ +=\ gFont.spaceWidth\ +\ 1;}
\DoxyCodeLine{02648\ \ \ \ \ \}}
\DoxyCodeLine{02649\ }
\DoxyCodeLine{02650\ \ \ \ \ createSprite(sWidth,\ gFont.yAdvance);}
\DoxyCodeLine{02651\ }
\DoxyCodeLine{02652\ \ \ \ \ \textcolor{keywordflow}{if}\ (textcolor\ !=\ textbgcolor)\ fillSprite(textbgcolor);}
\DoxyCodeLine{02653\ \ \ \}}
\DoxyCodeLine{02654\ }
\DoxyCodeLine{02655\ \ \ n\ =\ 0;}
\DoxyCodeLine{02656\ }
\DoxyCodeLine{02657\ \ \ \textcolor{keywordflow}{while}\ (n\ <\ len)}
\DoxyCodeLine{02658\ \ \ \{}
\DoxyCodeLine{02659\ \ \ \ \ uint16\_t\ unicode\ =\ decodeUTF8((uint8\_t*)cbuffer,\ \&n,\ len\ -\/\ n);}
\DoxyCodeLine{02660\ \ \ \ \ \textcolor{comment}{//Serial.print("{}Decoded\ Unicode\ =\ 0x"{});Serial.println(unicode,HEX);}}
\DoxyCodeLine{02661\ \ \ \ \ \textcolor{comment}{//Serial.print("{}n\ =\ "{});Serial.println(n);}}
\DoxyCodeLine{02662\ \ \ \ \ drawGlyph(unicode);}
\DoxyCodeLine{02663\ \ \ \}}
\DoxyCodeLine{02664\ }
\DoxyCodeLine{02665\ \ \ \textcolor{keywordflow}{if}\ (newSprite)}
\DoxyCodeLine{02666\ \ \ \{\ \textcolor{comment}{//\ The\ sprite\ had\ to\ be\ created\ so\ place\ at\ TFT\ cursor}}
\DoxyCodeLine{02667\ \ \ \ \ pushSprite(cursorX,\ \_tft-\/>cursor\_y);}
\DoxyCodeLine{02668\ \ \ \ \ deleteSprite();}
\DoxyCodeLine{02669\ \ \ \}}
\DoxyCodeLine{02670\ \}}
\DoxyCodeLine{02671\ }
\DoxyCodeLine{02672\ }
\DoxyCodeLine{02673\ \textcolor{comment}{/***************************************************************************************}}
\DoxyCodeLine{02674\ \textcolor{comment}{**\ Function\ name:\ \ \ \ \ \ \ \ \ \ \ printToSprite}}
\DoxyCodeLine{02675\ \textcolor{comment}{**\ Description:\ \ \ \ \ \ \ \ \ \ \ \ \ Print\ character\ in\ a\ Sprite,\ create\ sprite\ if\ needed}}
\DoxyCodeLine{02676\ \textcolor{comment}{***************************************************************************************/}}
\DoxyCodeLine{02677\ int16\_t\ TFT\_eSprite::printToSprite(int16\_t\ x,\ int16\_t\ y,\ uint16\_t\ index)}
\DoxyCodeLine{02678\ \{}
\DoxyCodeLine{02679\ \ \ \textcolor{keywordtype}{bool}\ newSprite\ =\ !\_created;}
\DoxyCodeLine{02680\ \ \ int16\_t\ sWidth\ =\ gWidth[index];}
\DoxyCodeLine{02681\ }
\DoxyCodeLine{02682\ \ \ \textcolor{keywordflow}{if}\ (newSprite)}
\DoxyCodeLine{02683\ \ \ \{}
\DoxyCodeLine{02684\ \ \ \ \ createSprite(sWidth,\ gFont.yAdvance);}
\DoxyCodeLine{02685\ }
\DoxyCodeLine{02686\ \ \ \ \ \textcolor{keywordflow}{if}\ (textcolor\ !=\ textbgcolor)\ fillSprite(textbgcolor);}
\DoxyCodeLine{02687\ }
\DoxyCodeLine{02688\ \ \ \ \ drawGlyph(gUnicode[index]);}
\DoxyCodeLine{02689\ }
\DoxyCodeLine{02690\ \ \ \ \ pushSprite(x\ +\ gdX[index],\ y,\ textbgcolor);}
\DoxyCodeLine{02691\ \ \ \ \ deleteSprite();}
\DoxyCodeLine{02692\ \ \ \}}
\DoxyCodeLine{02693\ }
\DoxyCodeLine{02694\ \ \ \textcolor{keywordflow}{else}\ drawGlyph(gUnicode[index]);}
\DoxyCodeLine{02695\ }
\DoxyCodeLine{02696\ \ \ \textcolor{keywordflow}{return}\ gxAdvance[index];}
\DoxyCodeLine{02697\ \}}
\DoxyCodeLine{02698\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
